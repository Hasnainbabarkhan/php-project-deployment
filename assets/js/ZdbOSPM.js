define("zdb/common/DBKMPdfViewerSimulation",["tao/lib/stapes","tao/ospm/common/Toolkit","tao/ospm/common/Logger"],function(e,t,n){var i,r,a={ZDBNEO:"Formular1[0].DS1[0].Rand[0].Unterschriften[0].Ktoinhaber[0].Signatur[0].SigFelder[0].left[0]._2[0].Unterschrift2[0]",18201e4:"OSPDMS[0].DS1[0].Rand[0].Unterschrift[0].main[0].E1_STATIONAERERVERTRIEB[0].Signatur[0]._3[0].Unterschrift3[0]",900182400:"OSPDMS[0].DS1[0].Rand[0].inhalt[0].P14[0].unterschrift[0].Unterschrift2[0]"};return r=e.subclass({buttonList:null,log:null,meinExitClickListener:null,constructor:function(e){this.log=new n("zdb","PdfViewNavbar"),this.log.info("constructor "+e),this.buttonList=document.TaoOSPM.ui.widgets.createList()},addElement:function(e,t){e.label=null,e.type="negative",e.id="$_"+e.id,this.log.info("addElement "+e.id),this.buttonList.addElement(document.TaoOSPM.ui.widgets.createButton({id:e.id,label:e.label,leftIcon:e.icon,clickListener:e.clickListener,type:e.type}),t)},removeElement:function(e){this.log.info("removeElement "+e)},replaceElement:function(e,t,n){this.log.info("replaceElement from "+t+" to "+e.id+" (updateDOM: "+n+")"),"MEIN_EXIT"===e.id&&(this.meinExitClickListener=e.clickListener),e.id="$_"+e.id,e.leftIcon=e.icon,e.label=null,"string"==typeof t&&(this.buttonList.removeElement("$_"+t),this.buttonList.addElement(document.TaoOSPM.ui.widgets.createButton({id:e.id,label:e.label,leftIcon:e.icon,clickListener:e.clickListener,type:e.type})))},setHideElement:function(e,t,n){var i,r;for(this.log.info("setHideElement "+e+" hide="+t+" (updateDOM: "+n+")"),i=0;i<this.buttonList.elementCount();i++)if(r=this.buttonList.getElement(i),r.getId()==="$_"+e){r.setHidden(t);break}},hideElement:function(e,t){this.setHideElement(e,!0,t)},showElement:function(e,t){this.setHideElement(e,!1,t)},setEnabledElement:function(e,t,n){var i,r;for(this.log.info("setEnabledElement "+e+" enabled="+t+" (updateDOM: "+n+")"),i=0;i<this.buttonList.elementCount();i++)if(r=this.buttonList.getElement(i),r.getId()==="$_"+e){r.setEnabled(t),t&&r.setHidden(!0);break}},disableElement:function(e,t){this.setEnabledElement(e,!1,t)},enableElement:function(e,t){this.setEnabledElement(e,!0,t)},getElement:function(e){return this.log.info("getElement "+e),{}},setIconElement:function(e,t,n){this.log.info("setIconElement "+e+" (updateDOM: "+n+")")},getAllElements:function(){return this.log.info("getAllElements"),[]},sizeOfElements:function(){return this.buttonList.length},getButtonList:function(){return this.buttonList},getMeinExitClickListener:function(){return this.meinExitClickListener}},!0),i=e.subclass({LOAD_FINISHED:"LOAD_FINISHED",SIGNATURE_AREA_CLOSED_OK:"SIGNATURE_AREA_CLOSED_OK",SIGNATURE_AREA_OK_BUT_CONFIRM_DISABLED:"SIGNATURE_AREA_OK_BUT_CONFIRM_DISABLED",SIGNATURE_AREA_CLEARED:"SIGNATURE_AREA_CLEARED",SIGNATURE_CAPTURE_BUTTON_CLICKED:"SIGNATURE_CAPTURE_BUTTON_CLICKED",SIGNATURE_AREA_MINIMAL_CAPTURED:"SIGNATURE_AREA_MINIMAL_CAPTURED",log:null,dialog:null,signaturdialog:null,signaturgeberdatendialog:null,parameter:null,dbkmController:null,navbar:null,md5Hash:null,signaturesSignedCount:0,signaturesUnsignedCount:1,dialogConfirmEnabled:!1,createStandardNavbar:function(){var e=new r;return e.addElement({id:"EXIT",icon:"CANCEL_CIRCLE_M",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:function(){this.close()}.bind(this)}),e},constructor:function(e,t){this.parameter=e,this.dbkmController=t,this.log=new n("zdb","DBKMPdfViewerSimulation"),this.navbar=this.createStandardNavbar()},close:function(){this.dialog.hide()},getMd5Hash:function(){return this.md5Hash},getNavbar:function(){return this.log.info("getNavbar"),this.navbar},setNavbar:function(e){var t;this.log.info("setNavbar"),this.navbar=e,this.dialog&&(this.dialog.hide(),this.dialog.setContent(null),this.dialog=null),t=this.navbar.getButtonList(),t.removeElement("F_55503$$"),t.addElement(document.TaoOSPM.ui.widgets.createInfoText({id:"F_55503$$",formattedLabel:"Vorlage: "+this.dbkmController.dokument.vorlagenName+"<br>"+this.dbkmController.personenName+" ("+this.dbkmController.dokPersonenNummer+")<br>DokId: "+this.dbkmController.curDokId}),0),t.removeElement("F_84900$$"),t.addElement(document.TaoOSPM.ui.widgets.createButton({id:"F_84900$$",label:"Dok anzeigen",clickListener:function(){document.ZdbOSPM.api.oeffneUrl(this.parameter.url,null)}.bind(this)})),t.removeElement("F_8389$$"),this.parameter.options.handleSignatures&&t.addElement(document.TaoOSPM.ui.widgets.createButton({id:"F_8389$$",label:"Signatur simulieren",clickListener:function(){var e=document.TaoOSPM.ui.widgets.createList();e.addElement(document.TaoOSPM.ui.widgets.createButton({label:"1. Signatur durchführen",clickListener:function(){this.signaturesSignedCount=0,this.signaturesUnsignedCount=1,this.parameter.callback&&(this.parameter.callback({id:this.SIGNATURE_CAPTURE_BUTTON_CLICKED}),this.parameter.callback({id:this.SIGNATURE_AREA_MINIMAL_CAPTURED}),this.log.info("SignatureFilled = "+this.dbkmController.signatureFilled),this.dbkmController.signatureFilled&&(this.signaturesSignedCount=1))}.bind(this)})),e.addElement(document.TaoOSPM.ui.widgets.createButton({id:"F_37375$$",label:"2. Signaturgeberdaten ausfüllen",clickListener:function(){return this.dbkmController.signatureFilled?(this.signaturgeberdatendialog&&(this.signaturgeberdatendialog.hide(),this.signaturgeberdatendialog.setContent(null),this.signaturgeberdatendialog=null),this.signaturesSignedCount=0,this.signaturesUnsignedCount=1,this.signaturgeberdatendialog=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Signaturgeberdaten erfassen",content:this.parameter.signatureFooter[0],cancelOnOutsideClick:!1,mandatory:!0,applyButton:{label:"OK",action:function(){null===document.TaoOSPM.ui.checkInput(!0,this.parameter.signatureFooter[0])?this.signaturgeberdatendialog.hide():this.setSignatureDialogConfirmEnabled(!1)}.bind(this)}}),void this.signaturgeberdatendialog.show()):void this.log.info("Signatur nicht durchgeführt")}.bind(this)})),e.addElement(document.TaoOSPM.ui.widgets.createButton({label:"3. Signatur bestätigen",clickListener:function(){var e,t;this.parameter.callback&&(this.dialogConfirmEnabled?(this.signaturesSignedCount=1,this.signaturesUnsignedCount=0,t=this.dbkmController.dokument.vorlagenName.startsWith("ZDBNEO")?a.ZDBNEO:a[this.dbkmController.dokument.vorlagenName],t?(this.log.info("Unterschriftenfeldname für Vorlage "+this.dbkmController.dokument.vorlagenName+"="+t),e="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",this.parameter.callback({id:this.SIGNATURE_AREA_CLOSED_OK,imagePNGCropped:e,imagePNGCroppedHeight:98,imagePNGCroppedWidth:407,identifier:t,blob:"[97,152,0,147,0,81,0,155,0,143,0,81,0,158,0,138,0,81,0,161,0,133,0,81,0,164,0,129,0,81,0,167,0,124,0,81,0,170,0,120,0,81,0,172,0,117,0,81,0,174,0,114,0,89,0,176,0,112,0,97,0,178,0,110,0,94,0,179,0,109,0,92,0,180,0,109,0,90,0,181,0,109,0,123,0,182,0,109,0,140,0,183,0,110,0,150,0,183,0,112,0,171,0,183,0,115,0,184,0,184,0,119,0,197,0,184,0,122,0,203,0,184,0,127,0,225,0,184,0,130,0,242,0,185,0,134,0,1,1,185,0,139,0,8,1,186,0,142,0,255,0,186,0,147,0,2,1,187,0,150,0,2,1,188,0,155,0,242,0,189,0,158,0,238,0,190,0,163,0,238,0,191,0,166,0,238,0,193,0,170,0,234,0,194,0,173,0,227,0,196,0,176,0,229,0,197,0,178,0,207,0,200,0,180,0,194,0,202,0,181,0,188,0,205,0,182,0,181,0,208,0,182,0,158,0,211,0,182,0,143,0,214,0,181,0,133,0,217,0,180,0,118,0,220,0,178,0,105,0,223,0,175,0,96,0,227,0,170,0,92,0,231,0,166,0,91,0,234,0,160,0,93,0,238,0,154,0,86,0,241,0,148,0,79,0,244,0,142,0,78,0,247,0,136,0,78,0,251,0,130,0,72,0,253,0,126,0,73,0,0,1,121,0,75,0,1,1,118,0,70,0,3,1,115,0,67,0,4,1,114,0,93,0,5,1,112,0,105,0,6,1,112,0,110,0,7,1,112,0,114,0,8,1,112,0,153,0,8,1,112,0,175,0,9,1,114,0,190,0,10,1,116,0,227,0,11,1,119,0,250,0,12,1,123,0,9,1,13,1,126,0,24,1,14,1,129,0,22,1,15,1,132,0,22,1,17,1,136,0,26,1,19,1,139,0,3,1,21,1,143,0,252,0,23,1,146,0,252,0,25,1,150,0,255,0,28,1,153,0,242,0,30,1,156,0,239,0,33,1,159,0,237,0,36,1,161,0,234,0,39,1,163,0,207,0,42,1,164,0,193,0,46,1,164,0,181,0,50,1,164,0,174,0,53,1,164,0,163,0,57,1,162,0,152,0,61,1,160,0,141,0,65,1,157,0,134,0,68,1,153,0,111,0,72,1,148,0,97,0,75,1,144,0,83,0,79,1,138,0,75,0,82,1,133,0,68,0,85,1,128,0,59,0,87,1,122,0,52,0,90,1,116,0,44,0,92,1,112,0,37,0,93,1,108,0,30,0,94,1,105,0,34,0,95,1,102,0,31,0,96,1,100,0,30,0,97,1,99,0,74,0,97,1,98,0,95,0,97,1,98,0,104,0,98,1,99,0,107,0,98,1,101,0,190,0,98,1,105,0,237,0,99,1,109,0,7,1,100,1,114,0,70,1,101,1,119,0,106,1,102,1,124,0,128,1,104,1,129,0,145,1,106,1,134,0,125,1,108,1,140,0,119,1,110,1,144,0,121,1,113,1,149,0,122,1,116,1,152,0,93,1,119,1,155,0,84,1,123,1,157,0,83,1,127,1,159,0,82,1,131,1,160,0,69,1,136,1,160,0,66,1,139,1,160,0,67,1,144,1,158,0,59,1,149,1,156,0,253,0,153,1,153,0,221,0,157,1,150,0,171,0,162,1,146,0,142,0,166,1,142,0,124,0,170,1,138,0,108,0,173,1,134,0,104,0,176,1,130,0,96,0,179,1,126,0,88,0,182,1,123,0,80,0,183,1,120,0,81,0,185,1,117,0,71,0,186,1,116,0,63,0,187,1,114,0,54,0,188,1,114,0,46,0,189,1,113,0,38,0,189,1,114,0,30,0,190,1,115,0,132,0,190,1,118,0,183,0,191,1,121,0,213,0,192,1,126,0,80,1,194,1,134,0,146,1,195,1,141,0,182,1,197,1,149,0,207,1,200,1,157,0,227,1,204,1,165,0,241,1,207,1,172,0,255,1,212,1,181,0,7,2,216,1,186,0,218,1,221,1,190,0,202,1,226,1,193,0,197,1,233,1,194,0,199,1,238,1,194,0,146,1,245,1,193,0,125,1,251,1,190,0,118,1,1,2,186,0,120,1,7,2,182,0,120,1,12,2,178,0,104,1,18,2,173,0,66,1,23,2,168,0,22,1,27,2,164,0,204,0,31,2,159,0,162,0,34,2,155,0,137,0,37,2,151,0,121,0,39,2,148,0,104,0,41,2,145,0,96,0,42,2,143,0,44,0,43,2,141,0,17,0,44,2,140,0,0,0,45,2,140,0,5,0,45,2,139,0,3,0,46,2,140,0,0,0,46,2,141,0,0,0,46,2,141,0,0,0]",SI_ARCHIVINFO:{PLUGIN_DEV:"Kofax Deutschland AG",PLUGIN_VER:"SignDocSDK 1.0.0.67",SDK_SRV_DEV:"Kofax Deutschland AG",SDK_SRV_VER:"FinanzInformatikSignDocHelper_1.0.0.67",DOK_SIGN_TYP:"41",GEBURTSDATUM:null,HINWEIS_AGB:null,HINWEIS_AGB_TEXT:null,NAME_LEGI_PRFG:null,PERSNR:null,PERSONENNR:null,SIGNATUR_GRUND:null,SIGNATUR_ORT:null,SIGN_ANB:"",SIGN_GLTG_ADTM:"",SIGN_GLTG_EDTM:"",SIGN_INHABER_NAME:null,SIGN_LFDN:"",SIGN_SCHL:"",SIGN_TIME:function(){var e,t;return e=new Date,t=(e.getDate()<10?"0"+e.getDate():e.getDate())+"."+(e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1)+"."+e.getFullYear()+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}(),USERID_LEGI_PRFG:null,SIGNATUR_IMAGE:{ContentType:"image/png",Encoding:"Base64",content:e}}})):this.log.error("Unterschriftenfeldname für Vorlage "+this.dbkmController.dokument.vorlagenName+"nicht vorhanden!")):this.log.error("dialogConfirmEnabled="+this.dialogConfirmEnabled))}.bind(this)})),e.addElement(document.TaoOSPM.ui.widgets.createButton({label:"Signaturgeberwidget reset ",clickListener:function(){this.parameter.callback&&this.parameter.callback({id:this.SIGNATURE_CAPTURE_BUTTON_CLICKED})}.bind(this)})),e.addElement(document.TaoOSPM.ui.widgets.createButton({label:"Signatur wiederholen",clickListener:function(){this.parameter.callback&&this.parameter.callback({id:this.SIGNATURE_AREA_CLEARED})}.bind(this)})),this.signaturdialog=document.TaoOSPM.ui.dialogs.createInputDialog({title:this.dbkmController.vorlagenBezeichnung,content:e,applyButton:{label:"OK",action:function(){this.signaturdialog.hide()}.bind(this)}}),document.TaoOSPM.server.executeRequest("zdb.testdokumenteerstellen",{F_83249$$:"getMd5HashOfUrl",F_12413$$:this.parameter.url},function(e){e&&e.F_12668$$&&(this.md5Hash=e.F_12668$$,this.log.info("Md5Hash generiert: "+this.md5Hash),this.signaturdialog.show())}.bind(this))}.bind(this)})),this.dialog=document.TaoOSPM.ui.dialogs.createInputDialog({title:this.dbkmController.vorlagenBezeichnung,content:t,cancelOnOutsideClick:!1,mandatory:!0,applyButton:{label:"Weiter",action:this.navbar.getMeinExitClickListener()}}),this.dialog.show()},setUrl:function(e,t,n){this.log.info("setUrl: "+e+", jumpToLastPosition: "+t+", options: "+n),this.signaturdialog&&(this.signaturdialog.hide(),this.signaturdialog.setContent(null),this.signaturdialog=null),n&&(this.parameter.options.handleSignatures=n.handleSignatures),this.parameter.url=e,t===!0?document.ZdbOSPM.api.oeffneUrl(this.parameter.url,null):(this.signaturesSignedCount=0,this.signaturesUnsignedCount=0,this.dialog&&(this.dialog.hide(),this.dialog.setContent(null),this.dialog=null)),this.parameter.callback({id:this.LOAD_FINISHED}),this.parameter.options.handleSignatures&&document.TaoOSPM.server.executeRequest("zdb.testdokumenteerstellen",{F_83249$$:"getMd5HashOfUrl",F_12413$$:e},function(e){e&&e.F_12668$$&&(this.md5Hash=e.F_12668$$,this.log.info("Md5Hash der neuen Url generiert: "+this.md5Hash))}.bind(this))},getSignaturesSignedCount:function(){return this.signaturesSignedCount},getSignaturesUnsignedCount:function(){return this.signaturesUnsignedCount},setSignatureDialogConfirmEnabled:function(e){this.log.info("setSignatureDialogConfirmEnabled: "+e),this.dialogConfirmEnabled=e}},!0)}),define("zdb/common/DBKMController",["tao/lib/stapes","tao/ospm/common/Toolkit","tao/ospm/common/Logger","tao/ospm/common/Constants","zdb/common/DBKMPdfViewerSimulation"],function(e,t,n,i,r){var a=e.subclass({digsigactive:!1,SIGNATURE_HINWEIS:"Mit meiner Unterschrift gebe ich eine rechtliche bindende Erklärung mit dem im elektronischen Formular angezeigten Inhalt ab. Es gelten die Allgemeinen Geschäftsbedingungen sowie ergänzend oder abweichend besondere Bedingungen, auf die im elektronischen Formular Bezug genommen wird.\n \nWir - als Ihr Vertragspartner - verarbeiten im Rahmen der Unterschrift auf diesem PenPad biometrische Daten, u. a. Schreibgeschwindigkeit und Druckstärke. Mit diesen Daten kann ein späterer Nachweis erfolgen, dass die Unterschrift von Ihnen geleistet wurde und nicht durch einen Dritten. ICH ERKLÄRE MICH MIT DER VERARBEITUNG OBEN GENANNTER DATEN EINVERSTANDEN. Diese Einwilligung kann jederzeit formlos mit Wirkung für die Zukunft uns gegenüber widerrufen werden. Bei Nichteinwilligung in die Verarbeitung dieser biometrischen Daten haben Sie die Möglichkeit, auf Papier zu unterschreiben. Hinweise zum Datenschutz finden Sie in den Vertragsunterlagen.",log:null,response:null,callback:null,dokUrls:null,allMessages:null,internalZdbApi:null,parameter:null,selectedDocuments:[],pdfView:null,ersteUnterschrift:null,defaultPrinterName:null,defaultPrinterOID:null,index:0,indexDirectPrint:0,curDokId:null,dokPersonenNummer:null,dokPersNr:null,vorlagenBezeichnung:null,personenName:null,verarbeitungsArt:null,dokUrl:null,anzKopien:0,archivVorDruck:!1,elektronischSignierbar:!1,archivierbar:!1,vza:!1,postfachfaehig:!1,virtuelleUKarteKZ:!1,erfolgreichArchiviert:!1,dokument:null,constructor:function(e,t,i){var r,a;if(this.log=new n("zdb","dbkm: init DBKMController"),this.log.info("zdb.dbkm init DBKMController"),this.internalZdbApi=document.ZdbOSPM.api.internalZdbApi,this.parameter=this.internalZdbApi.parameter,this.response=this.internalZdbApi.mainResponse,this.callback=i,this.digsigactive=!this.internalZdbApi.useNewSignatureWorkflow,this.dokUrls=null,this.response&&(this.dokUrls=this.response.dokUrls),this.allMessages=t,this.index=0,this.indexDirectPrint=0,this.pdfView=null,this.selectedDocuments=e,null===this.selectedDocuments&&(this.selectedDocuments=[],this.response&&this.response.dokumente))for(r=0;r<this.response.dokumente.length;r++)a=this.response.dokumente[r],a&&a.pflichtKennzeichen&&"pflicht"===a.pflichtKennzeichen&&this.selectedDocuments.push(a)},getDokUrl:function(e){var t;if(e&&this.dokUrls)for(t=0;t<this.dokUrls.length;t++)if(e&&this.dokUrls[t].dokId===e)return this.dokUrls[t].dokUrl;return null},doCallArchivieren:function(e,t){var n={AUTO_ELPO:"false",AUTO_ARCHIV_ABLAGE:"2"};this.internalZdbApi.vzaAuftragId&&(n.vzaAuftragId=this.internalZdbApi.vzaAuftragId),e&&e.length>0&&(n.dkmtIDs=e),this.internalZdbApi.datgid&&(n.DATG_ID=this.internalZdbApi.datgid),this.internalZdbApi.executeRequest("zdb.dokumenteverarbeitenstationaer",n,function(e,n){this.internalZdbApi.messageVerarbeitung(n,"Das Bereitstellen der Dokumente in das Archiv wurde abgebrochen.",this.allMessages,t)?t&&t({messages:n}):(this.index=0,this.pdfView&&this.pdfView.close(),this.pdfView=null)}.bind(this))},doCallSigniertesDokArchivieren:function(e,n){var i,r={};e&&(r.dokId=e),r.verarbKz=t.isNullOrUndefined(this.internalZdbApi.vzaAuftragId)?"A":this.vza&&!this.archivierbar?"V":this.vza&&this.archivierbar?"G":"A",this.pdfView&&(i=this.pdfView.getMd5Hash(),i&&(r.hashMD5=i)),this.internalZdbApi.datgid&&(r.DATG_ID=this.internalZdbApi.datgid),this.internalZdbApi.executeRequest("zdb.signiertesdokspeichern",r,function(e,t){this.internalZdbApi.messageVerarbeitung(t,"Das Bereitstellung des signierten Dokuments in das Archiv wurde abgebrochen.",this.allMessages,n)?n&&n({messages:t}):(this.index=0,this.pdfView&&this.pdfView.close(),this.pdfView=null)}.bind(this))},doCallSignaturSerivce:function(e,t,n,i,r,a,s,l,o,u){var d={dokId:e,signaturBild:t,biomData:n,metaDataXML:i,hashMD5:r,ersteUnterschrift:o,personenNr:a,persNr:s,unterschriftsFeldName:l};this.internalZdbApi.executeRequest("zdb.dokumentsignieren",d,function(e,t){this.internalZdbApi.messageVerarbeitung(t,"Das Signieren des Dokuments wurde abgebrochen.",this.allMessages,u)?(this.configNavbar(),u&&u({messages:t,data:e})):(this.index=0,this.pdfView&&this.pdfView.close(),this.pdfView=null)}.bind(this))},directPrint:function(e,t,n,r,a){var s=function(){var i="",s=function(e){this.log.info(e),this.internalZdbApi.messageVerarbeitung(e,"Das Drucken des Dokuments wurde abgebrochen.",this.allMessages,this.callback,this)?a&&a():(this.index=0,this.pdfView&&this.pdfView.close(),this.pdfView=null)}.bind(this),l=function(e){var n,s;r===!0?(e&&e.rc&&(this.anzKopien>1&&(i+=", "),i+=e.rc),s=document.TaoOSPM.ui.widgets.createList(),s.addElement(document.TaoOSPM.ui.widgets.createText({label:"Dokument <"+t+"> auf Drucker <"+this.defaultPrinterName+"> eingestellt.",hint:"Druckjobs: "+i,hintIcon:"hint"})),n=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Druckergebnis",content:s,mandatory:!0,applyButton:{label:"OK",action:function(){n.hide(),a&&a()}}}),n.show()):a&&a()}.bind(this),o=function(r){var a;r&&r.rc&&(this.indexDirectPrint>1&&this.indexDirectPrint<this.anzKopien&&(i+=", "),i+=r.rc),a={druckerOid:this.defaultPrinterOID,dokumentUrl:e,druckauftragName:t+" ("+n+", Kopie: "+(this.indexDirectPrint+1)+"/"+this.anzKopien+")"},this.indexDirectPrint===this.anzKopien-1?document.TaoOSPM.plugins.druckAuftrag(a,l,s):(this.indexDirectPrint++,document.TaoOSPM.plugins.druckAuftrag(a,o,s))}.bind(this);this.indexDirectPrint=0,o()}.bind(this);return[i.STAGES.DEVELOP,i.STAGES.ENTWICKLUNG,i.STAGES.INTEGRATION,i.STAGES.ABNAHME].indexOf(document.TaoOSPM.serverEnvironment.getStage())>=0&&!document.TaoOSPM.session.environment.isIPadApp()?(this.log.info("Simulation Direktdruck"),void(a&&a())):void(null===this.defaultPrinterOID&&r===!1||r===!0?document.TaoOSPM.plugins.druckerAuswahl(function(e){this.log.info(e),"0"===e.rc?(this.defaultPrinterOID=e.standardDrucker.druckerOid,this.defaultPrinterName=e.standardDrucker.druckerName,this.defaultPrinterOID?s():a&&a()):a&&a()}.bind(this)):this.defaultPrinterOID?s():a&&a())},getArchivTitel:function(e){if(this.virtuelleUKarteKZ)return"Weiterl. Unterschriftenprobe und Archivierung";if(e){if(!t.isNullOrUndefined(this.internalZdbApi.vzaAuftragId)){if(this.vza&&!this.archivierbar)return"Weiterleitung signiertes Dokument";if(this.vza&&this.archivierbar)return"Archivierung und Weiterleitung sig. Dokument"}return"Archivierung signiertes Dokument"}return"Archivierung"},getArchivText:function(e,n){if(this.virtuelleUKarteKZ)return n?"Das signierte Dokument wurde noch nicht als Unterschriftenprobe weitergeleitet und archiviert. Soll es jetzt als Unterschriftenprobe weitergeleitet und dann archiviert werden?":"Das Dokument <"+this.vorlagenBezeichnung+"> wurde als Unterschriftenprobe und zur Archivierung weitergeleitet.";if(e){if(!t.isNullOrUndefined(this.internalZdbApi.vzaAuftragId)){if(this.vza&&!this.archivierbar)return n?"Das signierte Dokument ist noch nicht für die Weiterleitung an den Verbundpartner eingestellt. Soll es weitergeleitet werden?":"Das Dokument <"+this.vorlagenBezeichnung+"> wurde für die Weiterleitung an den Verbundpartner vorgesehen.";if(this.vza&&this.archivierbar)return n?"Das signierte Dokument wurde noch nicht für die Weiterleitung an den Verbundpartner eingestellt und archiviert. Soll es weitergeleitet werden?":"Das Dokument <"+this.vorlagenBezeichnung+"> wurde für die Weiterleitung an den Verbundpartner vorgesehen und zur Archivierung weitergeleitet."}if(n)return"Das signierte Dokument wurde noch nicht archiviert. Soll es jetzt archiviert werden?"}return n?"":"Das Dokument <"+this.vorlagenBezeichnung+"> wurde zur Archivierung weitergeleitet."},archiveFunction:function(e,n){var i;t.isNullOrUndefined(this.pdfView)||(i=this.pdfView.getNavbar(),i&&i.disableElement("SIG_ARCHIVE",!0)),!t.isNullOrUndefined(this.pdfView)&&this.elektronischSignierbar===!0&&this.pdfView.getSignaturesSignedCount()>0?this.doCallSigniertesDokArchivieren(this.curDokId,function(i){this.internalZdbApi.messageVerarbeitung(i.messages,"Die Archivierung des signierten Dokuments wurde abgebrochen.",this.allMessages,this.callback,this)?(this.erfolgreichArchiviert=!0,t.isNullOrUndefined(this.dokUrl)||this.pdfView.setUrl(this.dokUrl,!0,{handleSignatures:!1}),void 0===n||n===!0?document.TaoOSPM.ui.dialogs.showTextDialog({title:this.getArchivTitel(!0),text:this.getArchivText(!0,!1),okButton:{label:"OK",action:function(){e&&e()}}}):e&&e()):(this.index=0,this.pdfView&&this.pdfView.close(),this.pdfView=null)}.bind(this)):this.doCallArchivieren([this.curDokId],function(i){this.internalZdbApi.messageVerarbeitung(i.messages,"Die Archvierung des Dokuments wurde abgebrochen.",this.allMessages,this.callback,this)?(this.erfolgreichArchiviert=!0,t.isNullOrUndefined(this.pdfView)||t.isNullOrUndefined(this.pdfView.getNavbar())||this.configNavbar(),void 0===n||n===!0?document.TaoOSPM.ui.dialogs.showTextDialog({title:this.getArchivTitel(!1),text:this.getArchivText(!1,!1),okButton:{label:"OK",action:function(){e&&e()}}}):e&&e()):(this.index=0,t.isNullOrUndefined(this.pdfView)||this.pdfView.close(),this.pdfView=null)}.bind(this))},setInitialNavbar:function(e){var t=this.pdfView.getNavbar(),n=function(){this.archiveFunction(function(){this.log.info("Archivierung durchgeführt.")}.bind(this),!0)}.bind(this),i=function(){this.archivVorDruck===!0&&this.erfolgreichArchiviert===!1?this.archiveFunction(function(){this.directPrint(this.dokUrl,this.vorlagenBezeichnung,this.personenName,!0,function(){this.log.info("Drucken fertig!")}.bind(this))}.bind(this),!0):this.directPrint(this.dokUrl,this.vorlagenBezeichnung,this.personenName,!0,function(){this.log.info("Drucken fertig!")}.bind(this))}.bind(this),r=function(){var t=function(){this.log.info("call doPdfViewerOrDirectPrint "+this.index),this.index++,this.doPdfViewerOrDirectPrint(e)}.bind(this);this.elektronischSignierbar===!0&&this.erfolgreichArchiviert===!1&&this.pdfView.getSignaturesSignedCount()>0?document.TaoOSPM.ui.dialogs.showSecurityDialog({title:this.getArchivTitel(!0),icon:"STANDARD_INFORMATION_CIRCLE_M",text:this.getArchivText(!0,!0),okLabel:"Ja",cancelLabel:"Nein"},function(){this.archiveFunction(t,!0)
}.bind(this),function(){t()}):t()}.bind(this);t.replaceElement({id:"MEIN_EXIT",icon:"CANCEL_CIRCLE_M",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:r},"EXIT"),t.addElement({id:"PRINT",icon:"PRINT_M",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:i},"SPACE_RIGHT_FIRST"),t.addElement({id:"SPACE_DRUCKEN",position:"right",type:"space",size:"normal"},"PRINT"),t.addElement({id:"SIG_ARCHIVE",icon:"archive_pdf",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:n},"SPACE_DRUCKEN"),t.addElement({id:"SPACE_ARCHIVE",position:"right",type:"space",size:"normal"},"SIG_ARCHIVE"),this.pdfView.setNavbar(t),this.configNavbar()},configNavbar:function(){var e=this.pdfView.getNavbar();e.getElement("DOCUMENT_TITLE").label=this.vorlagenBezeichnung,this.archivierbar!==!0&&this.vza!==!0||this.erfolgreichArchiviert!==!1?(e.hideElement("SIG_ARCHIVE"),e.hideElement("SPACE_ARCHIVE")):(this.log.info("getSignaturesSignedCount  : "+this.pdfView.getSignaturesSignedCount()),this.log.info("getSignaturesUnsignedCount: "+this.pdfView.getSignaturesUnsignedCount()),this.elektronischSignierbar===!0&&0===this.pdfView.getSignaturesSignedCount()?(e.hideElement("SIG_ARCHIVE"),e.hideElement("SPACE_ARCHIVE")):(e.enableElement("SIG_ARCHIVE",!0),e.enableElement("SPACE_ARCHIVE",!0),e.showElement("SIG_ARCHIVE"),e.showElement("SPACE_ARCHIVE"))),e.enableElement("MEIN_EXIT",!0),e.enableElement("PRINT",!0),e.showElement("MEIN_EXIT"),e.showElement("PRINT"),this.pdfView.setNavbar(e)},doPdfViewerWithUrl:function(e,t){var n,i=function(){this.pdfView&&this.pdfView.close(),this.pdfView=null,t&&t({event:"weiter"})}.bind(this),r=function(){this.anzKopien=1,this.directPrint(e,"Dokument","Dokument",!0,function(){this.log.info("Drucken fertig!")}.bind(this))}.bind(this);this.pdfView=document.TaoOSPM.plugins.createDocumentViewer({url:e,options:{animateInit:!0,animateUpdate:!1,initFullWidth:!0,startPenDiscover:!1,handleSignatures:!1}}),n=this.pdfView.getNavbar(),n.replaceElement({id:"MEIN_EXIT",icon:"CANCEL_CIRCLE_M",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:i},"EXIT"),n.addElement({id:"PRINT",icon:"PRINT_M",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:r},"SPACE_RIGHT_FIRST"),n.getElement("DOCUMENT_TITLE").label="",n.showElement("MEIN_EXIT"),n.showElement("PRINT"),this.pdfView.setNavbar(n)},idTextfilled:!1,nameTextfilled:!1,dateTextfilled:!1,ortTextfilled:!1,signatureFilled:!1,WIDGET_LEGITIMATION:null,WIDGET_SIGN_INHABER_NAME:null,WIDGET_GEBURTSDATUM:null,WIDGET_SIGNATUR_ORT:null,signaturGeberList:[],labelToGebDatumMap:{},labelToHWohnsitzMap:{},labelToLegiListMap:{},signaturGeberPersonenNrToPersNr:{},signatureWidgetsList:null,createWidgetsForSignaturDialog:function(){var e,t,n,i,r,a,s,l=[],o={};if(this.signaturGeberList=[],this.labelToGebDatumMap={},this.labelToLegiListMap={},this.labelToHWohnsitzMap={},this.signaturGeberPersonenNrToPersNr={},this.response&&this.response.legitimationen)for(i=0;i<this.response.legitimationen.length;i++)if(s=this.response.legitimationen[i],s.personenNr&&s.personenNr.length>0){for(o={},o.label=s.vorname.length>0||s.name.length>0?(s.anrede.length>0?s.anrede+" ":"")+(s.vorname.length>0?s.vorname+" ":"")+s.name:s.personenNr,o.value=s.personenNr,this.signaturGeberList.push(o),s.persNr&&s.persNr.length>0&&(this.signaturGeberPersonenNrToPersNr[s.personenNr]=s.persNr),s.gebdatum&&s.gebdatum.length>0&&(this.labelToGebDatumMap[s.personenNr]=s.gebdatum),s.hwohnsitz&&s.hwohnsitz.length>0&&(this.labelToHWohnsitzMap[s.personenNr]=s.hwohnsitz),l=[],r=0;r<s.legdaten.length;r++)a=s.legdaten[r],o={},o.label=a,o.value=a,l.push(o);l.length>0&&(this.labelToLegiListMap[s.personenNr]=l)}this.WIDGET_GEBURTSDATUM=document.TaoOSPM.ui.widgets.createTextInput({label:"Geburtsdatum",mandatory:!0,mandatoryMessage:"Geburtsdatum ist ein Pflichtfeld",group:"signaturemetadata",changeListener:function(i){i.getValue().length>0&&i.hasError()===!1&&(e=new Date(i.getValue().replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1")),t=Date.parse(new Date),n=Date.parse(e),n>t&&i.setError("Geburtsdatum liegt in der Zukunft"),e.getFullYear()<1900&&i.setError("Geburtsjahr muss größer als 1900 sein.")),this.dateTextfilled=!i.hasError(),this.dateTextfilled&&this.pdfView.setSignatureDialogConfirmEnabled(null===document.TaoOSPM.ui.checkInput(!0,this.signatureWidgetsList)&&this.signatureFilled&&this.idTextfilled&&this.nameTextfilled&&this.dateTextfilled&&this.ortTextfilled)}.bind(this)}),this.WIDGET_GEBURTSDATUM.setDataType({type:"TaoDate",leapYear:!0}),this.WIDGET_LEGITIMATION=document.TaoOSPM.ui.widgets.createDropdown({label:"Identifikation des Signaturgebers",customInputPlaceholder:"Identifikation wählen",elements:[],useCustomInput:!0,mandatory:!0,mandatoryMessage:"Identifikation des Signaturgebers ist ein Pflichtfeld",group:"signaturemetadata",changeListener:function(e){this.idTextfilled=null!==e.getCustomValue()&&e.getCustomValue().length>0||null!==e.getSelected()&&e.getSelected().length>0,this.idTextfilled&&!e.hasError()&&this.pdfView.setSignatureDialogConfirmEnabled(null===document.TaoOSPM.ui.checkInput(!0,this.signatureWidgetsList)&&this.signatureFilled&&this.idTextfilled&&this.nameTextfilled&&this.dateTextfilled&&this.ortTextfilled)}.bind(this)}),this.WIDGET_SIGN_INHABER_NAME=document.TaoOSPM.ui.widgets.createDropdown({label:"Name",customInputPlaceholder:"Name wählen",elements:this.signaturGeberList,useCustomInput:!0,mandatory:!0,mandatoryMessage:"Name ist ein Pflichtfeld",group:"signaturemetadata",changeListener:function(e){var t,n,i,r=null!==e.getCustomValue()&&e.getCustomValue().length>0;this.nameTextfilled=r||null!==e.getSelected()&&e.getSelected().length>0,this.WIDGET_LEGITIMATION.setCustomValue(""),this.WIDGET_LEGITIMATION.setElements([]),this.WIDGET_LEGITIMATION.setSelected(null),this.WIDGET_GEBURTSDATUM.setValue(""),this.idTextfilled=!1,this.dateTextfilled=!1,r===!1&&this.nameTextfilled===!0&&(t=this.labelToGebDatumMap[e.getSelected()],t&&t.length>0&&(this.WIDGET_GEBURTSDATUM.setValue(t),this.dateTextfilled=!0),i=this.labelToHWohnsitzMap[e.getSelected()],i&&i.length>0&&"J"===this.ersteUnterschrift&&(this.WIDGET_SIGNATUR_ORT.setValue(i),this.ortTextfilled=!0),n=this.labelToLegiListMap[e.getSelected()],n&&n.length>0&&(this.WIDGET_LEGITIMATION.setElements(n),this.WIDGET_LEGITIMATION.setSelected(n[0].value),this.idTextfilled=!0)),this.WIDGET_GEBURTSDATUM.setEnabled(!this.dateTextfilled||r),this.nameTextfilled&&!e.hasError()&&this.pdfView.setSignatureDialogConfirmEnabled(null===document.TaoOSPM.ui.checkInput(!0,this.signatureWidgetsList)&&this.signatureFilled&&this.idTextfilled&&this.nameTextfilled&&this.dateTextfilled&&this.ortTextfilled)}.bind(this)}),this.WIDGET_SIGNATUR_ORT=document.TaoOSPM.ui.widgets.createTextInput({label:"Ort",value:"",type:"text",mandatory:!0,mandatoryMessage:"Ort ist ein Pflichtfeld",group:"signaturemetadata",changeListener:function(e){this.ortTextfilled=e.getValue().length>0,this.ortTextfilled&&!e.hasError()&&this.pdfView.setSignatureDialogConfirmEnabled(null===document.TaoOSPM.ui.checkInput(!0,this.signatureWidgetsList)&&this.signatureFilled&&this.idTextfilled&&this.nameTextfilled&&this.dateTextfilled&&this.ortTextfilled)}.bind(this)}),this.signatureWidgetsList=document.TaoOSPM.ui.widgets.createList({form:!0}),this.signatureWidgetsList.addElement(this.WIDGET_SIGN_INHABER_NAME),this.signatureWidgetsList.addElement(this.WIDGET_GEBURTSDATUM),this.signatureWidgetsList.addElement(this.WIDGET_LEGITIMATION),this.signatureWidgetsList.addElement(this.WIDGET_SIGNATUR_ORT)},fillVariables:function(){var e;if(this.dokument=this.selectedDocuments[this.index],this.dokument&&(this.curDokId=this.dokument.documentID,this.dokUrl=this.getDokUrl(this.curDokId),this.vorlagenBezeichnung=this.dokument.vorlagenBezeichnung,this.personenName=this.dokument.personenName,this.verarbeitungsArt=this.dokument.verarbeitungsArt,this.dokPersonenNummer=this.dokument.personenNr,this.dokPersNr=this.dokument.persNr,void 0===this.dokument.anzahlKopien?this.anzKopien=1:(this.anzKopien=parseInt(this.dokument.anzahlKopien,10),this.anzKopien<1?this.anzKopien=1:this.anzKopien>9&&(this.anzKopien=9))),this.elektronischSignierbar=!1,this.archivierbar=!1,this.vza=!1,this.postfachfaehig=!1,this.erfolgreichArchiviert=!1,this.archivVorDruck=!1,this.dokument&&!t.isNullOrUndefined(this.dokument.archiv)&&"J"===this.dokument.archiv&&(this.archivierbar=!0),this.dokument&&this.dokument.archivElekKz&&(this.dokument.archivElekKz.indexOf("unterschreibbar")>=0&&(this.elektronischSignierbar=!0),this.dokument.archivElekKz.indexOf("Archivierung")>=0&&this.internalZdbApi.docsForArchiv.length>0))for(e=0;e<this.internalZdbApi.docsForArchiv.length;e++)if(this.dokument.documentID===this.internalZdbApi.docsForArchiv[e].documentID){this.archiveFunction(function(){this.log.info("Archivierung (Neuer Signaturworkflow) durchgeführt.")}.bind(this),!1);break}this.dokument&&!t.isNullOrUndefined(this.dokument.vza)&&"J"===this.dokument.vza&&(this.vza=!0),this.dokument&&!t.isNullOrUndefined(this.dokument.archivVorDruckKZ)&&"J"===this.dokument.archivVorDruckKZ&&(this.archivVorDruck=!0),this.dokument&&!t.isNullOrUndefined(this.dokument.postfachKennzeichen)&&"1"===this.dokument.postfachKennzeichen&&(this.postfachfaehig=!0),this.dokument&&!t.isNullOrUndefined(this.dokument.virtuelleUKarteKZ)&&"J"===this.dokument.virtuelleUKarteKZ&&(this.virtuelleUKarteKZ=!0),this.dokument&&"true"===this.response.epostfachAktiviert&&this.postfachfaehig&&this.anzKopien>=2&&this.anzKopien--},doSignatureAreaClosedOk:function(e){var n,i,r,a,s,l,o,u,d="";return this.log.info("Bildhöhe: "+e.imagePNGCroppedHeight),this.log.info("Bildbreite: "+e.imagePNGCroppedWidth),e.imagePNGCroppedHeight<26||e.imagePNGCroppedWidth<51?(this.pdfView.setSignatureDialogConfirmEnabled(!1),this.signatureFilled=!1,document.TaoOSPM.ui.dialogs.showTextDialog({title:"Elektronische Unterschrift",text:"Bitte wiederholen Sie die Erfassung der Unterschrift. Die Höhe oder Breite der Unterschrift ist zu gering.",okButton:{label:"OK",action:function(){this.pdfView.signatureDialog.clearArea()}.bind(this)}}),!0):(s=e.identifier,a=this.pdfView.getMd5Hash(),i=e.imagePNGCropped,r=e.blob,n=e.SI_ARCHIVINFO,void 0===n&&(n={}),o=function(e){return t.htmlEncode(e)},n.PERSNR="0001-01-01-00.00.00.020000",l=document.TaoOSPM.session.user.getUserData(),l&&(n.NAME_LEGI_PRFG=o(l.name)+", "+o(l.vorname),n.USERID_LEGI_PRFG=l.userId),n.SIGNATUR_GRUND=o(this.vorlagenBezeichnung),n.HINWEIS_AGB_TEXT=o(this.SIGNATURE_HINWEIS),n.HINWEIS_AGB="j",n.GEBURTSDATUM=this.WIDGET_GEBURTSDATUM.getValue(),n.SIGNATUR_ORT=o(this.WIDGET_SIGNATUR_ORT.getValue()),null!==this.WIDGET_LEGITIMATION.getCustomValue()&&this.WIDGET_LEGITIMATION.getCustomValue().length>0?n.PERSONENNR=o(this.WIDGET_LEGITIMATION.getCustomValue()):null!==this.WIDGET_LEGITIMATION.getSelected()&&this.WIDGET_LEGITIMATION.getSelected().length>0&&(n.PERSONENNR=o(this.WIDGET_LEGITIMATION.getSelected())),null!==this.WIDGET_SIGN_INHABER_NAME.getCustomValue()&&this.WIDGET_SIGN_INHABER_NAME.getCustomValue().length>0?n.SIGN_INHABER_NAME=o(this.WIDGET_SIGN_INHABER_NAME.getCustomValue()):null!==this.WIDGET_SIGN_INHABER_NAME.getSelectedIndexes()&&this.WIDGET_SIGN_INHABER_NAME.getSelectedIndexes()>=0&&null!==this.WIDGET_SIGN_INHABER_NAME.getElements()&&this.WIDGET_SIGN_INHABER_NAME.getElements().length>0&&(n.SIGN_INHABER_NAME=o(this.WIDGET_SIGN_INHABER_NAME.getElements()[this.WIDGET_SIGN_INHABER_NAME.getSelectedIndexes()].label),this.signaturGeberPersonenNrToPersNr[this.WIDGET_SIGN_INHABER_NAME.getSelected()]&&this.signaturGeberPersonenNrToPersNr[this.WIDGET_SIGN_INHABER_NAME.getSelected()].length>0&&(n.PERSNR=this.signaturGeberPersonenNrToPersNr[this.WIDGET_SIGN_INHABER_NAME.getSelected()])),d='<?xml version="1.0" encoding="utf-8" ?><SI_ARCHIVINFO>',u=Object.keys(n),u.forEach(function(e){d+="<"+e,n[e]?"SIGNATUR_IMAGE"===e?(d+=' ContentType="'+n[e].ContentType+'" Encoding="'+n[e].Encoding+'">',d+=n[e].content):d+=">"+n[e]:d+=">",d+="</"+e+">"}),d+="</SI_ARCHIVINFO>",this.log.info(d),this.doCallSignaturSerivce(this.curDokId,i,r,d,a,this.dokPersonenNummer,this.dokPersNr,s,this.ersteUnterschrift,function(e){this.log.info("Signierung Fertig."),this.internalZdbApi.messageVerarbeitung(e.messages,"Die Signierung des Dokuments wurde abgebrochen.",this.allMessages,this.callback,this)?e&&(e.data.dokUrls&&1===e.data.dokUrls.length&&(this.dokUrl=e.data.dokUrls[0]),t.isNullOrUndefined(this.dokUrl)?document.TaoOSPM.ui.dialogs.showTextDialog({title:"Signierung",text:"Die elektronische Signatur konnte nicht in das Dokument integriert werden.",okButton:{label:"OK",action:function(){this.configNavbar()}.bind(this)}}):(this.ersteUnterschrift="N",this.erfolgreichArchiviert=!1,this.pdfView.setUrl(this.dokUrl,!0,{handleSignatures:this.digsigactive&&this.elektronischSignierbar===!0}))):(this.index=0,this.pdfView&&this.pdfView.close(),this.pdfView=null)}.bind(this)),!1)},doSignatureCaptureButtonClicked:function(){var e,t,n,i,r;if(this.idTextfilled=!1,this.nameTextfilled=!1,this.dateTextfilled=!1,this.signatureFilled=!1,this.WIDGET_SIGN_INHABER_NAME.setCustomValue(""),this.WIDGET_SIGN_INHABER_NAME.setSelected(null),this.signaturGeberList&&this.signaturGeberList.length>0)this.WIDGET_LEGITIMATION.setCustomValue(""),this.WIDGET_LEGITIMATION.setElements([]),this.WIDGET_LEGITIMATION.setSelected(null),this.WIDGET_GEBURTSDATUM.setValue(""),this.nameTextfilled=!0,n=this.labelToGebDatumMap[this.signaturGeberList[0].value],n&&n.length>0&&(this.WIDGET_GEBURTSDATUM.setValue(n),this.WIDGET_GEBURTSDATUM.setEnabled(!1),this.dateTextfilled=!0),0===this.WIDGET_SIGNATUR_ORT.getValue().length&&"J"===this.ersteUnterschrift&&(r=this.labelToHWohnsitzMap[this.signaturGeberList[0].value],r&&r.length>0&&(this.WIDGET_SIGNATUR_ORT.setValue(r),this.ortTextfilled=!0)),i=this.labelToLegiListMap[this.signaturGeberList[0].value],i&&i.length>0&&(this.WIDGET_LEGITIMATION.setElements(i),this.WIDGET_LEGITIMATION.setSelected(i[0].value),this.idTextfilled=!0),this.WIDGET_SIGN_INHABER_NAME.setSelected(this.signaturGeberList[0].value);else for(t=0;t<this.signatureWidgetsList.getElements().length;t++)e=this.signatureWidgetsList.getElement(t),"Geburtsdatum"===e.labelText?e.setValue(""):"Identifikation des Signaturgebers"===e.labelText?(e.setElements([]),e.setSelected(null),e.setCustomValue("")):"Name"===e.labelText&&(e.setSelected(null),e.setCustomValue(""));return!1},doPdfViewerOrDirectPrint:function(e){var n,a=this.selectedDocuments.length;return this.index>=a?(this.index=0,this.pdfView&&this.pdfView.close(),this.pdfView=null,void(e&&e(this.allMessages))):void(this.selectedDocuments[this.index]&&(this.fillVariables(),t.isNullOrUndefined(this.dokUrl)||this.internalZdbApi.refreshURL(this.dokUrl,function(a){this.dokUrl=a,"DRUCKER1"!==this.verarbeitungsArt||this.elektronischSignierbar===!0&&this.digsigactive===!0?(this.log.info("PDFViewer aufrufen"),this.ersteUnterschrift="J",t.isNullOrUndefined(this.pdfView)?(this.createWidgetsForSignaturDialog(),n={url:this.dokUrl,signatureFooter:[this.signatureWidgetsList],note:this.SIGNATURE_HINWEIS,options:{animateInit:!0,animateUpdate:!1,initFullWidth:!0,startPenDiscover:!0,handleSignatures:this.digsigactive&&this.elektronischSignierbar===!0},callback:function(e){var t=!1;return this.pdfView&&(e.id===this.pdfView.LOAD_FINISHED?(this.pdfView.setSignatureDialogConfirmEnabled(!1),this.configNavbar()):e.id===this.pdfView.SIGNATURE_AREA_MINIMAL_CAPTURED&&(this.signatureFilled=!1,this.erfolgreichArchiviert===!1&&(this.signatureFilled=!0,this.pdfView.setSignatureDialogConfirmEnabled(null===document.TaoOSPM.ui.checkInput(!0,this.signatureWidgetsList)&&this.signatureFilled&&this.idTextfilled&&this.nameTextfilled&&this.dateTextfilled&&this.ortTextfilled)),t=!0),e.id===this.pdfView.SIGNATURE_CAPTURE_BUTTON_CLICKED?t=this.doSignatureCaptureButtonClicked():e.id===this.pdfView.SIGNATURE_AREA_CLEARED?(this.pdfView.setSignatureDialogConfirmEnabled(!1),this.signatureFilled=!1):e.id===this.pdfView.SIGNATURE_AREA_CLOSED_OK&&this.erfolgreichArchiviert===!1?t=this.doSignatureAreaClosedOk(e):e.id===this.pdfView.SIGNATURE_AREA_OK_BUT_CONFIRM_DISABLED?document.TaoOSPM.ui.checkInput(!0,this.signatureWidgetsList):this.erfolgreichArchiviert===!1&&this.pdfView.setSignatureDialogConfirmEnabled(null===document.TaoOSPM.ui.checkInput(!0,this.signatureWidgetsList)&&this.signatureFilled&&this.idTextfilled&&this.nameTextfilled&&this.dateTextfilled&&this.ortTextfilled)),t}.bind(this)},[i.STAGES.DEVELOP,i.STAGES.ENTWICKLUNG,i.STAGES.INTEGRATION,i.STAGES.ABNAHME].indexOf(document.TaoOSPM.serverEnvironment.getStage())>=0&&!document.TaoOSPM.session.environment.isIPadApp()?(this.log.info("zdb.dbkm DBKMPdfViewerSimulation OSAP called in DBKMController"),this.pdfView=new r(n,this)):this.pdfView=document.TaoOSPM.plugins.createDocumentViewer(n),this.setInitialNavbar(e)):(this.erfolgreichArchiviert=!1,this.pdfView.setUrl(this.dokUrl,!1,{handleSignatures:this.digsigactive&&this.elektronischSignierbar===!0}))):(this.archivVorDruck===!0&&this.archiveFunction(function(){this.log.info("Archivierung (archivVorDruck) durchgeführt.")}.bind(this),!1),this.log.info("Direktdruck aufrufen"),this.directPrint(this.dokUrl,this.vorlagenBezeichnung,this.personenName,!1,function(){this.index++,this.doPdfViewerOrDirectPrint(e)}.bind(this)))}.bind(this))))},start:function(e){this.log.info("zdb.dbkm start called in DBKMController"),this.defaultPrinterName=null,this.defaultPrinterOID=null,this.selectedDocuments.length>0?this.doPdfViewerOrDirectPrint(e):e&&e(this.allMessages)},startWithUrl:function(e,t){this.log.info("zdb.dbkm startWithUrl called in DBKMController"),this.defaultPrinterName=null,this.defaultPrinterOID=null,e&&e.length>0?this.doPdfViewerWithUrl(e,t):t&&t()}},!0);return a}),define("zdb/common/EPostfachController",["tao/lib/stapes","tao/ospm/common/Logger","tao/ospm/common/Toolkit","tao/ospm/common/Constants"],function(e,t,n,i){var r=e.subclass({log:null,spinnerId:null,internalZdbApi:null,parameter:null,callback:null,finishFunc:null,selectedVorlagen:null,response:null,allMessages:null,dokUrls:null,allePostfachberechtigeList:null,doksWithPostfach:null,resultPostfachempfaengerList:null,hasOptionalePostfachempfanger:!1,hasUnselectedOptionalePostfachempfanger:!1,resultList:null,allDocsHaveOnlyDritte:!1,selectedEmpfaengerForWeiter:[],postfachEmpfEntryMap:{},useMitteilung:!1,useAllSelektion:!1,allSelektion:null,textelement:null,textarea:null,mitteilungArchivieren:null,abgleichFehler:[],selectedDruckDoks:null,constructor:function(e,i,r,a){var s,l,o={},u={};for(this.log=new t("zdb","EPostfachController: init EPostfachController"),this.internalZdbApi=document.ZdbOSPM.api.internalZdbApi,this.response=this.internalZdbApi.mainResponse,this.parameter=this.internalZdbApi.parameter,this.callback=this.internalZdbApi.mainCallback,this.finishFunc=a,this.selectedVorlagen=e,this.allMessages=n.isNullOrUndefined(i)?[]:i,this.dokUrls=r,this.doksWithPostfach=[],this.resultPostfachempfaengerList=document.TaoOSPM.ui.widgets.createList(),this.internalZdbApi.useNewSignatureWorkflow?(this.selectedDruckDoks=[],document.TaoOSPM.ui.getSelectionGroup("druckdokgroup").selectedElements().forEach(function(e){this.selectedDruckDoks.push(e.appData)}.bind(this))):this.selectedDruckDoks=this.internalZdbApi.selDocs,this.internalZdbApi.changeMap={},this.internalZdbApi.orgMap={},s=document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup").getElements();s.length>0;)document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup").removeElement(s[0]);for(l=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements();l.length>0;)document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").removeElement(l[0]);document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements().length=0,document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup").getElements().length=0,this.response&&this.response.dokumente&&(this.allePostfachberechtigeList=this.response.postfachberechtigte,this.fillDoksForPostfach(o,u),this.configureCheckBoxParameter(o,u)),this.textelement=null,this.textarea=null,this.mitteilungArchivieren=null,this.resultList=document.TaoOSPM.ui.widgets.createList()},fillDoksForPostfach:function(e,t){var i,r,a,s,l,o,u,d;for(i=0;i<this.response.dokumente.length;i++){if(u=[],l=this.response.dokumente[i],d=!1,this.internalZdbApi.nurDrucken.dokids.indexOf(l.documentID)>-1)d=!0;else if(this.internalZdbApi.arcvordrDokIdsAbgewaehlt.indexOf(l.documentID)>-1)d=!0;else if(this.internalZdbApi.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK&&!n.isNullOrUndefined(this.selectedDruckDoks)&&this.selectedDruckDoks.length>0)for(r=0;r<this.selectedDruckDoks.length;r++)if(this.selectedDruckDoks[r].documentID===l.documentID){d=!0;break}if(!d&&this.allePostfachberechtigeList&&"1"===l.postfachKennzeichen){for(this.log.info("Postfachberechtigt:"),a=0;a<this.allePostfachberechtigeList.length;a++)s=this.allePostfachberechtigeList[a].personennr,void 0===t[s]&&(t[s]={}),t[s][this.allePostfachberechtigeList[a].mifidrelevant?"MIFID":"REGULAR"]="",void 0===e[s]&&(e[s]={}),e[s][this.allePostfachberechtigeList[a].elpbrec]="",this.allePostfachberechtigeList[a].dokpersonennr===l.personenNr&&this.allePostfachberechtigeList[a].mifidrelevant===l.postfachMifidRelevant&&u.push(this.allePostfachberechtigeList[a]);o={dokument:l,postfachempfList:u},this.internalZdbApi.formularCenterDokumentFuerVersandAmAnfang&&this.internalZdbApi.formularCenterHinzugefuegteDokId===l.documentID?this.doksWithPostfach.splice(0,0,o):this.doksWithPostfach.push(o)}}},internConfigureCheckBoxParameter:function(e,t,n,i,r,a,s){var l,o,u,d,h,c,g,f,p,m=!0,E=!1,k=!0;for(o=0;o<t.length;o++)E=E===!1?"Adressat"===t[o].elpbrec:!0,k=k===!0?"Dritter"===t[o].elpbrec:!1;for(this.allDocsHaveOnlyDritte=this.allDocsHaveOnlyDritte===!0?k:!1,o=0;o<t.length;o++){if(g=Object.keys(r[t[o].personennr]).sort(),p="","Dritter"===t[o].elpbrec)p="Dritter",g=["Dritter"];else for(u=0;u<g.length;u++)if("Dritter"!==g[u]&&(p+=g[u],u<g.length-1))for(d=u+1;d<g.length;d++)if("Dritter"!==g[d]){p+=", ";break}f=t[o].vorname+" "+t[o].name+" ("+p+")",h=f+", "+t[o].personennr,this.postfachEmpfEntryMap[h]?this.postfachEmpfEntryMap[h].push(e):(l=!0,k===!1&&(m===!0||g.length>1)&&(1===t.length?(l=!1,m=!1):E===!0&&p.indexOf("Adressat")>=0?(l=!1,m=!1):E===!1&&p.indexOf("Verbundperson")>=0&&(l=!1)),this.hasOptionalePostfachempfanger===!1&&(this.hasOptionalePostfachempfanger=l),this.hasUnselectedOptionalePostfachempfanger===!1&&(this.hasUnselectedOptionalePostfachempfanger="Dritter"===p),t[o].entry=h,t[o].anzeige=f,t[o].alleElpBrec=p,t[o].alleMifidRelevanz=Object.keys(a[t[o].personennr]),c={parameter:{label:f,enabled:l,value:"Dritter"!==p,group:"postfachempfaengergroup"},appData:t[o]},"Adressat"===p?l===!0?n.push(c):n.splice(0,0,c):p.indexOf("Adressat")>=0||p.indexOf("Verbundperson")>=0?l===!0?i.push(c):i.splice(0,0,c):s.push(c),this.postfachEmpfEntryMap[h]=[e])}},configureCheckBoxParameter:function(e,t){var n,i,r,a,s,l,o=[],u=[],d=[],h="";if(this.doksWithPostfach){for(this.postfachEmpfEntryMap={},this.allDocsHaveOnlyDritte=!0,i=0;i<this.doksWithPostfach.length;i++)r=this.doksWithPostfach[i].dokument.personenNr,s=this.doksWithPostfach[i].postfachempfList,""===h&&(h=r),this.internConfigureCheckBoxParameter(r,s,u,d,e,t,o);for(o.unshift.apply(o,d),o.unshift.apply(o,u),l=function(e){var t=function(t){this.internalZdbApi.orgMap[e+"#"+a.appData.persnr+"#"+t]=a.getValue()}.bind(this);a.appData.alleElpBrec.split(", ").forEach(t)}.bind(this),n=0;n<o.length;n++)a=document.TaoOSPM.ui.widgets.createCheckbox(o[n].parameter),a.appData=o[n].appData,a.appData.alleMifidRelevanz.forEach(l),this.resultPostfachempfaengerList.addElement(a)}},getMapOrArrayInhalt:function(e){var t,n="";return t=e&&Array.isArray(e)?e:[e],t.forEach(function(e){n+="{ ",Object.keys(e).forEach(function(t){n+=t+":"+e[t]+" "}),n+="}"}),n},abgleichFehlerLog:function(e,t,n,i,r,a,s){var l="[OrgMap: "+this.getMapOrArrayInhalt(this.internalZdbApi.orgMap)+"], [ChangeMap: "+this.getMapOrArrayInhalt(this.internalZdbApi.changeMap)+"], [Nachrichten: "+this.getMapOrArrayInhalt(i)+"]",o=e+", "+l;this.internalZdbApi.executeRequest("zdb.log",{errorLog:o},function(e){e.epoabgleichDisabled===!1&&this.abgleichFehler.push(t.appData),this.abgleichPostfach(n,i,r,a,s)}.bind(this))},abgleichPostfach:function(e,t,i,r,a){var s,l,o,u,d,h,c,g=!1,f=!1;if(0!==e.length){for(c=e.pop(),this.internalZdbApi.orgMap&&(h=Object.keys(this.internalZdbApi.orgMap)),"dokIdfehlt"===this.internalZdbApi.simAbgleichError&&h.pop(),s=0;s<h.length;s++){if(c.appData.dokument.documentID===h[s]&&(this.internalZdbApi.orgMap[h[s]]===!0&&(n.isNullOrUndefined(this.internalZdbApi.changeMap[h[s]])||this.internalZdbApi.changeMap[h[s]]===!0)||this.internalZdbApi.orgMap[h[s]]===!1&&!n.isNullOrUndefined(this.internalZdbApi.changeMap[h[s]])&&this.internalZdbApi.changeMap[h[s]]===!0))for(l=0;l<c.appData.postfachempfList.length;l++){for(o=0;o<t.length;o++){if("nachrichtenDokIDfehlt"===this.internalZdbApi.simAbgleichError&&(t[o].dokId=null),t[o].dokId===h[s]&&c.appData.postfachempfList[l].persnr===t[o].persNr)for(u=0;u<h.length;u++)if("nachrichtenPersnrFehlt"===this.internalZdbApi.simAbgleichError&&(t[o].persNr=null),t[o].mifidkz+"#"+t[o].persNr+"#"+t[o].elpbrec===h[u]&&(this.internalZdbApi.orgMap[h[u]]===!0&&(n.isNullOrUndefined(this.internalZdbApi.changeMap[h[u]])||this.internalZdbApi.changeMap[h[u]]===!0)||this.internalZdbApi.orgMap[h[u]]===!1&&!n.isNullOrUndefined(this.internalZdbApi.changeMap[h[u]])&&this.internalZdbApi.changeMap[h[u]]===!0)){f=!n.isNullOrUndefined(t[o].nachrichtenId),"nachrichtenIDfehlt"===this.internalZdbApi.simAbgleichError&&(f=!1),g=!0;break}if(g)break}if(g)break}if(g)break}g===!1?(d="Dokument "+c.appData.dokument.vorlagenName+" ("+c.appData.dokument.documentID+") ist nicht erfolgreich für Epostfach abgeglichen worden. [Postfachempfänger: "+this.getMapOrArrayInhalt(c.appData.postfachempfList)+"]",this.abgleichFehlerLog(d,c,e,t,i,r,a)):i?f===!0?(this.allMessages.push({code:2,msg:"Dokument "+c.appData.dokument.vorlagenName+" ("+c.appData.dokument.documentID+") wurde in das Elektronische Postfach weitergeleitet."}),this.abgleichPostfach(e,t,i,r,a)):(d="Für Dokument "+c.appData.dokument.vorlagenName+" ("+c.appData.dokument.documentID+") ist keine NachrichtenId erstellt worden. [Postfachempfänger: "+this.getMapOrArrayInhalt(c.appData.postfachempfList)+"]",this.abgleichFehlerLog(d,c,e,t,i,r,a)):this.abgleichPostfach(e,t,i,r,a)}else if(this.abgleichFehler.length>0){for(d="Fehlerhafte Dokumente: ",s=0;s<this.abgleichFehler.length;s++)d+="["+this.abgleichFehler[s].dokument.vorlagenName+" ("+this.abgleichFehler[s].dokument.documentID+"), Postfachempfänger: "+this.getMapOrArrayInhalt(this.abgleichFehler[s].postfachempfList)+"]";document.TaoOSPM.ui.progress.stop(this.spinnerId),this.internalZdbApi.messageVerarbeitung([{code:"8",msg:d}],"Fehler beim Abgleich der Daten für das Elektronische Postfach",this.allMessages,a)}else r&&r()},doCallDokumenteVerarbeiten:function(e,t,i,r,a){var s,l,o,u,d,h,c,g,f,p,m,E={},k=[],D={};if(e){for(E.AUTO_ELPO="true",E.epostfachMap=e,u=Object.keys(e),s=0;s<u.length;s++)for(d=u[s].split("#"),f=d[0].substring(7),g=d[1],p=d[2],h=e[u[s]],l=0;l<h.length;l++)m=h[l][0],D={dokId:m,persNr:p,elpbrec:g,mifidkz:f},k.push(D);t&&(E.BETREFF=t),this.useMitteilung===!0&&i&&(E.MITTEILUNG=i)}this.internalZdbApi.datgid&&(E.DATG_ID=this.internalZdbApi.datgid),r&&(E.MIFIDKZ=r),this.internalZdbApi.epoNachrichtenTyp&&(E.EPOSTFACHNACHRICHTENTYP=this.internalZdbApi.epoNachrichtenTyp),this.internalZdbApi.epoNachricht2FASchutz&&(E.EPOSTFACHNACHRICHT_2FA_SCHUTZ=this.internalZdbApi.epoNachricht2FASchutz),this.internalZdbApi.mifidAlleDokumenteEpoRelevant?E.MIFID_ALLE_DOKUMENTE_EPO_RELEVANT=this.internalZdbApi.mifidAlleDokumenteEpoRelevant:!n.isNullOrUndefined(this.internalZdbApi.mifidEpoRelevanteDokumente)&&this.internalZdbApi.mifidEpoRelevanteDokumente.length>0&&(E.MIFID_EPO_RELEVANTE_DOKUMENTE=this.internalZdbApi.mifidEpoRelevanteDokumente),c=function(){this.internalZdbApi.executeRequest("zdb.sendtoepostfachstationaer",E,function(e,t){var i,r,s;if(this.internalZdbApi.messageVerarbeitung(t,"Das Bereitstellen der Dokumente in das elektronische Postfach wurde abgebrochen.",this.allMessages,this.callback,this)){if(i=e.epostfachErfolgreich,k=e.nachrichten,"false"===i)this.allMessages.push({code:8,msg:"Dokumente wurden nicht in das Elektronische Postfach weitergeleitet."}),a&&a();else if(!n.isNullOrUndefined(k)){for(o=document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup").selectedElements(),r=0;r<o.length;r++)s=o[r].appData.dokument.vorlagenBezeichnung,this.selectedVorlagen.indexOf(s)<0&&this.selectedVorlagen.push(s);this.abgleichFehler=[],this.abgleichPostfach(o,k,!0,a,a)}}else a&&a(!1)}.bind(this))}.bind(this),o=document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup").selectedElements(),this.abgleichFehler=[],this.abgleichPostfach(o,k,!1,c,a)},fillPostfachString:function(e,t,i){var r,a,s,l,o,u,d="",h=t.personenNr,c=t.postfachMifidRelevant,g=function(){d.length>0&&(d+=", ")};for(a=0;a<e.length;a++)if(o=e[a].appData,u=this.postfachEmpfEntryMap[o.entry],!n.isNullOrUndefined(u)&&u.indexOf(h)>=0)for(r=0;r<this.allePostfachberechtigeList.length;r++)if(this.allePostfachberechtigeList[r].dokpersonennr===h&&this.allePostfachberechtigeList[r].mifidrelevant===c){if(!i)for(s=0;s<o.alleMifidRelevanz.length;s++)this.internalZdbApi.changeMap[o.alleMifidRelevanz[s]+"#"+o.persnr+"#"+o.elpbrec]=e[a].getValue();o.personennr===this.allePostfachberechtigeList[r].personennr&&(l=this.allePostfachberechtigeList[r].vorname+" "+this.allePostfachberechtigeList[r].name+" ("+this.allePostfachberechtigeList[r].elpbrec+")",-1===this.selectedEmpfaengerForWeiter.indexOf(this.allePostfachberechtigeList[r])&&this.selectedEmpfaengerForWeiter.push(this.allePostfachberechtigeList[r]),d.indexOf(l)<0&&(g(),d+=l))}return d},setPostfachempfaengerInList:function(e){var t,i,r,a,s,l,o=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").selectedElements(),u=this.resultList.getElements(),d=!0,h=!1,c=null,g=!1,f=0,p=this.useMitteilung?4:2,m=this.useMitteilung?3:1,E=function(){if(u[i].appData.dokument.postfachMifidRelevant)return!1;if(!n.isNullOrUndefined(this.selectedDruckDoks)&&this.selectedDruckDoks.length>0)for(r=0;r<this.selectedDruckDoks.length;r++)if(this.selectedDruckDoks[r].documentID===u[i].appData.dokument.documentID)return!0;if(!n.isNullOrUndefined(this.internalZdbApi.selDocsZentralerDruck)&&this.internalZdbApi.selDocsZentralerDruck.length>0)for(r=0;r<this.internalZdbApi.selDocsZentralerDruck.length;r++)if(this.internalZdbApi.selDocsZentralerDruck[r].documentID===u[i].appData.dokument.documentID)return!0;return!1}.bind(this);for(p=this.useAllSelektion?p+2:p,p=this.hasUnselectedOptionalePostfachempfanger?p+1:p,m=this.hasUnselectedOptionalePostfachempfanger?m+1:m,this.selectedEmpfaengerForWeiter=[],i=p;i<u.length;i++)u[i].setEnabled(!1),u[i].setValue(!0),n.isNullOrUndefined(u[i].appData)||(u[i].setEnabled(n.isNullOrUndefined(u[i].appData.dokument.pflichtKennzeichen)?!0:E()),this.allDocsHaveOnlyDritte===!0&&(e?(g=!1,this.allSelektion&&this.allSelektion.setEnabled(g)):0===o.length&&(c=[])),a=this.fillPostfachString(o,u[i].appData.dokument,e),a.length>0?(u[i].setSubLabel(a),u[i].isEnabled()&&f++):(u[i].setSubLabel(null),u[i].isEnabled()&&u[i].setValue(!1),u[i].setEnabled(!1)),e||(this.internalZdbApi.changeMap[u[i].appData.dokument.documentID]=u[i].getValue()));if(c=[],o.length>0)for(t=0;t<o.length;t++){for(s=o[t].appData,l=s.anzeige,h=!1,i=0;i<c.length;i++)if(c[i].label===l){h=!0;break}h||(c.push({label:l}),g=!0)}u[m].setValues(c),this.allSelektion&&(f>1?(this.allSelektion.setEnabled(!0),this.internalZdbApi.toogleSelection=g&&d,this.allSelektion.setValue(g&&d)):(this.allSelektion.setEnabled(!1),this.allSelektion.setValue(!1)))},closeFunctionPostfachempfDialog:function(){var e,t,n,i,r=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements(),a={};for(i=0;i<r.length;i++)a[i]=!1;for(n=0;n<this.selectedEmpfaengerForWeiter.length;n++)if(this.selectedEmpfaengerForWeiter[n])for(i=0;i<r.length;i++)r[i].isEnabled()?r[i].appData.entry===this.selectedEmpfaengerForWeiter[n].entry&&(a[i]=!0):a[i]=!0;
for(e=function(e){this.internalZdbApi.changeMap[r[i].appData.mifidrelevant?"MIFID#":"REGULAR#"+r[i].appData.persnr+"#"+e]=r[i].getValue()}.bind(this),i=0;i<r.length;i++)r[i].setValue(a[i]),t=r[i].appData.alleElpBrec.split(", "),t.forEach(e)},getPostfachempfDialogView:function(){var e=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Postfachempfänger auswählen",content:this.resultPostfachempfaengerList,cancelOnOutsideClick:!1,cancelButton:{label:"Abbrechen",action:function(){this.closeFunctionPostfachempfDialog(),e.hide()}.bind(this)},applyButton:{label:"OK",action:function(){var t,i,r,a,s;if(this.setPostfachempfaengerInList(!1),t="Weiter in Postfachempfaengerauswahl - ",this.internalZdbApi.changeMap&&(i=Object.keys(this.internalZdbApi.changeMap)),r=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements(),!n.isNullOrUndefined(i))for(a=0;a<r.length;a++)for(s=0;s<i.length;s++)if(i[s].indexOf(r[a].appData.persnr)>=0&&i[s].indexOf(r[a].appData.elpbrec)>=0&&this.internalZdbApi.orgMap[i[s]]!==this.internalZdbApi.changeMap[i[s]]){t+="["+r[a].appData.vorname+" "+r[a].appData.name+" ("+r[a].appData.personennr+", "+r[a].appData.elpbrec+") von "+this.internalZdbApi.orgMap[i[s]]+" nach "+this.internalZdbApi.changeMap[i[s]]+"]";break}this.internalZdbApi.executeRequest("zdb.log",{journalInfo:t}),e.hide()}.bind(this)}});return e.setCloseButton({action:function(){this.closeFunctionPostfachempfDialog(),e.hide()}.bind(this)}),e},doInternGetResultlist:function(){return this.parameter.INTERN_GET_RESULTLIST?(this.callback&&this.callback(this.selectedVorlagen?{vorlagennamen:this.selectedVorlagen,resultlist:this.doksWithPostfach,messages:this.allMessages,dokUrls:this.response.dokUrls,useNewSignatureWorkflow:this.internalZdbApi.useNewSignatureWorkflow,event:"weiter"}:{messages:this.allMessages,resultlist:this.doksWithPostfach,dokUrls:this.response.dokUrls,useNewSignatureWorkflow:this.internalZdbApi.useNewSignatureWorkflow,event:"weiter"}),!0):!1},doInternGetPostfachResultlist:function(e){return this.parameter.INTERN_GET_EPOSTFACHRESULTLIST?(this.callback&&(this.internalZdbApi.ispMode!==!0&&this.internalZdbApi.expressMode!==!0||this.hasOptionalePostfachempfanger!==!1?this.callback({resultlist:this.resultList,weiterFunktion:e,dokUrls:this.dokUrls,messages:this.allMessages,event:"resultlistreceived"}):(e&&e(),this.callback({event:"weiter",messages:this.allMessages}))),!0):!1},fillEPostfachMapAndCallService:function(e,t){var i,r,a,s,l,o,u,d,h,c,g,f,p,m=[],E={},k={},D={},b={},A={},I=!1;for(a=0;a<this.selectedEmpfaengerForWeiter.length;a++)for(s=0;s<this.allePostfachberechtigeList.length;s++)this.allePostfachberechtigeList[s].personennr===this.selectedEmpfaengerForWeiter[a].personennr&&this.allePostfachberechtigeList[s].elpbrec===this.selectedEmpfaengerForWeiter[a].elpbrec&&this.allePostfachberechtigeList[s].mifidrelevant===this.selectedEmpfaengerForWeiter[a].mifidrelevant&&(c=this.allePostfachberechtigeList[s].mifidrelevant?"MIFID":"REGULAR",d=c+"#"+this.allePostfachberechtigeList[s].elpbrec+"#"+this.allePostfachberechtigeList[s].personennr,k[d]=c+"#"+this.allePostfachberechtigeList[s].elpbrec+"#"+this.allePostfachberechtigeList[s].persnr,A[c]||(A[c]=c),b[this.allePostfachberechtigeList[s].elpbrec]||(b[this.allePostfachberechtigeList[s].elpbrec]=this.allePostfachberechtigeList[s].elpbrec),h=c+"#"+this.allePostfachberechtigeList[s].elpbrec+"#"+this.allePostfachberechtigeList[s].dokpersonennr,E[h]?E[h].push(d):E[h]=[d]);if(i=Object.keys(k),i.length>0)for(I=!0,s=0;s<i.length;s++){for(r=i[s],m=[],a=0;a<e.length&&(g=e[a].appData.dokument,I=!n.isNullOrUndefined(e[a].getSubLabel()),I);a++)for(f=Object.keys(b),p=Object.keys(A),l=0;l<p.length;l++)for(u=0;u<f.length;u++)if(d=p[l]+"#"+f[u]+"#"+g.personenNr,g&&g.personenNr&&E[d])for(o=0;o<E[d].length;o++)if(g.documentID&&E[d][o]===r&&(g.postfachMifidRelevant?p[l].indexOf("MIFID")>=0:p[l].indexOf("MIFID")<0)){m.push([g.documentID,g.vorlagenBezeichnung]);break}m.length>0&&k[r]&&(D["PERSNR_"+k[r]]=m)}Object.keys(D).length>0&&I?this.doCallDokumenteVerarbeiten(D,this.textelement?this.textelement.getValue():null,this.textarea?this.textarea.getValue():null,this.mitteilungArchivieren&&this.mitteilungArchivieren.getValue(),t):t(!1,!0)},unterbrecheWeiter:!1,fillResultList:function(e){this.unterbrecheWeiter=!1,this.textelement=document.TaoOSPM.ui.widgets.createTextInput({label:"Betreff",value:this.internalZdbApi.epostfachvorbelegung,maximumChars:80,enabled:this.internalZdbApi.ispMode===!1,type:"text",mandatory:!0,valuePlaceholder:"Bitte den Betreff für die Nachricht eingeben"}),this.resultList.addElement(this.textelement),this.postfempfIndex++,this.useMitteilung=this.internalZdbApi.ispMode&&!n.isNullOrUndefined(this.parameter.EPOSTFACHMITTEILUNG)&&this.parameter.EPOSTFACHMITTEILUNG.length>0||this.internalZdbApi.ispMode===!1,this.useMitteilung===!0?(this.textarea=document.TaoOSPM.ui.widgets.createTextareaInput({label:"Mitteilung",value:this.parameter.EPOSTFACHMITTEILUNG?this.parameter.EPOSTFACHMITTEILUNG:"",maximumChars:3e3,enabled:this.internalZdbApi.ispMode===!1,oneLine:!0,valuePlaceholder:"Bitte den Mitteilungstext für die Nachricht eingeben"}),this.internalZdbApi.ispMode===!1&&this.textarea.setValidator(function(e,t){var n,r;this.internalZdbApi.epfArchivBerechtigt&&(e&&t?(n=t.keyCode||t.charCode,r=t.charCode?t.target.value.substring(0,t.target.selectionStart)+String.fromCharCode(n)+t.target.value.substring(t.target.selectionEnd):n===i.KEYCODES.BACKSPACE?t.ctrlKey?t.target.value.substring(t.target.selectionStart):t.target.value.substring(0,t.target.selectionStart-1)+t.target.value.substring(t.target.selectionEnd):n===i.KEYCODES.DELETE?t.ctrlKey?t.target.value.substring(0,t.target.selectionStart):t.target.value.substring(0,t.target.selectionStart)+t.target.value.substring(t.target.selectionEnd+1):t.target.value,this.mitteilungArchivieren.setHidden((n===i.KEYCODES.BACKSPACE||n===i.KEYCODES.DELETE)&&r.length<1)):e&&(this.mitteilungArchivieren&&this.mitteilungArchivieren.isHidden()===!0&&this.textarea&&this.textarea.getValue().length>0&&(this.unterbrecheWeiter=!0),this.mitteilungArchivieren.setHidden(e.getValue().length<1)),this.mitteilungArchivieren.isHidden()===!0&&this.mitteilungArchivieren.setSelected("0"))}.bind(this)),this.resultList.addElement(this.textarea),this.postfempfIndex++,this.mitteilungArchivieren=document.TaoOSPM.ui.widgets.createDropdown({label:"Archivierung Mitteilung",elements:[],hidden:!(this.internalZdbApi.epfArchivBerechtigt&&this.textarea&&this.textarea.getValue().length>0)||this.internalZdbApi.ispMode,rightLabel:"Bitte wählen",mandatory:!0}),this.resultList.addElement(this.mitteilungArchivieren),this.postfempfIndex++,this.internalZdbApi.epfArchivBerechtigt&&this.internalZdbApi.ispMode===!1?document.TaoOSPM.server.getSVZData("ALI",null,function(t){t.length>0?(this.mitteilungArchivieren.setElements(document.TaoOSPM.ui.utils.convertSVZtoDropdown(t,"kurzbeschreibung")),this.mitteilungArchivieren.setSelected("0")):this.mitteilungArchivieren.setClickListener(function(){document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Diese Liste ist leer.",icon:"STANDARD_HINT_CIRCLE_M",text:"Es wurden keine Einträge vom Server geliefert.",okLabel:"OK"},function(){})}),e&&e()}.bind(this)):e&&e()):e&&e()},postfempfIndex:-1,start:function(){var e,t,i,r,a,s,l,o,u=[];this.doInternGetResultlist()||(s=this.getPostfachempfDialogView(),this.doksWithPostfach.length>0?this.fillResultList(function(){for(a=0;a<this.doksWithPostfach.length;a++)r=document.TaoOSPM.ui.widgets.createCheckbox({label:this.doksWithPostfach[a].dokument.vorlagenBezeichnung,infoText:n.isNullOrUndefined(this.doksWithPostfach[a].dokument.postfachMifidRelevant)?null:"MiFID",enabled:!0,value:!0,leftIcon:"DOCUMENT_PDF_M",group:"postfachdoksgroup"}),r.appData=this.doksWithPostfach[a],this.internalZdbApi.orgMap[this.doksWithPostfach[a].dokument.documentID]=r.getValue(),u.push(r);for(t=function(){s.show()},l=document.TaoOSPM.ui.widgets.createTextTable({label:"Empfänger",values:[]}),this.hasOptionalePostfachempfanger===!0&&(l.setRightIcon("drilldown"),l.setClickListener(t),this.hasUnselectedOptionalePostfachempfanger===!0&&(o=document.TaoOSPM.ui.widgets.createInfoText({formattedLabel:"Es gibt optionale Postfachempfänger, die Sie hinzufügen können.",showIcon:!0}),o.setBottomBorder(!1),this.resultList.addElement(o),this.postfempfIndex++)),this.resultList.addElement(l),this.postfempfIndex++,a=0;a<u.length;a++)this.resultList.addElement(u[a]);if(this.setPostfachempfaengerInList(!0),this.allSelektion=this.internalZdbApi.setAllSelectionRow(this.resultList,this.postfempfIndex+1,document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup"),this.allDocsHaveOnlyDritte,"Alle auswählen",this.internalZdbApi.changeMap),this.useAllSelektion=!n.isNullOrUndefined(this.allSelektion),e=function(){var e,t,r,s,l,o,u=document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup").selectedElements(),d=document.TaoOSPM.ui.checkInput(!0,this.resultList),h=null,c=null;if(this.spinnerId=null,this.unterbrecheWeiter)return void(this.unterbrecheWeiter=!1);if(l="Weiter in Postfachweiterleitung - ",this.internalZdbApi.changeMap&&(o=Object.keys(this.internalZdbApi.changeMap)),!n.isNullOrUndefined(o))for(s=document.TaoOSPM.ui.getSelectionGroup("postfachdoksgroup").getElements(),t=0;t<s.length;t++)for(a=0;a<o.length;a++)if(s[t].appData.dokument.documentID===o[a]&&this.internalZdbApi.orgMap[o[a]]!==this.internalZdbApi.changeMap[o[a]]){l+="["+s[t].appData.dokument.vorlagenName+" ("+s[t].appData.dokument.documentID+") von "+this.internalZdbApi.orgMap[o[a]]+" nach "+this.internalZdbApi.changeMap[o[a]]+"]";break}this.internalZdbApi.executeRequest("zdb.log",{journalInfo:l}),c=function(){var e=function(e,t){var r=!0;n.isNullOrUndefined(e)||(r=e),document.TaoOSPM.ui.progress.stop(this.spinnerId),i&&!t&&i.hide(),this.finishFunc&&r?this.finishFunc(this.allMessages,!0):t&&document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Elektronisches Postfach",icon:"STANDARD_HINT_CIRCLE_M",text:"Es gibt MiFID-Dokumente ohne Postfachempfänger.<br>Ohne eine Zuordnung von Postfachempfängern können sie nicht fortsetzen.",okLabel:"OK"},function(){})}.bind(this);u&&u.length>0?null===d?(this.spinnerId=document.TaoOSPM.ui.progress.start({timeout:this.internalZdbApi.busyviewtimeout}),this.textelement&&this.textelement.getValue().length>0?(this.doksWithPostfach.length>0&&(u.length>0||this.selectedEmpfaengerForWeiter&&this.selectedEmpfaengerForWeiter.length>0)?document.TaoOSPM.ui.progress.update({label:"Dokumentenverarbeitung",sublabel:"Die Dokumente werden in das Elektronische Postfach eingestellt."},this.spinnerId):document.TaoOSPM.ui.progress.update({label:"",sublabel:""},this.spinnerId),u.length>0?this.fillEPostfachMapAndCallService(u,e):e&&e(!0)):e&&e(!0)):this.internalZdbApi.executeRequest("zdb.log",{errorLog:"Kein Postfach möglich: checkInput liefert Objekt "+d.getClassName()+" ("+d.getLabel()+")"}):(i&&i.hide(),this.finishFunc&&this.finishFunc(this.allMessages,!0))}.bind(this),n.isNullOrUndefined(u)||this.doksWithPostfach.length!==u.length?(h=function(){for(e=0;e<this.doksWithPostfach.length;e++){if(r=!0,!n.isNullOrUndefined(u))for(t=0;t<u.length;t++)if(this.doksWithPostfach[e].dokument.documentID===u[t].appData.dokument.documentID){r=!1;break}r&&this.internalZdbApi.executeRequest("zdb.log",{journalInfoAndFP:"Dokument "+this.doksWithPostfach[e].dokument.vorlagenName+" ("+this.doksWithPostfach[e].dokument.documentID+") wurde nicht in das Elektronische Postfach eingestellt."})}c()}.bind(this),document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Elektronisches Postfach",icon:"STANDARD_INFORMATION_CIRCLE_M",text:"Die von Ihnen abgewählten Dokumente werden nicht in das Elektronische Postfach eingestellt. Möchten Sie den Prozess ohne Einstellen dieser Dokumente fortsetzen?"},h,function(){})):c()}.bind(this),!this.doInternGetPostfachResultlist(e)){if((this.internalZdbApi.ispMode===!0||this.internalZdbApi.expressMode===!0)&&this.hasOptionalePostfachempfanger===!1)return void(e&&(this.internalZdbApi.ispMode===!1&&(this.mitteilungArchivieren&&this.mitteilungArchivieren.setMandatory(!1),this.textelement&&this.textelement.setMandatory(!1)),e()));i=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Bereitstellung Elektronisches Postfach",content:this.resultList,cancelOnOutsideClick:!1,mandatory:!0,maximizeHeight:this.internalZdbApi.useNewSignatureWorkflow,maximizeWidth:this.internalZdbApi.useNewSignatureWorkflow,applyButton:{label:"Weiter",action:e}}),i.show()}}.bind(this)):this.parameter.INTERN_GET_EPOSTFACHRESULTLIST?(this.finishFunc&&this.finishFunc(this.allMessages,!0),this.callback&&this.callback({dokUrls:this.dokUrls,event:"resultlistreceived"})):this.finishFunc&&this.finishFunc(this.allMessages,!0))}},!0);return r}),define("zdb/common/EPOController",["tao/lib/stapes","tao/ospm/common/Logger","tao/ospm/common/Toolkit","tao/ospm/common/Constants"],function(e,t,n,i){var r=e.subclass({log:null,spinnerId:null,internalZdbApi:null,parameter:null,callback:null,changeFunc:null,response:null,allMessages:null,allePostfachberechtigeList:null,doksWithPostfach:null,resultPostfachempfaengerList:null,hasOptionalePostfachempfanger:!1,hasUnselectedOptionalePostfachempfanger:!1,allDocsHaveOnlyDritte:!1,selectedEmpfaengerForWeiter:[],postfachEmpfEntryMap:{},useMitteilung:!1,betreffElement:null,mitteilungsElement:null,mitteilungArchivieren:null,abgleichFehler:[],postfachempfaengerDialogView:null,epoChangeMap:[],epoOrgMap:[],resultList:null,betreffMitteilungList:null,constructor:function(e){var n,r={},a={};for(this.log=new t("zdb","EPOController: init EPOController"),this.internalZdbApi=document.ZdbOSPM.api.internalZdbApi,this.parameter=this.internalZdbApi.parameter,this.response=this.internalZdbApi.mainResponse,this.doksWithPostfach=[],this.changeFunc=e,this.resultPostfachempfaengerList=document.TaoOSPM.ui.widgets.createList(),this.resultList=document.TaoOSPM.ui.widgets.createSubList({headerWidget:document.TaoOSPM.ui.widgets.createText({label:"Postfachempfänger",rightIcon:"plus"}),collapsible:!0,listStyle:i.LIST_STYLES.NONE}),this.betreffMitteilungList=document.TaoOSPM.ui.widgets.createList(),this.betreffElement=null,this.mitteilungsElement=null,this.epoChangeMap={},this.epoOrgMap={},this.allMessages=[],n=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements();n.length>0;)document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").removeElement(n[0]);document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements().length=0,this.response&&this.response.dokumente&&(this.allePostfachberechtigeList=this.response.postfachberechtigte,this.fillDoksForPostfach(r,a),this.configureCheckBoxParameter(r,a),this.postfachempfaengerDialogView=this.getPostfachempfDialogView())},fillDoksForPostfach:function(e,t){var n,i,r,a,s;for(n=0;n<this.response.dokumente.length;n++)if(s=[],a=this.response.dokumente[n],this.allePostfachberechtigeList&&"1"===a.postfachKennzeichen){for(this.log.info("Postfachberechtigt:"),i=0;i<this.allePostfachberechtigeList.length;i++)r=this.allePostfachberechtigeList[i].personennr,void 0===t[r]&&(t[r]={}),t[r][this.allePostfachberechtigeList[i].mifidrelevant?"MIFID":"REGULAR"]="",void 0===e[r]&&(e[r]={}),e[r][this.allePostfachberechtigeList[i].elpbrec]="",this.allePostfachberechtigeList[i].dokpersonennr===a.personenNr&&this.allePostfachberechtigeList[i].mifidrelevant===a.postfachMifidRelevant&&s.push(this.allePostfachberechtigeList[i]);this.doksWithPostfach.push({dokument:a,postfachempfList:s})}},internConfigureCheckBoxParameter:function(e,t,n,i,r,a,s){var l,o,u,d,h,c,g,f,p,m=!0,E=!1,k=!0;for(o=0;o<t.length;o++)E=E===!1?"Adressat"===t[o].elpbrec:!0,k=k===!0?"Dritter"===t[o].elpbrec:!1;for(this.allDocsHaveOnlyDritte=this.allDocsHaveOnlyDritte===!0?k:!1,o=0;o<t.length;o++){if(p="","Dritter"===t[o].elpbrec)p="Dritter",g=["Dritter"];else for(g=Object.keys(r[t[o].personennr]).sort(),u=0;u<g.length;u++)if("Dritter"!==g[u]&&(p+=g[u],u<g.length-1))for(d=u+1;d<g.length;d++)if("Dritter"!==g[d]){p+=", ";break}f=t[o].vorname+" "+t[o].name+" ("+p+")",h=f+", "+t[o].personennr,this.postfachEmpfEntryMap[h]?this.postfachEmpfEntryMap[h].push(e):(l=!0,k===!1&&(m===!0||g.length>1)&&(1===t.length?(l=!1,m=!1):E===!0&&p.indexOf("Adressat")>=0?(l=!1,m=!1):E===!1&&p.indexOf("Verbundperson")>=0&&(l=!1)),this.hasOptionalePostfachempfanger===!1&&(this.hasOptionalePostfachempfanger=l),this.hasUnselectedOptionalePostfachempfanger===!1&&(this.hasUnselectedOptionalePostfachempfanger="Dritter"===p),t[o].entry=h,t[o].anzeige=f,t[o].alleElpBrec=p,t[o].alleMifidRelevanz=Object.keys(a[t[o].personennr]),c={parameter:{label:f,enabled:l,value:"Dritter"!==p,group:"postfachempfaengergroup"},appData:t[o]},"Adressat"===p?l===!0?n.push(c):n.splice(0,0,c):p.indexOf("Adressat")>=0||p.indexOf("Verbundperson")>=0?l===!0?i.push(c):i.splice(0,0,c):s.push(c),this.postfachEmpfEntryMap[h]=[e])}},configureCheckBoxParameter:function(e,t){var n,i,r,a,s,l,o=[],u=[],d=[],h="";if(this.doksWithPostfach){for(this.postfachEmpfEntryMap={},this.allDocsHaveOnlyDritte=!0,i=0;i<this.doksWithPostfach.length;i++)r=this.doksWithPostfach[i].dokument.personenNr,s=this.doksWithPostfach[i].postfachempfList,""===h&&(h=r),this.internConfigureCheckBoxParameter(r,s,u,d,e,t,o);for(o.unshift.apply(o,d),o.unshift.apply(o,u),l=function(e){var t=function(t){this.epoOrgMap[e+"#"+a.appData.persnr+"#"+t]=a.getValue()}.bind(this);a.appData.alleElpBrec.split(", ").forEach(t)}.bind(this),n=0;n<o.length;n++)a=document.TaoOSPM.ui.widgets.createCheckbox(o[n].parameter),a.appData=o[n].appData,a.appData.alleMifidRelevanz.forEach(l),this.resultPostfachempfaengerList.addElement(a)}},doCallDokumenteVerarbeiten:function(e,t,i,r,a){var s,l,o,u,d,h,c,g,f,p,m,E={},k=[],D=[],b={};if(e){for(E.AUTO_ELPO="true",E.epostfachMap=e,u=Object.keys(e),l=0;l<u.length;l++)for(d=u[l].split("#"),g=d[0].substring(7),f=d[1],p=d[2],h=e[u[l]],o=0;o<h.length;o++)m=h[o][0],b={dokId:m,persNr:p,elpbrec:f,mifidkz:g},D.push(b);t&&(E.BETREFF=t),this.useMitteilung===!0&&i&&(E.MITTEILUNG=i)}for(this.internalZdbApi.datgid&&(E.DATG_ID=this.internalZdbApi.datgid),r&&(E.MIFIDKZ=r),this.internalZdbApi.epoNachrichtenTyp&&(E.EPOSTFACHNACHRICHTENTYP=this.internalZdbApi.epoNachrichtenTyp),this.internalZdbApi.epoNachricht2FASchutz&&(E.EPOSTFACHNACHRICHT_2FA_SCHUTZ=this.internalZdbApi.epoNachricht2FASchutz),this.internalZdbApi.mifidAlleDokumenteEpoRelevant?E.MIFID_ALLE_DOKUMENTE_EPO_RELEVANT=this.internalZdbApi.mifidAlleDokumenteEpoRelevant:!n.isNullOrUndefined(this.internalZdbApi.mifidEpoRelevanteDokumente)&&this.internalZdbApi.mifidEpoRelevanteDokumente.length>0&&(E.MIFID_EPO_RELEVANTE_DOKUMENTE=this.internalZdbApi.mifidEpoRelevanteDokumente),c=function(){this.internalZdbApi.executeRequest("zdb.sendtoepostfachstationaer",E,function(e,t){var i;if(this.internalZdbApi.messageVerarbeitung(t,"Das Bereitstellen der Dokumente in das elektronische Postfach wurde abgebrochen.",this.allMessages,this.callback,this)){if(i=e.epostfachErfolgreich,D=e.nachrichten,"false"===i)this.allMessages.push({code:8,msg:"Dokumente wurden nicht in das Elektronische Postfach weitergeleitet."}),a&&a();else if(!n.isNullOrUndefined(D)){for(k=[],s=0;s<this.internalZdbApi.docsForEPO.length;s++)for(l=0;l<this.doksWithPostfach.length;l++)this.internalZdbApi.docsForEPO[s].documentID===this.doksWithPostfach[l].dokument.documentID&&k.push(this.doksWithPostfach[l]);this.abgleichFehler=[],this.abgleichPostfach(k,D,!0,a,a)}}else a&&a(!1)}.bind(this))}.bind(this),k=[],s=0;s<this.internalZdbApi.docsForEPO.length;s++)for(l=0;l<this.doksWithPostfach.length;l++)this.internalZdbApi.docsForEPO[s].documentID===this.doksWithPostfach[l].dokument.documentID&&k.push(this.doksWithPostfach[l]);this.abgleichFehler=[],this.abgleichPostfach(k,D,!1,c,a)},getMapOrArrayInhalt:function(e){var t,n="";return t=e&&Array.isArray(e)?e:[e],t.forEach(function(e){n+="{ ",Object.keys(e).forEach(function(t){n+=t+":"+e[t]+" "}),n+="}"}),n},abgleichFehlerLog:function(e,t,n,i,r,a,s){var l="[OrgMap: "+this.getMapOrArrayInhalt(this.epoOrgMap)+"], [ChangeMap: "+this.getMapOrArrayInhalt(this.epoChangeMap)+"], [Nachrichten: "+this.getMapOrArrayInhalt(i)+"]",o=e+", "+l;this.internalZdbApi.executeRequest("zdb.log",{errorLog:o},function(e){e.epoabgleichDisabled===!1&&this.abgleichFehler.push(t),this.abgleichPostfach(n,i,r,a,s)}.bind(this))},abgleichPostfach:function(e,t,i,r,a){var s,l,o,u,d,h,c,g,f=!1,p=!1;if(0!==e.length){for(g=e.pop(),this.internalZdbApi.orgMap&&(h=Object.keys(this.internalZdbApi.orgMap)),this.epoOrgMap&&(c=Object.keys(this.epoOrgMap)),"dokIdfehlt"===this.internalZdbApi.simAbgleichError&&h.pop(),s=0;s<h.length;s++){if(g.dokument.documentID===h[s]&&(this.internalZdbApi.orgMap[h[s]].indexOf("epo")>=0&&n.isNullOrUndefined(this.internalZdbApi.changeMap[h[s]])||!n.isNullOrUndefined(this.internalZdbApi.changeMap[h[s]])&&this.internalZdbApi.changeMap[h[s]].indexOf("epo")>=0))for(l=0;l<g.postfachempfList.length;l++){for(o=0;o<t.length;o++){if("nachrichtenDokIDfehlt"===this.internalZdbApi.simAbgleichError&&(t[o].dokId=null),t[o].dokId===h[s]&&g.postfachempfList[l].persnr===t[o].persNr)for(u=0;u<c.length;u++)if("nachrichtenPersnrFehlt"===this.internalZdbApi.simAbgleichError&&(t[o].persNr=null),t[o].mifidkz+"#"+t[o].persNr+"#"+t[o].elpbrec===c[u]&&(this.epoOrgMap[c[u]]===!0&&(n.isNullOrUndefined(this.epoChangeMap[c[u]])||this.epoChangeMap[c[u]]===!0)||this.epoOrgMap[c[u]]===!1&&!n.isNullOrUndefined(this.epoChangeMap[c[u]])&&this.epoChangeMap[c[u]]===!0)){p=!n.isNullOrUndefined(t[o].nachrichtenId),"nachrichtenIDfehlt"===this.internalZdbApi.simAbgleichError&&(p=!1),f=!0;break}if(f)break}if(f)break}if(f)break}f===!1?(d="Dokument "+g.dokument.vorlagenName+" ("+g.dokument.documentID+") ist nicht erfolgreich für Epostfach abgeglichen worden. [Postfachempfänger: "+this.getMapOrArrayInhalt(g.postfachempfList)+"]",this.abgleichFehlerLog(d,g,e,t,i,r,a)):i?p===!0?(this.allMessages.push({code:2,msg:"Dokument "+g.dokument.vorlagenName+" ("+g.dokument.documentID+") wurde in das Elektronische Postfach weitergeleitet."}),this.abgleichPostfach(e,t,i,r,a)):(d="Für Dokument "+g.dokument.vorlagenName+" ("+g.dokument.documentID+") ist keine NachrichtenId erstellt worden. [Postfachempfänger: "+this.getMapOrArrayInhalt(g.postfachempfList)+"]",this.abgleichFehlerLog(d,g,e,t,i,r,a)):this.abgleichPostfach(e,t,i,r,a)}else if(this.abgleichFehler.length>0){for(d="Fehlerhafte Dokumente: ",s=0;s<this.abgleichFehler.length;s++)d+="["+this.abgleichFehler[s].dokument.vorlagenName+" ("+this.abgleichFehler[s].dokument.documentID+"), Postfachempfänger: "+this.getMapOrArrayInhalt(this.abgleichFehler[s].postfachempfList)+"]";document.TaoOSPM.ui.progress.stop(this.spinnerId),this.internalZdbApi.messageVerarbeitung([{code:"8",msg:d}],"Fehler beim Abgleich der Daten für das Elektronische Postfach",this.allMessages,a)}else r&&r()},istUnterbrecheWeiterAndReset:function(){var e=this.unterbrecheWeiter;return this.unterbrecheWeiter=!1,e},setPostfachempfaengerInList:function(e){var t,n,i,r,a=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").selectedElements(),s=this.resultList.getElements(),l=!1,o=null;if(a&&(this.allDocsHaveOnlyDritte===!1||a.length>0)){if(this.selectedEmpfaengerForWeiter=this.fillSelectedEmpfaengerForWeiter(a,"init"===e),a.length>0)for(o=[],t=0;t<a.length;t++){for(i=a[t].appData,r=i.anzeige,l=!1,n=0;n<o.length;n++)if(o[n].label===r){l=!0;break}l||o.push({label:r})}null!==o&&s[this.postfempfIndex].setValues(o),this.selectedEmpfaengerForWeiter.length>0&&"extern"!==e&&this.changeFunc(this.selectedEmpfaengerForWeiter)}else s[this.postfempfIndex].setValues([]),this.changeFunc(this.selectedEmpfaengerForWeiter)},fillSelectedEmpfaengerForWeiter:function(e,t){var n,i,r,a,s=!1;for(this.selectedEmpfaengerForWeiter=[],i=0;i<e.length;i++){for(a=e[i].appData,n=0;n<this.allePostfachberechtigeList.length;n++)if(a.personennr===this.allePostfachberechtigeList[n].personennr&&a.mifidrelevant===this.allePostfachberechtigeList[n].mifidrelevant){s=!0,-1===this.selectedEmpfaengerForWeiter.indexOf(a)&&this.selectedEmpfaengerForWeiter.push(a);break}for(r=0;r<a.alleMifidRelevanz.length;r++)t?this.epoOrgMap[a.alleMifidRelevanz[r]+"#"+a.persnr+"#"+a.elpbrec]=s:this.epoChangeMap[a.alleMifidRelevanz[r]+"#"+a.persnr+"#"+a.elpbrec]=s}return this.selectedEmpfaengerForWeiter},closeFunctionPostfachempfDialog:function(){var e,t,n,i,r=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements(),a={};for(i=0;i<r.length;i++)a[i]=!1;for(n=0;n<this.selectedEmpfaengerForWeiter.length;n++)if(this.selectedEmpfaengerForWeiter[n])for(i=0;i<r.length;i++)r[i].isEnabled()?r[i].appData.entry===this.selectedEmpfaengerForWeiter[n].entry&&(a[i]=!0):a[i]=!0;for(e=function(e){this.epoChangeMap[r[i].appData.mifidrelevant?"MIFID#":"REGULAR#"+r[i].appData.persnr+"#"+e]=r[i].getValue()}.bind(this),i=0;i<r.length;i++)r[i].setValue(a[i]),t=r[i].appData.alleElpBrec.split(", "),t.forEach(e)},getPostfachempfDialogView:function(){return this.postfachempfaengerDialogView=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Postfachempfänger auswählen",content:this.resultPostfachempfaengerList,cancelOnOutsideClick:!1,cancelButton:{label:"Abbrechen",action:function(){this.closeFunctionPostfachempfDialog(),this.postfachempfaengerDialogView.hide()}.bind(this)},applyButton:{label:"OK",action:function(){var e,t,i,r,a;if(this.setPostfachempfaengerInList("change"),e="Weiter in Postfachempfaengerauswahl - ",this.epoChangeMap&&(t=Object.keys(this.epoChangeMap)),i=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements(),!n.isNullOrUndefined(t))for(r=0;r<i.length;r++)for(a=0;a<t.length;a++)if(t[a].indexOf(i[r].appData.persnr)>=0&&t[a].indexOf(i[r].appData.elpbrec)>=0&&this.epoOrgMap[t[a]]!==this.epoChangeMap[t[a]]){e+="["+i[r].appData.vorname+" "+i[r].appData.name+" ("+i[r].appData.personennr+", "+i[r].appData.elpbrec+") von "+this.epoOrgMap[t[a]]+" nach "+this.epoChangeMap[t[a]]+"]";break}this.internalZdbApi.executeRequest("zdb.log",{journalInfo:e}),this.postfachempfaengerDialogView.hide()}.bind(this)}}),this.postfachempfaengerDialogView.setCloseButton({action:function(){this.closeFunctionPostfachempfDialog(),this.postfachempfaengerDialogView.hide()}.bind(this)}),this.postfachempfaengerDialogView},fillEPostfachMapAndCallService:function(e,t){var n,i,r,a,s,l,o,u,d,h,c,g,f,p,m=[],E={},k={},D={},b={},A={};for(r=0;r<this.selectedEmpfaengerForWeiter.length;r++)for(a=0;a<this.allePostfachberechtigeList.length;a++)this.allePostfachberechtigeList[a].personennr===this.selectedEmpfaengerForWeiter[r].personennr&&this.allePostfachberechtigeList[a].elpbrec===this.selectedEmpfaengerForWeiter[r].elpbrec&&this.allePostfachberechtigeList[a].mifidrelevant===this.selectedEmpfaengerForWeiter[r].mifidrelevant&&(h=this.allePostfachberechtigeList[a].mifidrelevant?"MIFID":"REGULAR",u=h+"#"+this.allePostfachberechtigeList[a].elpbrec+"#"+this.allePostfachberechtigeList[a].personennr,k[u]=h+"#"+this.allePostfachberechtigeList[a].elpbrec+"#"+this.allePostfachberechtigeList[a].persnr,A[h]||(A[h]=h),b[this.allePostfachberechtigeList[a].elpbrec]||(b[this.allePostfachberechtigeList[a].elpbrec]=this.allePostfachberechtigeList[a].elpbrec),d=h+"#"+this.allePostfachberechtigeList[a].elpbrec+"#"+this.allePostfachberechtigeList[a].dokpersonennr,E[d]?E[d].push(u):E[d]=[u]);for(n=Object.keys(k),a=0;a<n.length;a++){for(i=n[a],m=[],r=0;r<e.length;r++)for(c=e[r],g=Object.keys(b),f=Object.keys(A),s=0;s<f.length;s++)for(o=0;o<g.length;o++)if(u=f[s]+"#"+g[o]+"#"+c.personenNr,c&&c.personenNr&&E[u])for(l=0;l<E[u].length;l++)if(c.documentID&&E[u][l]===i&&(c.postfachMifidRelevant?f[s].indexOf("MIFID")>=0:f[s].indexOf("MIFID")<0)){m.push([c.documentID,c.vorlagenBezeichnung]);break}p=null,a===n.length-1&&(p=t),m.length>0&&k[i]&&(D["PERSNR_"+k[i]]=m)}D&&this.doCallDokumenteVerarbeiten(D,this.betreffElement?this.betreffElement.getValue():null,this.mitteilungsElement?this.mitteilungsElement.getValue():null,this.mitteilungArchivieren&&this.mitteilungArchivieren.getValue(),p)},unterbrecheWeiter:!1,postfempfIndex:-1,fillResultList:function(){var e,t,n=function(e){var t,n;n=document.TaoOSPM.ui.widgets.createList(),n.addElement(document.TaoOSPM.ui.widgets.createText({label:e})),t=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Diese Liste ist leer.",cancelOnOutsideClick:!0}),t.setContent(n),t.show()};this.unterbrecheWeiter=!1,this.hasUnselectedOptionalePostfachempfanger===!0&&(t=document.TaoOSPM.ui.widgets.createInfoText({formattedLabel:"Es gibt optionale Postfachempfänger, die Sie hinzufügen können.",showIcon:!0}),t.setBottomBorder(!1),this.resultList.addElement(t),this.postfempfIndex++),this.betreffElement=document.TaoOSPM.ui.widgets.createTextInput({label:"Betreff",value:this.internalZdbApi.epostfachvorbelegung,maximumChars:80,enabled:this.internalZdbApi.ispMode===!1,type:"text",mandatory:!0,valuePlaceholder:"Bitte den Betreff für die Nachricht eingeben"}),this.betreffMitteilungList.addElement(this.betreffElement),this.useMitteilung=this.internalZdbApi.ispMode===!1,this.useMitteilung===!0&&(this.mitteilungsElement=document.TaoOSPM.ui.widgets.createTextareaInput({label:"Mitteilung",value:this.parameter.EPOSTFACHMITTEILUNG?this.parameter.EPOSTFACHMITTEILUNG:"",maximumChars:3e3,oneLine:!0,valuePlaceholder:"Bitte den Mitteilungstext für die Nachricht eingeben"}),this.mitteilungsElement.setValidator(function(e,t){var n,r;this.internalZdbApi.epfArchivBerechtigt&&(e&&t?(n=t.keyCode||t.charCode,r=t.charCode?t.target.value.substring(0,t.target.selectionStart)+String.fromCharCode(n)+t.target.value.substring(t.target.selectionEnd):n===i.KEYCODES.BACKSPACE?t.ctrlKey?t.target.value.substring(t.target.selectionStart):t.target.value.substring(0,t.target.selectionStart-1)+t.target.value.substring(t.target.selectionEnd):n===i.KEYCODES.DELETE?t.ctrlKey?t.target.value.substring(0,t.target.selectionStart):t.target.value.substring(0,t.target.selectionStart)+t.target.value.substring(t.target.selectionEnd+1):t.target.value,this.mitteilungArchivieren.setHidden((n===i.KEYCODES.BACKSPACE||n===i.KEYCODES.DELETE)&&r.length<1)):e&&(this.internalZdbApi.epfArchivBerechtigt&&this.mitteilungArchivieren&&this.mitteilungArchivieren.isHidden()===!0&&this.mitteilungsElement&&this.mitteilungsElement.getValue().length>0&&(this.unterbrecheWeiter=!0),this.mitteilungArchivieren.setHidden(e.getValue().length<1)),this.mitteilungArchivieren.isHidden()===!0&&this.mitteilungArchivieren.setSelected("0"))}.bind(this)),this.betreffMitteilungList.addElement(this.mitteilungsElement),this.mitteilungArchivieren=document.TaoOSPM.ui.widgets.createDropdown({label:"Archivierung Mitteilung",hidden:!(this.internalZdbApi.epfArchivBerechtigt&&this.textarea&&this.textarea.getValue().length>0),rightLabel:"Bitte wählen",mandatory:!0}),this.betreffMitteilungList.addElement(this.mitteilungArchivieren),document.TaoOSPM.server.getSVZData("ALI",null,function(e){e.length>0?(this.mitteilungArchivieren.setElements(document.TaoOSPM.ui.utils.convertSVZtoDropdown(e,"kurzbeschreibung")),this.mitteilungArchivieren.setSelected("0")):this.mitteilungArchivieren.setClickListener(function(){n("Es wurden keine Einträge vom Server geliefert.")})}.bind(this))),e=document.TaoOSPM.ui.widgets.createTextTable({label:null,values:[]}),this.hasOptionalePostfachempfanger===!0&&(e.setRightIcon("drilldown"),e.setClickListener(function(){this.postfachempfaengerDialogView.show()}.bind(this))),this.resultList.addElement(e),this.postfempfIndex++},getPostfachResultlist:function(){return 0===this.resultList.elementCount()&&this.doksWithPostfach.length>0&&(this.fillResultList(),this.setPostfachempfaengerInList("init")),this.resultList},getPostfachBetreffMitteilungList:function(){return 0===this.betreffMitteilungList.elementCount()&&this.doksWithPostfach.length>0&&(this.fillResultList(),this.setPostfachempfaengerInList("init")),this.betreffMitteilungList},stelleDokumenteInsEpo:function(e,t){var i,r,a,s=this.internalZdbApi.docsForEPO,l=document.TaoOSPM.ui.getSelectionGroup("druckdokgroup").selectedElements();
this.callback=e,this.spinnerId=null,this.unterbrecheWeiter=!1,n.isNullOrUndefined(t)||t.forEach(function(e){this.allMessages.push(e)}.bind(this)),(i=function(){var e=[],t=!1,i=document.TaoOSPM.ui.checkInput(!0,this.resultList),o=function(e){var t=!0;n.isNullOrUndefined(e)||(t=e),s.length<5&&this.internalZdbApi.sleepFor(500*(5-s.length)),document.TaoOSPM.ui.progress.stop(this.spinnerId),this.callback&&t&&this.callback(this.allMessages)}.bind(this);if(s&&s.length>0){if(this.internalZdbApi.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK===!0){for(r=0;r<s.length;r++){for(t=!1,a=0;a<l.length;a++)if(l[a].appData.documentID===s[r].documentID){t=!0;break}t||e.push(s[r])}s=e,this.internalZdbApi.docsForEPO=s}if(null===i&&s.length>0)return this.spinnerId=document.TaoOSPM.ui.progress.start({timeout:this.internalZdbApi.busyviewtimeout}),void(this.betreffElement&&this.betreffElement.getValue().length>0?(this.doksWithPostfach.length>0&&(s.length>0||this.selectedEmpfaengerForWeiter&&this.selectedEmpfaengerForWeiter.length>0)?document.TaoOSPM.ui.progress.update({label:"Dokumentenverarbeitung",sublabel:s.length+(1===s.length?" Dokument wird":" Dokumente werden")+" in das Elektronische Postfach eingestellt."},this.spinnerId):document.TaoOSPM.ui.progress.update({label:"",sublabel:""},this.spinnerId),this.selectedEmpfaengerForWeiter&&this.selectedEmpfaengerForWeiter.length>0?this.fillEPostfachMapAndCallService(s,o):o&&o(!0)):o&&o(!0))}this.callback&&(n.isNullOrUndefined(i)||this.internalZdbApi.executeRequest("zdb.log",{errorLog:"Kein Postfach möglich: checkInput liefert Objekt "+i.getClassName()+" ("+i.getLabel()+")"}),this.callback(this.allMessages))}.bind(this))()}},!0);return r}),define("zdb/common/MessageController",["tao/lib/stapes","tao/ospm/common/Toolkit","tao/ospm/common/Logger"],function(e,t,n){var i=e.subclass({log:null,getMessageArrayAbCode2:function(e){var t=[];return e&&Array.isArray(e)&&e.forEach(function(e){e.code>=2&&t.push(e)}),t},messageVerarbeitung:function(e,i,r,a){var s,l,o,u,d,h,c=document.TaoOSPM.session.environment.isInternetFiliale(),g=!0,f=0,p=[];return e&&(t.isNullOrUndefined(this.log)&&(this.log=new n("zdb","messageVerarbeitung")),Array.isArray(e)&&e.forEach(function(e){e.code>=2&&e.code<=4?(document.TaoOSPM.session.messages.add(e),this.log.warning(e.msg)):e.code>=8&&e.code<=16&&(this.log.error(e.msg),g=!1,f<e.code&&(f=e.code))}.bind(this)),g===!1&&(l=function(){if(a){for(s=this.getMessageArrayAbCode2(e),u=this.getMessageArrayAbCode2(r),d=0;d<u.length;d++)s.push(u[d]);a({messages:s,event:"fehler"})}}.bind(this),c?(o="",p=[{type:document.TaoOSPM.ui.constants.DIALOG_ERROR_TYPE.BEENDEN,callback:l}]):8===f?(o="Es ist ein Fehler aufgetreten",p=[{type:document.TaoOSPM.ui.constants.DIALOG_ERROR_TYPE.ABLEGEN},{type:document.TaoOSPM.ui.constants.DIALOG_ERROR_TYPE.BEENDEN,callback:l}]):(o="Es ist ein schwerwiegender Fehler aufgetreten",p=[{type:document.TaoOSPM.ui.constants.DIALOG_ERROR_TYPE.BEENDEN,callback:l}]),h={titel:o,text:i,rows:p},c||(p.push({type:document.TaoOSPM.ui.constants.DIALOG_ERROR_TYPE.FEHLERBERICHT}),h.reportData={Messages:e}),document.TaoOSPM.ui.dialogs.showErrorDialog(h))),g}},!0);return i}),define("zdb/common/IPadController",["tao/lib/stapes","tao/ospm/common/Toolkit","tao/ospm/common/Logger","tao/ospm/common/Constants","zdb/common/MessageController"],function(e,t,n,i,r){var a=e.subclass({log:null,msgController:new r,defaultPrinterName:null,defaultPrinterOID:null,indexDocument:0,indexPrint:0,anzKopien:0,internalZdbApi:null,pdfView:null,direktdruckauftraege:{},constructor:function(){this.log=new n("zdb","IPadController: init"),this.log.info("zdb.IPadController init"),this.indexDocument=0,this.indexPrint=0,this.defaultPrinterName=null,this.defaultPrinterOID=null,this.internalZdbApi=document.ZdbOSPM.api.internalZdbApi},getDokUrl:function(e){var t;if(e&&this.internalZdbApi.dokUrls)for(t=0;t<this.internalZdbApi.dokUrls.length;t++)if(e&&this.internalZdbApi.dokUrls[t].dokId===e)return this.internalZdbApi.dokUrls[t].dokUrl;return null},doDirectPrint:function(e,n,i,r,a){var s=function(e){this.msgController.messageVerarbeitung(e,"Der Druck auf dem iPad wurde abgebrochen.",[],a,this)&&(this.log.info(e),this.indexDocument=0,a&&a())}.bind(this),l=function(t){var n,a;i&&(n=document.TaoOSPM.ui.widgets.createList(),n.addElement(document.TaoOSPM.ui.widgets.createText({label:"Dokument <"+e.vorlagenBezeichnung+"> auf Drucker <"+this.defaultPrinterName+"> eingestellt.",hint:t.rc,hintIcon:"hint"})),a=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Druckergebnis",content:n,mandatory:!0,applyButton:{label:"OK",action:function(){a.hide()}}}),this.defaultPrinterName=null,this.defaultPrinterOID=null,a.show()),r&&r()}.bind(this),o=function(r){var a;t.isNullOrUndefined(e.anzahlKopien)?this.anzKopien=1:(this.anzKopien=parseInt(e.anzahlKopien,10),this.anzKopien<1?this.anzKopien=1:this.anzKopien>9&&(this.anzKopien=9)),this.anzKopien>=2&&!t.isNullOrUndefined(e.postfachKennzeichen)&&"1"===e.postfachKennzeichen&&this.anzKopien--,!i&&r&&r.rc&&(this.direktdruckauftraege[e.documentID]=e,t.isNullOrUndefined(this.direktdruckauftraege[e.documentID].druckjobs)&&(this.direktdruckauftraege[e.documentID].druckjobs=""),this.indexPrint>1&&this.indexPrint<this.anzKopien&&(this.direktdruckauftraege[e.documentID].druckjobs+=", "),this.direktdruckauftraege[e.documentID].druckjobs+=r.rc),a={druckerOid:this.defaultPrinterOID,dokumentUrl:this.getDokUrl(e.documentID),druckauftragName:e.vorlagenBezeichnung+" ("+e.documentID+", Kopie: "+(this.indexPrint+1)+"/"+this.anzKopien+")"},this.indexPrint===this.anzKopien-1?n?document.TaoOSPM.plugins.druckAuftrag(a,l,s):l({rc:4711}):(this.indexPrint++,n?document.TaoOSPM.plugins.druckAuftrag(a,o,s):o({rc:4711}))}.bind(this);n||(this.log.info("Simulation Direktdruck"),this.defaultPrinterOID="X4711",this.defaultPrinterName="Drucker 4711"),this.indexPrint=0,t.isNullOrUndefined(this.defaultPrinterOID)?document.TaoOSPM.plugins.druckerAuswahl(function(t){this.log.info(t),"0"===t.rc&&(this.defaultPrinterOID=t.standardDrucker.druckerOid,this.defaultPrinterName=t.standardDrucker.druckerName,this.defaultPrinterOID?o():a&&s([{code:4,msg:"Dokument "+(e?e.vorlagenBezeichnung+" ("+e.documentID+") ":"")+"wurde nicht gedruckt. Kein Drucker gefunden."}]))}.bind(this)):this.defaultPrinterOID?o():a&&s([{code:4,msg:"Dokument "+(e?e.vorlagenBezeichnung+" ("+e.documentID+") ":"")+"wurde nicht gedruckt. Kein Drucker gefunden."}])},directPrintOrPreview:function(e,n,i,r){var a,s,l,o,u,d,h,c=e.length,g=[],f=function(){this.indexDocument++,this.directPrintOrPreview(e,n,i,r)}.bind(this);if(this.indexDocument>=c)if(this.indexDocument=0,this.pdfView&&this.pdfView.close(),this.pdfView=null,n===!0)if(o=document.TaoOSPM.ui.widgets.createList(),h=Object.keys(this.direktdruckauftraege),h.length>0){for(u=0;u<h.length;u++)d=this.direktdruckauftraege[h[u]],o.addElement(document.TaoOSPM.ui.widgets.createText({label:"Dokument <"+d.vorlagenBezeichnung+"> auf Drucker <"+this.defaultPrinterName+"> automatisch eingestellt.",hint:"Druckjobs: "+d.druckjobs,hintIcon:"hint"}));l=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Druckergebnis Direktdruck",content:o,mandatory:!0,applyButton:{label:"OK",action:function(){l.hide(),i&&i(g)}}}),l.show()}else i&&i(g);else i&&i(g);else e[this.indexDocument]&&(a=e[this.indexDocument].verarbeitungsArt,s="IPAD"===this.internalZdbApi.kanalKz&&!this.internalZdbApi.parameter.INTERN_SIMULATE_IPAD,"DRUCKER1"!==a?t.isNullOrUndefined(this.pdfView)?this.createPdfViewer(e[this.indexDocument],s,f,r):(this.pdfView.getNavbar().getElement("DOCUMENT_TITLE").label=e[this.indexDocument].vorlagenBezeichnung,this.pdfView.setUrl(this.getDokUrl(e[this.indexDocument].documentID),!1,{})):this.doDirectPrint(e[this.indexDocument],s,!1,f,r))},archivieren:function(e,t,n,i){var r,a={AUTO_ELPO:"false",AUTO_ARCHIV_ABLAGE:"2"};t&&(a.vzaAuftragId=t),n&&n.length>0&&(a.dkmtIDs=n),e&&e.length>0&&(a.DATG_ID=e),document.GpsOSPM.bridgeTools&&document.GpsOSPM.bridgeTools.hasGpsDatenWorkflow()&&(r=document.GpsOSPM.bridgeTools.getGpsDatenWorkflow(),a.fachlicheMeldungsId=document.GpsOSPM.bridgeTools.getFachlicheMeldungId(),a.aktivitaetsName=r.getAktivitaetName(),this.internalZdbApi.parameter.FACHLICHE_MELDUNG_NAME&&(a.aktivitaetsName=this.internalZdbApi.parameter.FACHLICHE_MELDUNG_NAME,this.log.info("FACHLICHE_MELDUNG_NAME: "+this.internalZdbApi.parameter.FACHLICHE_MELDUNG_NAME))),a.KANAL_KZ="IPAD",document.TaoOSPM.server.executeRequest("zdb.dokumenteverarbeitenstationaer",a,function(e,t){this.msgController.messageVerarbeitung(t,"Die Archivierung auf dem iPad wurde abgebrochen.",[],i,this)&&i&&i(t)}.bind(this))},createPdfViewer:function(e,t,n,i){var r,a=function(){this.pdfView&&this.pdfView.close(),this.pdfView=null,n&&n()}.bind(this),s=function(){this.anzKopien=1,this.doDirectPrint(e,t,!0,null,i)}.bind(this);t?(this.pdfView=document.TaoOSPM.plugins.createDocumentViewer({url:this.getDokUrl(e.documentID),options:{animateInit:!0,animateUpdate:!1,initFullWidth:!0,startPenDiscover:!1,handleSignatures:!1}}),r=this.pdfView.getNavbar(),r.replaceElement({id:"MEIN_EXIT",icon:"CANCEL_CIRCLE_M",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:a},"EXIT"),r.addElement({id:"PRINT",icon:"PRINT_M",position:"right",hidden:!1,enabled:!0,type:"icontext",clickListener:s},"SPACE_RIGHT_FIRST"),r.getElement("DOCUMENT_TITLE").label=e.vorlagenBezeichnung,r.showElement("MEIN_EXIT"),r.showElement("PRINT"),this.pdfView.setNavbar(r)):this.simPdfViewer(e,t,n,i)},simPdfViewer:function(e,n,i,r){var a,s=document.TaoOSPM.ui.widgets.createList();s.removeElement("F_55503$$"),s.addElement(document.TaoOSPM.ui.widgets.createInfoText({id:"F_55503$$",formattedLabel:"Vorlage: "+e.vorlagenName+"<br>"+e.personenName+" ("+e.personenNr+")<br>DokId: "+e.documentID}),0),s.removeElement("F_84900$$"),s.addElement(document.TaoOSPM.ui.widgets.createButton({id:"F_84900$$",label:"Dok anzeigen",clickListener:function(){this.direktdruckauftraege[e.documentID]=e,t.isNullOrUndefined(this.direktdruckauftraege[e.documentID].druckjobs)&&(this.direktdruckauftraege[e.documentID].druckjobs=""),this.anzKopien>1&&(this.direktdruckauftraege[e.documentID].druckjobs+=", "),this.direktdruckauftraege[e.documentID].druckjobs+="4711",document.ZdbOSPM.api.oeffneUrl(this.getDokUrl(e.documentID),null)}.bind(this)})),a=document.TaoOSPM.ui.dialogs.createInputDialog({title:e.vorlagenBezeichnung,content:s,cancelOnOutsideClick:!1,mandatory:!1,applyButton:{label:"Weiter",action:i},cancelButton:{label:"Abbrechen",action:r}}),a.show()}},!0);return a}),define("zdb/common/DruckauswahlController",["tao/lib/stapes","tao/ospm/common/Toolkit","tao/ospm/common/Logger","zdb/common/IPadController"],function(e,t,n,i){var r=e.subclass({log:null,spinnerId:null,datgid:null,kanalKz:"OSAP",vzaAuftragId:null,dokUrls:null,erfolgreicheSignatur:!1,signaturUndServId:null,signaturDokIdsZuUndFileIds:[],changeLogtext:null,callback:null,fehlerCallback:null,resultList:null,messages:[],internalZdbApi:null,iPadController:null,druckChangeMap:{},druckOrgMap:{},constructor:function(e,n,r,a,s,l){var o,u,d,h,c,g,f,p,m=0,E=!1,k=!0,D=[],b=[],A=[],I=[];for(this.internalZdbApi=document.ZdbOSPM.api.internalZdbApi,this.datgid=this.internalZdbApi.datgid,this.vzaAuftragId=this.internalZdbApi.vzaAuftragId,this.dokUrls=this.internalZdbApi.dokUrls,this.erfolgreicheSignatur=e,this.signaturUndServId=n,this.signaturDokIdsZuUndFileIds=r,this.callback=s,this.fehlerCallback=l,this.changeLogtext=a,this.kanalKz=this.internalZdbApi.kanalKz,"IPAD"===this.kanalKz&&(this.iPadController=new i),document.TaoOSPM.ui.getSelectionGroup("druckdokgroup").getElements().length=0,this.druckChangeMap={},this.druckOrgMap={},t.isNullOrUndefined(this.internalZdbApi.docsForArchiv)||this.internalZdbApi.docsForArchiv.forEach(function(e){b.push(e.documentID)}),t.isNullOrUndefined(this.internalZdbApi.docsForSignatur)||this.internalZdbApi.docsForSignatur.forEach(function(e){A.push(e.documentID),t.isNullOrUndefined(this.signaturDokIdsZuUndFileIds)||this.signaturDokIdsZuUndFileIds.forEach(function(t){t.dokumentId===e.documentID&&I.push(t.undFileId)})}.bind(this)),t.isNullOrUndefined(this.internalZdbApi.docsForEPO)||this.internalZdbApi.docsForEPO.forEach(function(e){D.push(e.documentID)}),o=0;o<this.internalZdbApi.selDocs.length;o++)if(c=this.internalZdbApi.selDocs[o].documentID,h="DRUCKER1"===this.internalZdbApi.selDocs[o].verarbeitungsArt,E=this.internalZdbApi.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK&&D.indexOf(c)>=0,!E){if(this.internalZdbApi.useNewEpoWorkflowAktiv){if(this.internalZdbApi.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK===!0)h=!0,k=!1;else for(h=!0,k=t.isNullOrUndefined(this.internalZdbApi.selDocs[o].pflichtKennzeichen),u=0;u<this.internalZdbApi.docsForEPO.length;u++)if(this.internalZdbApi.docsForEPO[u].documentID===c){h=!1,k=!0;break}}else h=this.internalZdbApi.selDocs[o].hasOnlyDritte,k=t.isNullOrUndefined(this.internalZdbApi.selDocs[o].pflichtKennzeichen)||this.internalZdbApi.selDocs[o].hasOnlyDritte===!1;if(k&&!t.isNullOrUndefined(this.internalZdbApi.selDocs[o].archivElekKz)&&this.internalZdbApi.selDocs[o].archivElekKz.indexOf("Elektronisch unterzeichnen")>=0)for(u=0;u<this.internalZdbApi.signaturWorkflowDokumentIds.length;u++)if(this.internalZdbApi.signaturWorkflowDokumentIds[u]===c){h=!this.erfolgreicheSignatur;break}if(k&&!h&&this.internalZdbApi.selDocsJustPrint)for(u=0;u<this.internalZdbApi.selDocsJustPrint.length;u++)if(this.internalZdbApi.selDocsJustPrint[u].documentID===c){h=!0;break}if(f="",t.isNullOrUndefined(this.internalZdbApi.selDocs[o].pflichtKennzeichen)||(f+="Pflicht"),D.indexOf(c)>=0&&(f.length>0&&(f+=", "),f+="Elektr. Postf. zugestellt"),A.indexOf(c)>=0&&(f.length>0&&(f+=", "),f+=this.erfolgreicheSignatur?"unterzeichnet":"nicht unterzeichnet"),d=document.TaoOSPM.ui.widgets.createCheckbox({label:this.internalZdbApi.selDocs[o].vorlagenBezeichnung,infoText:this.internalZdbApi.selDocs[o].personenName,subLabel:f,enabled:k,value:h,leftIcon:"DOCUMENT_PDF_M",group:"druckdokgroup"}),d.appData=this.internalZdbApi.selDocs[o],!t.isNullOrUndefined(this.dokUrls))for(u=0;u<this.dokUrls.length;u++)if(c===this.dokUrls[u].dokId){d.appData.dokUrl=this.dokUrls[u].dokUrl;break}this.druckOrgMap[d.appData.documentID]=d.getValue(),t.isNullOrUndefined(this.resultList)&&(this.resultList=document.TaoOSPM.ui.widgets.createList()),this.resultList.addElement(d),k||m++}t.isNullOrUndefined(this.resultList)||m===this.resultList.elementCount()?this.resultList=null:this.internalZdbApi.setAllSelectionRow(this.resultList,0,document.TaoOSPM.ui.getSelectionGroup("druckdokgroup"),!1,"Alle zum Drucken auswählen",this.druckChangeMap),this.spinnerId=document.TaoOSPM.ui.progress.start({timeout:this.internalZdbApi.busyviewtimeout}),p=function(e,n){var i;if(this.resultList)for(i=0;i<this.resultList.elementCount();i++)!t.isNullOrUndefined(this.resultList.getElement(i).appData)&&e.indexOf(this.resultList.getElement(i).appData.documentID)>=0&&(f=this.resultList.getElement(i).getSubLabel(),f.length>0&&(f+=", "),f+=n,this.resultList.getElement(i).setSubLabel(f))}.bind(this),g=function(){b.length>0?(document.TaoOSPM.ui.progress.update({label:"Dokumentenverarbeitung",sublabel:b.length+(1===b.length?" Dokument wird":" Dokumente werden")+" archiviert."},this.spinnerId),"IPAD"===this.kanalKz?this.iPadController.archivieren(this.datgid,this.vzaAuftragId,b,function(e){document.TaoOSPM.ui.progress.stop(this.spinnerId),this.internalZdbApi.messageVerarbeitung(e,"Die automatische Archivierung der Dokumente auf dem iPad wurde abgebrochen.",[],this.fehlerCallback)&&(this.internalZdbApi.docsForArchiv.forEach(function(e){this.messages.push({code:2,msg:"Dokument "+e.vorlagenName+" ("+e.documentID+") wurde zur Archivierung weitergeleitet."})}.bind(this)),p(b,"archiviert"),t.isNullOrUndefined(this.changeLogtext)&&this.callback&&this.callback(this.messages))}.bind(this)):this.internalZdbApi.executeRequest("zdb.autoarchivierung",{dkmtIDs:b},function(e,n){document.TaoOSPM.ui.progress.stop(this.spinnerId),this.internalZdbApi.messageVerarbeitung(n,"Die automatische Archivierung der Dokumente wurde abgebrochen.",[],this.fehlerCallback)&&(t.isNullOrUndefined(n)||(this.messages=this.messages.concat(n)),this.internalZdbApi.docsForArchiv.forEach(function(e){this.messages.push({code:2,msg:"Dokument "+e.vorlagenName+" ("+e.documentID+") wurde zur Archivierung weitergeleitet."})}.bind(this)),p(b,"archiviert"),t.isNullOrUndefined(this.changeLogtext)&&this.callback&&this.callback(this.messages))}.bind(this))):(document.TaoOSPM.ui.progress.stop(this.spinnerId),t.isNullOrUndefined(this.changeLogtext)&&this.callback&&this.callback(this.messages))}.bind(this),this.erfolgreicheSignatur&&this.internalZdbApi.docsForSignatur.length>0&&!t.isNullOrUndefined(this.signaturDokIdsZuUndFileIds)&&this.signaturDokIdsZuUndFileIds.length>0&&!t.isNullOrUndefined(this.signaturUndServId)?t.isNullOrUndefined(A)||t.isNullOrUndefined(I)||A.length!==I.length?(t.isNullOrUndefined(A)||p(A,"nicht Verbundpartner zugestellt"),g()):(document.TaoOSPM.ui.progress.update({label:"Dokumentenverarbeitung",sublabel:I.length+(1===I.length?" Dokument wird":" Dokumente werden")+" dem Verbundpartner zugestellt."},this.spinnerId),this.internalZdbApi.executeRequest("zdb.signaturarchivierung",{undServId:this.signaturUndServId,undFileIDs:I,dkmtIDs:A,vzaAuftragId:this.internalZdbApi.signaturWorkflowVZAAUFTRAGID,vzaVpKey:this.internalZdbApi.signaturWorkflowVZAVPKEY,vzaFachdaten:this.internalZdbApi.signaturWorkflowVZAFACHDATEN},function(e,n){this.internalZdbApi.messageVerarbeitung(n,"Die automatische Archivierung der unterzeichneten Dokumente wurde abgebrochen.",[],this.fehlerCallback)?(t.isNullOrUndefined(n)||(this.messages=this.messages.concat(n)),t.isNullOrUndefined(e.vzaAuftragId)?(t.isNullOrUndefined(A)||p(A,"nicht Verbundpartner zugestellt"),g()):(this.internalZdbApi.signaturWorkflowVZAAUFTRAGID=e.vzaAuftragId,this.internalZdbApi.docsForSignatur.forEach(function(e){this.messages.push({code:2,msg:"Dokument "+e.vorlagenName+" ("+e.documentID+") wurde dem Verbundpartner zugestellt."})}.bind(this)),p(A,"Verbundpartner zugestellt"),g())):document.TaoOSPM.ui.progress.stop(this.spinnerId)}.bind(this))):(t.isNullOrUndefined(A)||p(A,"nicht Verbundpartner zugestellt"),g())},getResultList:function(){return this.resultList},getWeiterFunktion:function(){return function(){var e,n,i,r=document.TaoOSPM.ui.getSelectionGroup("druckdokgroup"),a=r.selectedElements(),s=[],l=function(e){if(!t.isNullOrUndefined(e)&&e.length>0&&(this.messages=this.messages.concat(e)),s.length>0)for(n=0;n<s.length;n++)this.messages.push({code:2,msg:"Dokument "+s[n].vorlagenName+" ("+s[n].documentID+") wurde gedruckt."});this.callback(this.messages)}.bind(this);if(this.druckChangeMap&&(i=Object.keys(this.druckChangeMap)),!t.isNullOrUndefined(i)&&a.length>0){for(e=0;e<i.length;e++)for(n=0;n<a.length;n++)if(a[n].appData.documentID===i[e]&&this.druckOrgMap[i[e]]!==this.druckChangeMap[i[e]]){this.changeLogtext+="["+a[n].appData.vorlagenName+" ("+a[n].appData.documentID+") von "+this.druckOrgMap[i[e]]+" nach "+this.druckChangeMap[i[e]]+"]";break}this.internalZdbApi.executeRequest("zdb.log",{journalInfo:this.changeLogtext})}for(n=0;n<a.length;n++)this.erfolgreicheSignatur&&"IPAD"===this.kanalKz&&(a[n].appData.verarbeitungsArt="DRUCKER1"),s.push(a[n].appData);"IPAD"===this.kanalKz?s.length>0?this.internalZdbApi.callUrlZuAuftragErmitteln(s,[],function(e){t.isNullOrUndefined(e)||(this.messages=this.messages.concat(e)),this.iPadController.directPrintOrPreview(s,!0,l,this.fehlerCallback)}.bind(this)):l([]):this.internalZdbApi.callUrlZuAuftragErmitteln(s,[],l)}.bind(this)}},!0);return r}),define("zdb/common/ZdbApi",["tao/ospm/common/Toolkit","tao/ospm/common/Logger","tao/ospm/common/Constants","tao/ospm/common/WorkflowData","zdb/common/DBKMController","zdb/common/EPostfachController","zdb/common/EPOController","zdb/common/DruckauswahlController","zdb/common/MessageController"],function(e,t,n,i,r,a,s,l,o){var u={newSignatureWorkflowAktiv:!0,newEpoWorkflowAktiv:!0,epfArchivBerechtigt:!1,direktDruckenWennMoeglich:!1,vzaAuftragId:null,orgMap:{},changeMap:{},vorlagennamen:null,alleDoksUrl:null,resultList:null,datgid:null,alleDokumente:null,selDocs:null,selDocsZentralerDruck:null,selDocsJustPrint:null,docsForArchiv:null,docsForSignatur:null,docsForEPO:null,signaturWorkflowDokumentIds:[],signaturWorkflowSignaturgeber:null,signaturWorkflowVZAVPKEY:null,signaturWorkflowVZAAUFTRAGID:null,signaturWorkflowVZAFACHDATEN:null,signaturWorkflowPreviewDokumentIds:[],epostfachvorbelegung:null,fachlicheMeldungsId:null,useNewSignatureWorkflow:!0,useNewEpoWorkflowAktiv:!1,dokumentenAuswahlDialogView:null,pflichtDokList:null,currentWaitingWindow:null,dokUrls:null,simAbgleichError:null,nurDrucken:{alle:!1,dokids:[]},kanalKz:null,layout:null,toogleSelection:!1,druckzeit:null,epostfachCalled:!1,arcvordrDokIdsAbgewaehlt:[],arcvordrDokIdsVerarbeitet:[],selectedVorlagen:[],EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK:!1,ELPODOKSZURPERSNR:{},alleLadenAction:null,aktivitaetsName:null,ispMode:!1,zentralerDruck:!1,mindestensEinDokumentZentralerDruck:!1,zentralerDruckInAcrobatReaderAktiv:!0,expressMode:!1,hasOptionalePostfachempfanger:!1,elpoDoks:[],keineElpoDoks:[],direktdruckDoks:[],sortierungDoks:[],bearbeitenDoks:[],selectedPostfachempf:[],mifidAlleDokumenteEpoRelevant:!1,mifidEpoRelevanteDokumente:[],epoNachrichtenTyp:null,epoNachricht2FASchutz:!1,formulareHinzufuegen:!1,formulareHinzufuegenButton:null,epoController:null,count:0,formularCenterHinzugefuegteDokId:null,formularCenterDokumentFuerVersandAmAnfang:!1},d={mainResponse:null,mainCallback:null,mainBVCallback:null,parameter:null,log:null,ALLE_DOKS_LADEN_MEDIAL_AWKS:["ZDB","PVK","EXP","GGX","GMJ"],ALLE_FLACH_HERUNTERLADEN_AWKS:["ZDB","GFK"],EXPRESSMODE_POSTFEMPFFILTERN_AWKS:["PVK","EXP"],QUEUE_RUNNING:!1,QUEUE:[],QUEUE_INDEX:0,QUEUE_CURJOB:null,busyviewtimeout:18e5,msgController:new o,oeffneUrlWindow:null,fillInternalParameter:function(e){[n.STAGES.DEVELOP,n.STAGES.ENTWICKLUNG,n.STAGES.INTEGRATION,n.STAGES.ABNAHME].indexOf(document.TaoOSPM.serverEnvironment.getStage())>=0&&(d.parameter.INTERN_SET_ISPMODE&&(d.ispMode=!0,e.ispMode=!0,d.log.info("INTERN_SET_ISPMODE")),d.parameter.INTERN_SIM_ABGLEICHERROR&&(d.simAbgleichError=d.parameter.INTERN_SIM_ABGLEICHERROR,d.log.info("INTERN_SIM_ABGLEICHERROR="+d.simAbgleichError)))},fillExpressmodeParameter:function(e){var t,n;if(d.parameter.EXPRESSMODE){for(t=0;t<d.EXPRESSMODE_POSTFEMPFFILTERN_AWKS.length;t++)if(n=d.EXPRESSMODE_POSTFEMPFFILTERN_AWKS[t],document.TaoOSPM.workflowStepId.indexOf("A_"+n+"_")>=0){d.log.info("Anwendung "+n+" für EXPRESSMODE_POSTFEMPFFILTERN freigeschaltet."),e.postfEmpfFiltern=!0;break}d.expressMode=!0,e.EXPRESSMODE=!0,d.log.info("EXPRESSMODE")}},fillParameter:function(e){d.zentralerDruckInAcrobatReaderAktiv=!0,d.parameter.EXTNACHRICHTMODE?(e.EXTNACHRICHTMODE=!0,d.log.info("EXTNACHRICHTMODE : "+d.parameter.EXTNACHRICHTMODE),d.zentralerDruck=!1,d.parameter.ZENTRALERDRUCK=!1,d.zentralerDruckInAcrobatReaderAktiv=!1):d.parameter.FORMULARE_HINZUFUEGEN?(d.formulareHinzufuegen=d.parameter.FORMULARE_HINZUFUEGEN,d.log.info("FORMULARE_HINZUFUEGEN: "+d.parameter.FORMULARE_HINZUFUEGEN),d.zentralerDruck=!0,d.zentralerDruckInAcrobatReaderAktiv=!1):d.mindestensEinDokumentZentralerDruck&&(d.zentralerDruckInAcrobatReaderAktiv=!1),e.zentralerDruckInAcrobatReaderAktiv=d.zentralerDruckInAcrobatReaderAktiv,d.parameter.ANONYMOUS_PERSNR&&(e.ANONYMOUS_PERSNR=d.parameter.ANONYMOUS_PERSNR,d.log.info("ANONYMOUS_PERSNR : "+e.ANONYMOUS_PERSNR)),d.parameter.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK&&(d.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK=!0,e.isAutoArchivAktiv=!0,d.log.info("EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK")),d.parameter.DATGID&&(e.DATG_ID=d.parameter.DATGID,d.log.info("DATGID : "+d.parameter.DATGID)),d.parameter.GET_DOKUMENTENLINKS&&(e.GET_DOKUMENTENLINKS="true",d.log.info("GET_DOKUMENTENLINKS")),d.parameter.EPOSTFACHBETREFF&&(e.BETREFF=d.parameter.EPOSTFACHBETREFF,d.log.info("EPOSTFACHBETREFF: "+d.parameter.EPOSTFACHBETREFF)),d.parameter.EPOSTFACHMITTEILUNG&&(e.MITTEILUNG=d.parameter.EPOSTFACHMITTEILUNG,d.log.info("EPOSTFACHMITTEILUNG: "+d.parameter.EPOSTFACHMITTEILUNG)),d.fillExpressmodeParameter(e),d.parameter.ELPODOKSZURPERSNR&&(d.ELPODOKSZURPERSNR=d.parameter.ELPODOKSZURPERSNR,e.ELPODOKSZURPERSNR=d.parameter.ELPODOKSZURPERSNR,d.log.info("ELPODOKSZURPERSNR : "+d.ELPODOKSZURPERSNR)),d.parameter.KEINEELPODOKS&&d.parameter.KEINEELPODOKS.length>0&&(d.keineElpoDoks=d.parameter.KEINEELPODOKS,e.KEINEELPODOKS=d.keineElpoDoks,d.log.info("KEINEELPODOKS: "+d.keineElpoDoks)),d.parameter.ELPODOKS&&d.parameter.ELPODOKS.length>0&&(d.elpoDoks=d.parameter.ELPODOKS,e.ELPODOKS=d.elpoDoks,d.log.info("ELPODOKS: "+d.elpoDoks)),d.parameter.DIREKTDRUCKDOKS&&d.parameter.DIREKTDRUCKDOKS.length>0&&(d.direktdruckDoks=d.parameter.DIREKTDRUCKDOKS,e.DIREKTDRUCKDOKS=d.direktdruckDoks,d.log.info("DIREKTDRUCKDOKS: "+d.direktdruckDoks)),d.parameter.SORTIERUNGDOKS&&d.parameter.SORTIERUNGDOKS.length>0&&(d.sortierungDoks=d.parameter.SORTIERUNGDOKS,e.SORTIERUNGDOKS=d.sortierungDoks,d.log.info("SORTIERUNGDOKS: "+d.sortierungDoks)),d.parameter.MIFID_ALLE_DOKUMENTE_EPO_RELEVANT&&(d.mifidAlleDokumenteEpoRelevant=d.parameter.MIFID_ALLE_DOKUMENTE_EPO_RELEVANT,e.MIFID_ALLE_DOKUMENTE_EPO_RELEVANT=d.mifidAlleDokumenteEpoRelevant,d.log.info("MIFID_ALLE_DOKUMENTE_EPO_RELEVANT: "+d.mifidAlleDokumenteEpoRelevant)),!d.mifidAlleDokumenteEpoRelevant&&d.parameter.MIFID_EPO_RELEVANTE_DOKUMENTE&&d.parameter.MIFID_EPO_RELEVANTE_DOKUMENTE.length>0&&(d.mifidEpoRelevanteDokumente=d.parameter.MIFID_EPO_RELEVANTE_DOKUMENTE,e.MIFID_EPO_RELEVANTE_DOKUMENTE=d.mifidEpoRelevanteDokumente,d.log.info("MIFID_EPO_RELEVANTE_DOKUMENTE: "+d.mifidEpoRelevanteDokumente)),d.parameter.EPOSTFACHNACHRICHTENTYP&&(e.EPOSTFACHNACHRICHTENTYP=d.parameter.EPOSTFACHNACHRICHTENTYP,d.epoNachrichtenTyp=d.parameter.EPOSTFACHNACHRICHTENTYP,d.log.info("EPOSTFACHNACHRICHTENTYP: "+d.parameter.EPOSTFACHNACHRICHTENTYP)),d.parameter.EPOSTFACHNACHRICHT_2FA_SCHUTZ&&(d.epoNachricht2FASchutz=d.parameter.EPOSTFACHNACHRICHT_2FA_SCHUTZ,d.log.info("EPOSTFACHNACHRICHT_2FA_SCHUTZ: "+d.parameter.EPOSTFACHNACHRICHT_2FA_SCHUTZ)),d.bearbeitenDoks=[],d.parameter.BEARBEITENDOKS&&d.parameter.BEARBEITENDOKS.length>0&&(d.bearbeitenDoks=d.parameter.BEARBEITENDOKS,e.BEARBEITENDOKS=d.bearbeitenDoks,d.log.info("BEARBEITENDOKS: "+d.bearbeitenDoks)),d.parameter.FACHLICHE_MELDUNG_NAME&&(d.aktivitaetsName=d.parameter.FACHLICHE_MELDUNG_NAME,d.log.info("FACHLICHE_MELDUNG_NAME: "+d.parameter.FACHLICHE_MELDUNG_NAME)),d.parameter.SIGNATURGEBER&&(d.signaturWorkflowSignaturgeber=d.parameter.SIGNATURGEBER,e.SIGNATURGEBER=d.parameter.SIGNATURGEBER,d.log.info("SIGNATURGEBER: "+d.parameter.SIGNATURGEBER)),d.parameter.VZA_VP_KEY&&(d.signaturWorkflowVZAVPKEY=d.parameter.VZA_VP_KEY,e.VZAVPKEY=d.parameter.VZA_VP_KEY,d.log.info("VZA_VP_KEY: "+d.parameter.VZA_VP_KEY),d.parameter.VZA_AUFTRAG_ID&&(d.signaturWorkflowVZAAUFTRAGID=d.parameter.VZA_AUFTRAG_ID,e.VZAAUFTRAGID=d.parameter.VZA_AUFTRAG_ID,d.log.info("VZA_AUFTRAG_ID: "+d.parameter.VZA_AUFTRAG_ID)),d.parameter.VZA_FACHDATEN&&(d.signaturWorkflowVZAFACHDATEN=d.parameter.VZA_FACHDATEN,e.VZAFACHDATEN=d.parameter.VZA_FACHDATEN,d.log.info("VZA_FACHDATEN: "+d.parameter.VZA_FACHDATEN)))},fillRequestFromParameterKanalOSAPoderIPAD:function(e){d.ispMode===!0&&(e.ispMode=!0),d.fillInternalParameter(e),d.fillParameter(e)},handleBuendelVerarbeitenKanalOSAPoderIPAD:function(){var t={};try{if(d.parameter.ZENTRALERDRUCK&&(d.zentralerDruck=!0,d.log.info("ZENTRALERDRUCK")),d.fillRequestFromParameterKanalOSAPoderIPAD(t),t.newSignatureWorkflowAktiv=d.useNewSignatureWorkflow&&!e.isNullOrUndefined(d.parameter.DSP_NUTZEN)&&d.parameter.DSP_NUTZEN&&!e.isNullOrUndefined(d.signaturWorkflowVZAVPKEY)&&!e.isNullOrUndefined(d.signaturWorkflowVZAFACHDATEN)&&!e.isNullOrUndefined(d.signaturWorkflowSignaturgeber)&&d.newSignatureWorkflowAktiv&&d.ispMode===!1,d.ispMode===!1&&(e.isNullOrUndefined(d.parameter.DSP_NUTZEN)||!d.parameter.DSP_NUTZEN?d.executeRequest("zdb.log",{journalInfoAndFP:"Signaturworkflow (DSP_NUTZEN) nicht aktiviert"},function(){}):!e.isNullOrUndefined(d.parameter.DSP_NUTZEN)&&d.parameter.DSP_NUTZEN&&d.useNewSignatureWorkflow&&!t.newSignatureWorkflowAktiv&&d.executeRequest("zdb.log",{journalInfoAndFP:"Signaturworkflow nicht aktiviert (VZAVPKEY: "+d.signaturWorkflowVZAVPKEY+", VZAFACHDATEN übergeben: "+(e.isNullOrUndefined(d.signaturWorkflowVZAFACHDATEN)?"Nein":"Ja")+", SIGNATURGEBER übergeben: "+(e.isNullOrUndefined(d.signaturWorkflowSignaturgeber)?"Nein":"Ja")+")"},function(){})),d.useNewSignatureWorkflow=t.newSignatureWorkflowAktiv,d.log.info("useNewSignatureWorkflow: "+d.useNewSignatureWorkflow),d.useNewEpoWorkflowAktiv=d.useNewEpoWorkflowAktiv?!0:d.newEpoWorkflowAktiv&&d.useNewSignatureWorkflow,d.log.info("useNewEpoWorkflowAktiv: "+d.useNewEpoWorkflowAktiv),d.useNewEpoWorkflowAktiv&&!d.parameter.INTERN_FROM_GPS)return d.mainBVCallback=d.mainCallback,void document.TaoOSPM.workflow.startWorkflowOverlay("W_ZDB_BV","I_ZDB_BV",new i(d.getJsonForZdbWorkflow()),function(e){d.vzaAuftragId=e.DOMAIN_ZDB_VZA_AUFTRAG_ID?e.DOMAIN_ZDB_VZA_AUFTRAG_ID:d.vzaAuftragId,d.callFinishCallback(e.DOMAIN_ZDB_MESSAGES,d.mainBVCallback,"weiter")});d.doVerarbeitung(t)}catch(n){d.log.error(n),d.mainCallback&&d.mainCallback({messages:[{code:8,msg:"Execption:"+n}],event:"fehler"})}},handleBuendelVerarbeitenKanalIF:function(e,t,n){var i,r,a={},s=!1;try{if(e.GET_DOKUMENTENLINKS){if(n.info("GET_DOKUMENTENLINKS"),e.DATGID&&(a.F_9826$$=e.DATGID,n.info("DATGID : "+e.DATGID)),e.GET_ALLEDOKUMENTE){for(i=0;i<d.ALLE_DOKS_LADEN_MEDIAL_AWKS.length;i++)if(r=d.ALLE_DOKS_LADEN_MEDIAL_AWKS[i],document.TaoOSPM.workflowStepId.indexOf("A_"+r+"_")>=0){n.info("Anwendung "+r+" für GET_ALLEDOKUMENTE freigeschaltet."),s=!0;break}if(!s)return void d.messageVerarbeitung([{code:"8",msg:"Alle Dokumente können nicht geladen werden."}],"Anwendung für diese Funktion nicht freigeschaltet. Wenden Sie sich an einen Administrator",[],t);a.F_3517$$=e.GET_ALLEDOKUMENTE,n.info("GET_ALLEDOKUMENTE : "+e.GET_ALLEDOKUMENTE),e.DKMTIDS&&(a.F_75056$$=e.DKMTIDS,n.info("DKMTIDS : "+e.DKMTIDS))}d.executeRequest("zdb.if_dokumenteabrufen",a,function(n,i){d.messageVerarbeitung(i,"Die mediale Dokumentenverarbeitung wurde abgebrochen.",[],t)&&(n.F_9826$$&&n.F_97657$$?(e.OEFFNE_LINK_WENN_IF&&e.OEFFNE_LINK_WENN_IF===!0&&d.messageVerarbeitung([{code:"8",msg:"Der Parameter OEFFNE_LINK_WENN_IF darf nicht mehr verwendet werden."}],"Bitte nutzen Sie die Schnittstelle oeffneUrl",i,t),t&&t({dokUrls:n.F_97657$$,messages:d.getMessageArrayAbCode2(i),event:"weiter"})):n.F_9826$$?d.messageVerarbeitung([{code:"8",msg:"Es wurden keine Dokumenten-Urls zurückgeliefert."}],"Es sind keine Dokumente vorhanden.",i,t):t&&t({messages:d.getMessageArrayAbCode2(i),event:"weiter"}))})}else d.messageVerarbeitung([{code:"8",msg:"Medial ist das Ablegen von Dokumenten (Archivierung bzw. Elektronische Postfach) nicht erlaubt."}],"Funktion über Client-API nicht zulässig. Bitte nutzen Sie die mediale Aktivität ZDBNEO_IF",[],t)}catch(l){n.error(l),t&&t({messages:[{code:8,msg:"Execption:"+l}],event:"fehler"})}},loadURL:function(n,i,r){var a={F_75056$$:[i]};return e.isNullOrUndefined(i)?void(r&&r()):(e.isNullOrUndefined(d.log)&&(d.log=new t("zdb","loadURL")),d.log.info("Lade URL für DkmtId "+i),n&&(a.F_9826$$=n),void d.executeRequest("zdb.if_dokumenteabrufen",a,function(e,t){return d.messageVerarbeitung(t,"Die mediale Ermittelung der URL wurde abgebrochen.",[],null)&&r&&e&&e.F_97657$$&&e.F_97657$$[0].F_12413$$?void r(e.F_97657$$[0].F_12413$$):void(r&&r())}))},refreshURL:function(n,i){var r,a,s,l,o;return!e.isNullOrUndefined(n)&&n.indexOf("zda/getdocument")>=0&&n.indexOf("tst=")>=0&&(r=n.indexOf("tst=")+4,r>-1&&(a=n.indexOf("&",r),a>-1&&(s=n.substr(r,a-r),l=(new Date).valueOf(),o=l-s,o>55e3)))?(e.isNullOrUndefined(d.log)&&(d.log=new t("zdb","refreshURL")),d.log.info(o+" ist größer als 55s. URL neu laden."),void d.executeRequest("zdb.zdaurlermittelnservice",{url:n},function(e,t){return d.messageVerarbeitung(t,"Der Abruf der URL konnte nicht erfolgreich durchgeführt werden.",[],null)&&i&&e&&e.url?void i(e.url):void(i&&i(n))
})):void(i&&i(n))},getSublabelForDok:function(t,n,i){var r=t.personenName;return e.isNullOrUndefined(t.archivElekKz)||(r+=", ",r+=t.archivElekKz),n!==!0||e.isNullOrUndefined(t.postfachKennzeichen)||"1"!==t.postfachKennzeichen||(r+=", postfachfähig"),e.isNullOrUndefined(t.postfachMifidRelevant)||(r+=", MiFID"),i&&!e.isNullOrUndefined(t.zentralerDruckKZ)&&"N"!==t.zentralerDruckKZ&&(r+="O"===t.zentralerDruckKZ?", Postversand optional":", nur Postversand"),d.formularCenterDokumentFuerVersandAmAnfang&&d.formularCenterHinzugefuegteDokId===t.documentID&&(r+=", Versand am Anfang"),"BEARBEITEN"===t.verarbeitungsArt&&(r+=", bearbeitbar"),e.isNullOrUndefined(t.pflichtKennzeichen)||(r+=", Pflicht"),r},setDoksInPostfachRow:function(t){var n,i,r,a,s=!1,l=document.TaoOSPM.ui.getSelectionGroup("documentgroup");l&&d.resultList&&t>=0&&(r=document.TaoOSPM.ui.widgets.createCheckbox({label:"Dokumente ins Elektronische Postfach weiterleiten",enabled:!0,value:!0}),a=document.TaoOSPM.ui.widgets.createCheckbox({label:"Dokumente direkt drucken wenn möglich",enabled:!0,value:!0}),a.setBottomBorder(!0),d.direktDruckenWennMoeglich=!0,a.setChangeListener(function(){d.direktDruckenWennMoeglich=a.getValue()}),i=function(e){e.appData.documentID?d.changeMap[e.appData.documentID]=e.getValue():e.appData.dokument.documentID&&(d.changeMap[e.appData.dokument.documentID]=e.getValue())},n=function(t){var n,a,o=r?r.getValue():!0,u=l.getElements(),h=!1,c=!0,g=!0;for(d.nurDrucken={alle:!0,dokids:[]},a=0;a<u.length;a++)n=u[a].appData,s=s?!0:!e.isNullOrUndefined(n.postfachKennzeichen)&&"1"===n.postfachKennzeichen,e.isNullOrUndefined(t)?u[a].setChangeListener(i):(g=e.isNullOrUndefined(n.pflichtKennzeichen),c=!(e.isNullOrUndefined(n.pflichtKennzeichen)&&d.parameter.KANN_DOKUMENTE_DESELEKTIERT&&e.isNullOrUndefined(d.parameter.EXPRESSMODE)),h=!(o||!e.isNullOrUndefined(n.pflichtKennzeichen)&&!e.isNullOrUndefined(n.postfachMifidRelevant)),d.nurDrucken.alle=d.nurDrucken.alle?h:!1,h&&d.nurDrucken.dokids.push(n.documentID),e.isNullOrUndefined(n.pflichtKennzeichen)||(g=h?"automatische Archivierung"===n.archivElekKz:!e.isNullOrUndefined(n.postfachKennzeichen)&&"1"===n.postfachKennzeichen||"automatische Archivierung"===n.archivElekKz,g=g&&n.hasOnlyDritte===!1,g||(c=!0)),c!==!0||g!==!0||n.hasOnlyDritte!==!1||e.isNullOrUndefined(n.postfachKennzeichen)||"1"!==n.postfachKennzeichen||(c=h?e.isNullOrUndefined(n.pflichtKennzeichen)?!0:"automatische Archivierung"===n.archivElekKz:!e.isNullOrUndefined(n.archivElekKz)&&"automatische Archivierung"!==n.archivElekKz),"Dropdown"===u[a].getClassName()?(e.isNullOrUndefined(u[a].isElementEnabled("abwahl"))||u[a].setElementEnabled("abwahl",g),c?u[a].setSelected(e.isNullOrUndefined(n.zentralerDruckKZ)||"Z"!==n.zentralerDruckKZ&&"O"!==n.zentralerDruckKZ||!e.isNullOrUndefined(n.archivElekKz)&&!d.mindestensEinDokumentZentralerDruck?"drucken":"postversand"):u[a].getElements().length>0&&"abwahl"===u[a].getElements()[0].value&&u[a].setSelected("abwahl"),u[a].setSubLabel(d.getSublabelForDok(n,!h,!1))):(u[a].setEnabled(g),u[a].setValue(u[a].isEnabled()?c:!0),u[a].setSubLabel(d.getSublabelForDok(n,!h,!0))),u[a].appData.documentID?d.changeMap[u[a].appData.documentID]=u[a].getValue():u[a].appData.dokument.documentID&&(d.changeMap[u[a].appData.dokument.documentID]=u[a].getValue()));0===d.nurDrucken.dokids.length&&(d.nurDrucken.alle=!1),!d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(d.infoText)&&d.infoText.length>0&&(d.resultList.getElement(0).setFormattedLabel(d.infoText),d.resultList.getElement(0).setHidden(d.nurDrucken.alle))},r.setChangeListener(n),r.setBottomBorder(!1),n(),s?(d.resultList.addElement(r,t),d.resultList.addElement(a,t+1)):d.resultList.addElement(a,t))},setAllSelectionRow:function(t,n,i,r,a,l){var o,u,h=function(n){var r,a,o,h,c=0,g=i.getElements();if(n.appData.documentID?l[n.appData.documentID]=n.getValue():n.appData.dokument.documentID&&(l[n.appData.dokument.documentID]=n.getValue()),e.isNullOrUndefined(t)&&d.useNewEpoWorkflowAktiv){for(d.selectedPostfachempf=[],h=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements(),r=0;r<h.length;r++)if(a=h[r].appData,o=n.appData,o.personenNr===a.dokpersonennr&&"Dritter"!==a.elpbrec){n.getValue().indexOf("epo")>=0?(h[r].isEnabled()&&h[r].setValue(!0),d.selectedPostfachempf.push(a)):(h[r].isEnabled()&&h[r].setValue(!1),d.selectedPostfachempf.splice(a,1)),d.setPostfachempfaengerInDokumentList(d.selectedPostfachempf,n),d.useNewEpoWorkflowAktiv&&e.isNullOrUndefined(d.epoController)&&(d.epoController=new s(function(e){d.selectedPostfachempf=e,d.setPostfachempfaengerInDokumentList(d.selectedPostfachempf)}),h[r].isEnabled()&&d.epoController.setPostfachempfaengerInList("extern"));break}}else d.setPostfachempfaengerInDokumentList(d.selectedPostfachempf,n);if(d.useNewEpoWorkflowAktiv&&d.layout&&h&&h.length>0)for(d.layout.getElement(1).setHidden(!0),r=0;r<g.length;r++)if("Dropdown"===g[r].getClassName()&&g[r].getValue().indexOf("epo")>=0){d.layout.getElement(1).setHidden(!1);break}if(!e.isNullOrUndefined(u)&&u.isEnabled()){for(r=0;r<g.length;r++)"Dropdown"!==g[r].getClassName()||"abwahl"===g[r].getValue()&&g[r].isEnabled()?"Checkbox"!==g[r].getClassName()||!g[r].getValue()&&g[r].isEnabled()||c++:c++;d.toogleSelection=c===g.length,u.setValue(d.toogleSelection)}},c=function(t){var n,r,a,s,o=0,c=0,g=0,f=i.getElements().length,p=0,m=0,E=!1,k=!0,D=i.getElements();for(r=0;r<D.length;r++)a=null,E=E?!0:"Dropdown"===D[r].getClassName(),k=E&&D[r].getElements().length>0&&"abwahl"===D[r].getElements()[0].value,E&&!k&&f--,D[r].appData.documentID?s=D[r].appData:D[r].appData.dokument.documentID&&(s=D[r].appData.dokument),D[r].isEnabled()===!0?(e.isNullOrUndefined(t)||(E?(d.toogleSelection?k&&(a="abwahl"):d.useNewSignatureWorkflow?e.isNullOrUndefined(s.zentralerDruckKZ)||"Z"!==s.zentralerDruckKZ&&"O"!==s.zentralerDruckKZ||!e.isNullOrUndefined(s.archivElekKz)?a=e.isNullOrUndefined(s.archivElekKz)?d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(s.postfachKennzeichen)&&"1"===s.postfachKennzeichen&&s.hasOnlyDritte===!1?"epo":"drucken":s.archivElekKz.indexOf("Elektronisch unterzeichnen")>=0?d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(s.postfachKennzeichen)&&"1"===s.postfachKennzeichen&&s.hasOnlyDritte===!1?"drucken_sa_epo":"drucken_sa":d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(s.postfachKennzeichen)&&"1"===s.postfachKennzeichen&&s.hasOnlyDritte===!1?"drucken_a_epo":"drucken_a":(a="postversand",d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(s.postfachKennzeichen)&&"1"===s.postfachKennzeichen&&s.hasOnlyDritte===!1&&(a="postversand_epo")):e.isNullOrUndefined(s.zentralerDruckKZ)||"N"===s.zentralerDruckKZ?a=d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(s.postfachKennzeichen)&&"1"===s.postfachKennzeichen&&s.hasOnlyDritte===!1?"epo":"drucken":("O"===s.zentralerDruckKZ?a=e.isNullOrUndefined(s.postfachKennzeichen)||"1"!==s.postfachKennzeichen?"BEARBEITEN"===s.verarbeitungsArt&&"IPAD"!==d.kanalKz?"postversand_drucken":"postversand":"BEARBEITEN"===s.verarbeitungsArt&&"IPAD"!==d.kanalKz?"drucken":"postversand":"Z"===s.zentralerDruckKZ&&(a="BEARBEITEN"===s.verarbeitungsArt&&"IPAD"!==d.kanalKz?"postversand_drucken":"postversand"),"IPAD"!==d.kanalKz&&d.mindestensEinDokumentZentralerDruck&&!e.isNullOrUndefined(s.archivElekKz)&&s.archivElekKz.indexOf("(Pflicht)")>=0&&(a="BEARBEITEN"===s.verarbeitungsArt?a:"postversand_drucken"),d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(s.postfachKennzeichen)&&"1"===s.postfachKennzeichen&&s.hasOnlyDritte===!1&&(a="postversand_epo")),e.isNullOrUndefined(a)||D[r].setSelected(a),D[r].getSelected().indexOf("epo")>=0&&p++):D[r].setValue(!d.toogleSelection)),l[s.documentID]=D[r].getValue(),o++):E||D[r].getValue()?g++:c++,e.isNullOrUndefined(t)&&D[r].setChangeListener(h);if(n=document.TaoOSPM.ui.getSelectionGroup("postfachempfaengergroup").getElements(),d.useNewEpoWorkflowAktiv&&d.layout&&n&&n.length>0&&d.layout.getElement(1).setHidden(0>=p),o>0&&g+o>1){if(e.isNullOrUndefined(t)){for(r=0;r<D.length;r++)"Dropdown"!==D[r].getClassName()||"abwahl"===D[r].getValue()&&D[r].isEnabled()?"Checkbox"!==D[r].getClassName()||!D[r].getValue()&&D[r].isEnabled()||m++:m++;d.toogleSelection=m===D.length}else d.toogleSelection=!d.toogleSelection;e.isNullOrUndefined(u)||(u.setEnabled(o>1),u.setValue(u.isEnabled()?d.toogleSelection:!1))}return{foundEnabled:o,foundDisabledSelected:g,foundDisabled:c,foundAbwahl:f,isDropdown:E}};if(i&&t&&n>=0){if(d.toogleSelection=!0,u=document.TaoOSPM.ui.widgets.createCheckbox({label:a,enabled:!0}),u.setChangeListener(c),o=c(),o&&o.foundAbwahl>0&&(u.setEnabled(o.foundEnabled>1),u.isEnabled()||u.setValue(!1),o.foundDisabled+o.foundEnabled>1||r&&o.foundDisabledSelected>1))return t.addElement(u,n),t.addElement(document.TaoOSPM.ui.widgets.createSpacer({offset:16,bottomBorder:!1}),n+1),u}else c();return null},executeRequest:function(t,n,i,r){var a=function(){};n&&d.fachlicheMeldungsId&&d.aktivitaetsName&&(n.fachlicheMeldungsId=d.fachlicheMeldungsId,n.aktivitaetsName=d.aktivitaetsName),n&&d.kanalKz&&(n.KANAL_KZ=d.kanalKz),e.isNullOrUndefined(i)||(a=i),d.parameter&&d.parameter.BACKGROUND&&d.parameter.BACKGROUND===!0?document.TaoOSPM.server.executeBackgroundRequest(t,n,a,r):document.TaoOSPM.server.executeRequest(t,n,a,r)},getMessageArrayAbCode2:function(e){return d.msgController.getMessageArrayAbCode2(e)},messageVerarbeitung:function(e,t,n,i){return d.msgController.messageVerarbeitung(e,t,n,i)},doStartIPAD:function(t,n,i,a){var s;e.isNullOrUndefined(i)?d.dokUrls=d.mainResponse.dokUrls:(d.dokUrls=i,d.mainResponse.dokUrls=i),e.isNullOrUndefined(d.dokUrls)||d.useNewSignatureWorkflow&&0!==d.docsForSignatur.length?e.isNullOrUndefined(a)||a(n):(s=new r(t,n,d.mainCallback),s.start(a))},doStartPostfachMaske:function(t){var n,i,r=function(e){d.epostfachCalled=!0,d.callDruckbuendelEndeKennzeichen(d.datgid,e,d.mainCallback,"weiter")};if(d.useNewEpoWorkflowAktiv){if(!d.useNewSignatureWorkflow)return i=new l(!1,null,null,null,function(t){e.isNullOrUndefined(d.epoController)?r(t):d.epoController.stelleDokumenteInsEpo(r,t)},function(){d.epostfachCalled=!0,d.callDruckbuendelEndeKennzeichen(d.datgid,t,d.mainCallback,"fehler")}),void i.getResultList();r=function(e){d.epostfachCalled=!0,d.callFinishCallback(e,d.mainCallback,"weitersignatur")},e.isNullOrUndefined(d.epoController)?r():d.epoController.stelleDokumenteInsEpo(r)}else"true"!==d.mainResponse.epostfachAktiviert||d.epostfachCalled?r(t,!1):(n=new a(d.selectedVorlagen,t,d.dokUrls,r),n.start())},handleOeffneUrlArchivVorDruck:function(e,t){var n,i,r,a=!1;for(n=0;n<d.vorlagennamen.length;n++)if(e.dokId===d.vorlagennamen[n].dokId){-1===d.selectedVorlagen.indexOf(d.vorlagennamen[n].dokBez)&&d.selectedVorlagen.push(d.vorlagennamen[n].dokBez);break}if(d.dokUrls)for(i=0;i<d.dokUrls.length;i++)if(d.dokUrls[i].dokId===e.dokId){a=!0;break}if(a===!1)if(e.dokBez&&e.dokPersonenNr)d.dokUrls?d.dokUrls.push(e):d.dokUrls=[e];else if(d.alleDokumente)for(i=0;i<d.alleDokumente.length;i++)if(r=d.alleDokumente[i],r.documentID===e.dokId){e.dokBez=r.vorlagenBezeichnung,e.dokPersonenNr=r.personenNr,d.dokUrls?d.dokUrls.push(e):d.dokUrls=[e];break}d.handlePDFAuftragsManager({dokUrl:e.dokUrl,dokUrls:d.dokUrls},null,e.dokId,t)},handleURLAbrufArchivVorDruck:function(t,n,i,r,a,s,l){var o={getUrlOfDokumentenID:t,dokabgelegt:n,dokverarbart:i,dokkopie:r};d.vzaAuftragId&&(o.vzaAuftragId=d.vzaAuftragId),d.datgid&&(o.DATG_ID=d.datgid),o.zentralerDruckInAcrobatReaderAktiv=d.zentralerDruckInAcrobatReaderAktiv,d.executeRequest("zdb.dokumenteverarbeitenstationaer",o,function(n,i){d.messageVerarbeitung(i,"Der Abruf der URL konnte nicht erfolgreich durchgeführt werden.",a,l)&&(e.isNullOrUndefined(d.druckzeit)&&(d.druckzeit=n.druckzeit),s&&(n.dokUrls&&1===n.dokUrls.length&&n.dokUrls[0].dokId===t?(d.handleAddDokBezAndPersonennummerToDokUrls(n.dokUrls),s(n.dokUrls[0])):s()))})},internDoArchiv:function(e,t,n,i,r){var a,s,l,o=[];if("IPAD"===d.kanalKz)a={AUTO_ELPO:"false",AUTO_ARCHIV_ABLAGE:"2"},d.vzaAuftragId&&(a.vzaAuftragId=d.vzaAuftragId),a.dkmtIDs=[n.documentID],d.datgid&&(a.DATG_ID=d.datgid),d.executeRequest("zdb.dokumenteverarbeitenstationaer",a,function(n,i){d.messageVerarbeitung(i,"Das Bereitstellen des Dokuments in das Archiv wurde abgebrochen.",e,r)&&d.handleCheckArchivVorDruck(e,t,r,!0)});else if("true"===i)d.handleURLAbrufArchivVorDruck(n.documentID,"true",n.verarbeitungsArt,n.anzahlKopien,e,function(n){n?d.handleOeffneUrlArchivVorDruck(n,function(){d.handleCheckArchivVorDruck(e,t,r,!1)}):r&&r()},r);else{if(t)for(s=function(n){var i,a;if(n&&n.messages)for(i=d.getMessageArrayAbCode2(n.messages),a=0;a<i.length;a++)e.push(i[a]);d.handleCheckArchivVorDruck(e,t,r,!1)},l=0;l<t.length;l++)if(o.push(t[l]),t[l].dokId===n.documentID)return void d.handleOeffneUrlArchivVorDruck(t[l],s);d.handleURLAbrufArchivVorDruck(n.documentID,"false",n.verarbeitungsArt,n.anzahlKopien,e,function(t){o.push(t),d.handleOeffneUrlArchivVorDruck(t,function(){d.handleCheckArchivVorDruck(e,o,r,!1)})},r)}},handleCheckArchivVorDruck:function(e,t,n,i){var r,a,s,l,o=!1,u=!1;if(d.ispMode===!0&&d.nurDrucken.alle===!0)return void(n&&n());if(d.mainResponse&&d.mainResponse.dokumente)for(s=function(a,s){var o,u;"false"===a.dokarchiviert?d.messageVerarbeitung(s,"Die Prüfung ob bereits archiviert wurde konnte nicht erfolgreich abgeschlossen werden.",e,n)&&(u='Das Dokument "'+d.mainResponse.dokumente[r].vorlagenBezeichnung+'" darf im aktuellen Status nicht ',"1"===d.mainResponse.dokumente[r].postfachKennzeichen?(u+="an das Elektronische Postfach",u+=d.mindestensEinDokumentZentralerDruck?" und an den Postversand":""):u+="an den Postversand",u+=" weitergeleitet werden.\nDas Dokument muss vorher"+("IPAD"===d.kanalKz?"":" über den Acrobat Reader")+" archiviert werden.\nMöchten Sie das Dokument archivieren?",o=function(){var i="Dokument für Versand abgewählt: Personennr ["+d.mainResponse.dokumente[r].personenNr+"], Vorlagenname ["+d.mainResponse.dokumente[r].vorlagenName+"], DokId ["+d.mainResponse.dokumente[r].documentID+"]";d.executeRequest("zdb.log",{journalInfo:i},function(){d.arcvordrDokIdsAbgewaehlt.push(d.mainResponse.dokumente[r].documentID),d.handleCheckArchivVorDruck(e,t,n,!1)})},document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Archivierung",icon:"STANDARD_INFORMATION_CIRCLE_M",text:u},function(){d.internDoArchiv(e,t,d.mainResponse.dokumente[r],a.dokabgelegt,n)},o)):(l=function(){d.arcvordrDokIdsVerarbeitet.push(d.mainResponse.dokumente[r].documentID),d.handleCheckArchivVorDruck(e,t,n,!1)},"IPAD"===d.kanalKz&&i?document.TaoOSPM.ui.dialogs.showTextDialog({title:"Archivierung",text:"Das Dokument <"+d.mainResponse.dokumente[r].vorlagenBezeichnung+"> wurde zur Archivierung weitergeleitet.",okButton:{label:"OK",action:l}}):l())},r=0;r<d.mainResponse.dokumente.length;r++){if(o=!1,d.mindestensEinDokumentZentralerDruck)for(a=0;a<d.selDocsZentralerDruck.length;a++)if(d.selDocsZentralerDruck[a].documentID===d.mainResponse.dokumente[r].documentID){o=!0;break}if(-1===d.arcvordrDokIdsAbgewaehlt.indexOf(d.mainResponse.dokumente[r].documentID)&&-1===d.arcvordrDokIdsVerarbeitet.indexOf(d.mainResponse.dokumente[r].documentID)&&"J"===d.mainResponse.dokumente[r].archivVorDruckKZ&&(o||"1"===d.mainResponse.dokumente[r].postfachKennzeichen)){u=!0,d.executeRequest("zdb.dokumentStatusLesen",{documentID:d.mainResponse.dokumente[r].documentID},s);break}}u===!1&&n&&n()},callFinishCallback:function(e,t,n){var i,r=[],a={};if(t){if(d.dokUrls)for(i=0;i<d.dokUrls.length;i++)a={},a.F_12413$$=d.dokUrls[i].dokUrl,a.F_20737$$=d.dokUrls[i].dokId,a.F_13497$$=d.dokUrls[i].dokBez,a.F_35248$$=d.dokUrls[i].dokPersonenNr,r.push(a);t(d.selectedVorlagen.length>0?{vorlagennamen:d.selectedVorlagen,vzaAuftragId:d.vzaAuftragId?d.vzaAuftragId:null,druckzeit:d.druckzeit,messages:e,dokUrls:r,useNewSignatureWorkflow:d.useNewSignatureWorkflow,event:n}:{messages:e,vzaAuftragId:d.vzaAuftragId?d.vzaAuftragId:null,dokUrls:r,useNewSignatureWorkflow:d.useNewSignatureWorkflow,event:n})}},callDruckbuendelEndeKennzeichen:function(e,t,n,i){d.executeRequest("zdb.druckbuendelendekennzeichensetzen",{DATG_ID:e},function(){d.callFinishCallback(t,n,i)})},weiterNachDruck:function(t,n){var i,r=e.isNullOrUndefined(n)?[]:n;d.arcvordrDokIdsAbgewaehlt=[],d.arcvordrDokIdsVerarbeitet=[],i=function(){d.parameter.INTERN_SET_SELECTEDELEMENTS?d.mainCallback&&d.mainCallback(d.selectedVorlagen.length>0?{vorlagennamen:d.selectedVorlagen,vzaAuftragId:d.vzaAuftragId?d.vzaAuftragId:null,druckzeit:d.druckzeit,messages:r,dokUrls:t?t:[],useNewSignatureWorkflow:d.useNewSignatureWorkflow,useNewEpoWorkflow:d.useNewEpoWorkflowAktiv,event:"weiter"}:{messages:r,vzaAuftragId:d.vzaAuftragId?d.vzaAuftragId:null,dokUrls:t?t:[],useNewSignatureWorkflow:d.useNewSignatureWorkflow,useNewEpoWorkflow:d.useNewEpoWorkflowAktiv,event:"weiter"}):d.doStartPostfachMaske(r)},d.useNewEpoWorkflowAktiv?d.startDokumentenVerarbeitungZentralerDruck(r,function(e){var t,n;for(t=d.getMessageArrayAbCode2(e),n=0;n<t.length;n++)r.push(t[n]);i()}):d.handleCheckArchivVorDruck(r,t,function(){d.startDokumentenVerarbeitungZentralerDruck(r,function(e){var t,n;for(t=d.getMessageArrayAbCode2(e),n=0;n<t.length;n++)r.push(t[n]);i()})},!1)},sleepFor:function(e){for(var t=(new Date).getTime();(new Date).getTime()<t+e;);},handleListElementsNewEpoWorkflow:function(t,n,i,r){e.isNullOrUndefined(n.pflichtKennzeichen)&&t.push({label:"Abwahl",value:"abwahl"}),!e.isNullOrUndefined(n.zentralerDruckKZ)&&"N"!==n.zentralerDruckKZ&&e.isNullOrUndefined(n.archivElekKz)?"O"===n.zentralerDruckKZ?(i&&r||(t.push({label:"Nur Drucken",value:"drucken"}),t.push({label:"Postversand",value:"postversand"})),i&&(t.push({label:"Elektr. Postfach",value:"epo"}),(d.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK===!1||r)&&t.push({label:"Postversand, Elektr. Postfach",value:"postversand_epo"}),d.useNewSignatureWorkflow||t.push({label:"Drucken, Elektr. Postfach",value:"drucken_epo"}))):"Z"===n.zentralerDruckKZ&&(i&&r||t.push({label:"Postversand",value:"postversand"}),i&&(d.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK===!1||r)&&t.push({label:"Postversand, Elektr. Postfach",value:"postversand_epo"})):(!e.isNullOrUndefined(n.archivElekKz)&&d.useNewSignatureWorkflow&&(n.archivElekKz.indexOf("Elektronisch unterzeichnen")>=0&&(i&&t.push({label:"Elektr. unterzeichnen, Archivierung"+("J"===n.vza?" (Verbundpartner)":"")+", Elektr. Postfach",value:"drucken_sa_epo"}),i&&r||t.push({label:"Elektr. unterzeichnen, Archivierung"+("J"===n.vza?" (Verbundpartner)":""),value:"drucken_sa"})),"J"===n.archiv&&(i&&t.push({label:"Archivierung, Elektr. Postfach",value:"drucken_a_epo"}),i&&r||t.push({label:"Archivierung",value:"drucken_a"}))),"N"===n.archivVorDruckKZ&&(i&&r||t.push({label:"Nur Drucken",value:"drucken"}),i&&(t.push({label:"Elektr. Postfach",value:"epo"}),d.useNewSignatureWorkflow||t.push({label:"Drucken, Elektr. Postfach",value:"drucken_epo"}))))},getListElementsNewEpoWorkflow:function(t){var i,r,a=!1,s=null,l=[],o=!e.isNullOrUndefined(t.postfachKennzeichen)&&"1"===t.postfachKennzeichen,u=!e.isNullOrUndefined(t.postfachMifidRelevant)&&!e.isNullOrUndefined(t.pflichtKennzeichen)&&o,h=o?"epo":"drucken";return d.handleListElementsNewEpoWorkflow(l,t,o,u),i=null,s=t.personenName,e.isNullOrUndefined(t.pflichtKennzeichen)||(s+=", Pflicht"),e.isNullOrUndefined(t.unterschriftsverzicht)||(s=s?s+", Unterschriftsverzicht":"Unterschriftsverzicht"),e.isNullOrUndefined(t.postfachMifidRelevant)||(s=s?s+", MiFID":"MiFID"),e.isNullOrUndefined(t.zentralerDruckKZ)||"Z"!==t.zentralerDruckKZ&&"O"!==t.zentralerDruckKZ||!e.isNullOrUndefined(t.archivElekKz)?e.isNullOrUndefined(t.archivElekKz)?d.useNewSignatureWorkflow||(h=o?"epo":"drucken_epo"):d.useNewSignatureWorkflow?h=t.archivElekKz.indexOf("Elektronisch unterzeichnen")>=0?o?"drucken_sa_epo":"drucken_sa":o?"drucken_a_epo":"drucken_a":(h=o?"epo":"drucken_epo",s=s?s+", "+t.archivElekKz:t.archivElekKz):h=o?"postversand_epo":"postversand",l.forEach(function(e){e.value===h&&(a=!0)}),a||(h=0),r=document.TaoOSPM.ui.widgets.createDropdown({label:t.vorlagenBezeichnung,subLabel:i,infoText:s?s:null,selected:h,enabled:!0,multiSelect:!1,mandatory:!0,group:"documentgroup",elements:l,wrapMode:n.WRAP_MODE.DEFAULT})},getListElement:function(t,n,i){var r,a=[];return n&&a.push({label:"Kein Druck",value:"abwahl"}),!e.isNullOrUndefined(t.zentralerDruckKZ)&&"N"!==t.zentralerDruckKZ&&e.isNullOrUndefined(t.archivElekKz)?"O"===t.zentralerDruckKZ?(a.push({label:"Drucken",value:"drucken"}),a.push({label:"Postversand",value:"postversand"})):"Z"===t.zentralerDruckKZ&&a.push({label:"Postversand",value:"postversand"}):a.push({label:"Drucken",value:"drucken"}),r=document.TaoOSPM.ui.widgets.createDropdown({label:t.vorlagenBezeichnung,subLabel:d.getSublabelForDok(t,!0,!1),enabled:a.length>1,mandatory:!0,group:"documentgroup",elements:a}),i?r.setSelected(e.isNullOrUndefined(t.zentralerDruckKZ)||"Z"!==t.zentralerDruckKZ&&"O"!==t.zentralerDruckKZ||!e.isNullOrUndefined(t.archivElekKz)&&!d.mindestensEinDokumentZentralerDruck?"drucken":"postversand"):n&&r.setSelected("abwahl"),r},getListElementPostversand:function(t,n,i){var r,a,s,l=[],o=!e.isNullOrUndefined(t.postfachKennzeichen)&&"1"===t.postfachKennzeichen;return n&&l.push({label:"Kein Druck",value:"abwahl"}),e.isNullOrUndefined(t.zentralerDruckKZ)||"N"===t.zentralerDruckKZ?l.push({label:"BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?"Bearbeiten, Drucken":"Drucken",value:"drucken"}):"O"===t.zentralerDruckKZ?(a=o?"BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?"Bearbeiten":"Drucken":"BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?"Bearbeiten, Drucken":"Drucken",l.push({label:a,value:"drucken"}),"BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?l.push({label:"Bearbeiten, Postversand",value:"postversand_drucken"}):e.isNullOrUndefined(t.archivElekKz)||"IPAD"===d.kanalKz?l.push({label:"Postversand",value:"postversand"}):(l.push({label:t.archivElekKz.indexOf("(Pflicht)")<0?"Drucken, Postversand":"Archivierung (Acrobat Reader), Postversand",value:"postversand_drucken"}),t.archivElekKz.indexOf("(Pflicht)")<0&&l.push({label:"Postversand",value:"postversand"}))):"Z"===t.zentralerDruckKZ&&("BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?l.push({label:"Bearbeiten, Postversand",value:"postversand_drucken"}):e.isNullOrUndefined(t.archivElekKz)||"IPAD"===d.kanalKz?l.push({label:"Postversand",value:"postversand"}):(l.push({label:t.archivElekKz.indexOf("(Pflicht)")<0?"Drucken, Postversand":"Archivierung (Acrobat Reader), Postversand",value:"postversand_drucken"}),t.archivElekKz.indexOf("(Pflicht)")<0&&l.push({label:"Postversand",value:"postversand"}))),r=document.TaoOSPM.ui.widgets.createDropdown({label:t.vorlagenBezeichnung,subLabel:d.getSublabelForDok(t,!0,!1),enabled:l.length>1,mandatory:!0,group:"documentgroup",elements:l}),i?e.isNullOrUndefined(t.zentralerDruckKZ)||"N"===t.zentralerDruckKZ?s="drucken":("O"===t.zentralerDruckKZ?s=e.isNullOrUndefined(t.postfachKennzeichen)||"1"!==t.postfachKennzeichen?"BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?"postversand_drucken":"postversand":"BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?"drucken":"postversand":"Z"===t.zentralerDruckKZ&&(s="BEARBEITEN"===t.verarbeitungsArt&&"IPAD"!==d.kanalKz?"postversand_drucken":"postversand"),!e.isNullOrUndefined(t.archivElekKz)&&t.archivElekKz.indexOf("(Pflicht)")>=0&&"IPAD"!==d.kanalKz&&(s="BEARBEITEN"===t.verarbeitungsArt&&"O"===t.zentralerDruckKZ?s:"postversand_drucken")):n&&(s="abwahl"),r.setSelected(s),r},addPflichtOrOptionalDokument:function(t){var n,i=!0,r=!(e.isNullOrUndefined(t.pflichtKennzeichen)&&d.parameter.KANN_DOKUMENTE_DESELEKTIERT&&e.isNullOrUndefined(d.parameter.EXPRESSMODE));"true"===d.mainResponse.epostfachAktiviert&&(e.isNullOrUndefined(t.pflichtKennzeichen)||(i="automatische Archivierung"===t.archivElekKz,d.ispMode?i=!e.isNullOrUndefined(t.postfachKennzeichen)&&"1"===t.postfachKennzeichen||"automatische Archivierung"===t.archivElekKz:e.isNullOrUndefined(t.archivElekKz)&&!e.isNullOrUndefined(t.postfachKennzeichen)&&"1"===t.postfachKennzeichen&&(i=!0),i=i&&t.hasOnlyDritte===!1,i||(r=!0)),d.ispMode!==!0||r!==!0||i!==!0||t.hasOnlyDritte!==!1||e.isNullOrUndefined(t.postfachKennzeichen)||"1"!==t.postfachKennzeichen?d.ispMode===!1&&r===!0&&i===!0&&e.isNullOrUndefined(t.archivElekKz)&&!e.isNullOrUndefined(t.postfachKennzeichen)&&"1"===t.postfachKennzeichen&&!e.isNullOrUndefined(t.anzahlKopien)&&parseInt(t.anzahlKopien,10)<2&&(r=!1):r=!e.isNullOrUndefined(t.archivElekKz)&&"automatische Archivierung"!==t.archivElekKz),r||(r="IPAD"===d.kanalKz?!1:"BEARBEITEN"===t.verarbeitungsArt),d.useNewEpoWorkflowAktiv?n=d.getListElementsNewEpoWorkflow(t,i,r):!d.mindestensEinDokumentZentralerDruck&&d.zentralerDruck&&0===d.bearbeitenDoks.length?n=d.getListElement(t,i,r):d.mindestensEinDokumentZentralerDruck||d.zentralerDruck&&d.bearbeitenDoks.length>0?(e.isNullOrUndefined(t.pflichtKennzeichen)||"BEARBEITEN"!==t.verarbeitungsArt||"IPAD"===d.kanalKz||(i=!1,r=!0),n=d.getListElementPostversand(t,i,r)):(e.isNullOrUndefined(t.pflichtKennzeichen)||"BEARBEITEN"!==t.verarbeitungsArt||"IPAD"===d.kanalKz||(i=!1,r=!0),n=document.TaoOSPM.ui.widgets.createCheckbox({label:t.vorlagenBezeichnung,subLabel:d.getSublabelForDok(t,!0,!0),enabled:i,value:r,leftIcon:"DOCUMENT_PDF_M",group:"documentgroup"})),n.appData=t,d.orgMap[t.documentID]=n.getValue(),d.resultList.addElement(n)},handleAutoArchivierung:function(t,n){var i,r={},a=[];if(d.ispMode===!0||d.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK===!0)if(e.isNullOrUndefined(d.selDocs)||d.ispMode!==!0)for(i=0;i<d.alleDokumente.length;i++)"automatische Archivierung"===d.alleDokumente[i].archivElekKz&&a.push(d.alleDokumente[i].documentID);else{for(i=0;i<d.selDocs.length;i++)e.isNullOrUndefined(d.selDocs[i].postfachKennzeichen)||"1"===d.selDocs[i].postfachKennzeichen||"automatische Archivierung"!==d.selDocs[i].archivElekKz||a.push(d.selDocs[i].documentID);for(i=0;i<d.alleDokumente.length;i++)e.isNullOrUndefined(d.alleDokumente[i].postfachKennzeichen)||"1"!==d.alleDokumente[i].postfachKennzeichen||"automatische Archivierung"!==d.alleDokumente[i].archivElekKz||a.push(d.alleDokumente[i].documentID)}a.length>0?(r.dkmtIDs=a,r.ispMode=d.ispMode,d.executeRequest("zdb.autoarchivierung",r,function(e,i){d.messageVerarbeitung(i,"Die automatische Archivierung der Dokumente wurde abgebrochen.",t,d.mainCallback)&&n&&n()})):n&&n()},handleAddDokBezAndPersonennummerToDokUrls:function(t){var n,i;if(t)for(n=0;n<t.length;n++)if(!(t[n].dokBez&&t[n].dokPersonenNr&&t[n].dokESignatur)&&d.alleDokumente)for(i=0;i<d.alleDokumente.length;i++)if(d.alleDokumente[i].documentID===t[n].dokId){t[n].dokBez=d.alleDokumente[i].vorlagenBezeichnung,t[n].dokPersonenNr=d.alleDokumente[i].personenNr,t[n].dokESignatur=!e.isNullOrUndefined(d.alleDokumente[i].archivElekKz)&&(d.alleDokumente[i].archivElekKz.indexOf("Elektronisch unterzeichnen")>=0||d.alleDokumente[i].archivElekKz.indexOf("unterschreibbar")>=0);break}},closePDFWaitingWindow:function(){d.currentWaitingWindow&&(d.currentWaitingWindow.close(),d.currentWaitingWindow=null)},openPDFWaitingWindow:function(t,n){var i=400,r=100,a=screen.height-r-80,s=screen.width-i,l="width="+i+",height="+r+",top="+a+",left="+s+",resizable=yes,location=no,status=no;scrollbars=no",o="<html><head><title>Wartefenster "+t+" - "+window.parent.document.title+"</title></head><body><b>Bitte dieses Fenster nicht schließen!</b><br/>Nach der Verarbeitung der Dokumente im Acrobat Reader schließt dieses Fenster sich automatisch!</body></html>",u=function(){var t;if(!e.isNullOrUndefined(d.currentWaitingWindow)){t=!1;try{t=d.currentWaitingWindow.closed}catch(i){}t?(d.currentWaitingWindow=null,n&&n()):e.executeLater(u,1e3)}};e.isNullOrUndefined(d.currentWaitingWindow)&&(d.currentWaitingWindow=document.TaoOSPM.ui.openWindow("",t,l),e.isNullOrUndefined(d.currentWaitingWindow)?document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Warnung",icon:"info_red",text:"Wartefenster konnte nicht geoeffnet werden - Sie haben evtl. einen PopUp-Blocker aktiviert",okLabel:"OK"}):(d.currentWaitingWindow.document.open("text/html","replace"),d.currentWaitingWindow.document.write(o),d.currentWaitingWindow.document.close(),d.currentWaitingWindow.blur())),e.executeLater(u,0)},handlePDFAuftragsManager:function(t,n,i,r){var a,s,l,o,u,c,g=document.TaoOSPM.ui.widgets.createList(),f=[],p=[];if(t.dokUrl){for(a=0;a<t.dokUrls.length;a++)if(i===t.dokUrls[a].dokId){f.push(t.dokUrls[a]),p.push(t.dokUrls[a]),u=t.dokUrls[a].dokUrl;break}}else f=t.dokUrls,p=t.dokUrls;t.atgUrl&&(d.mainResponse.atgUrl=t.atgUrl,u=t.atgUrl),s=function(i){e.isNullOrUndefined(c)||(d.dokUrls=t.dokUrls,d.executeRequest("zdb.dokumentStatusLesen",{dokUrls:p},function(e){"true"===e.dokOk?(d.closePDFWaitingWindow(),r?r(n):d.weiterNachDruck(d.dokUrls,n),c&&(c.hide(),c=null)):i&&i(e.dokId)}))},o=function(){var e=function(e){d.closePDFWaitingWindow(),d.executeRequest("zdb.log",{journalInfo:"Acrobat Reader Extern: Weiter obwohl DokId ["+e+"] noch im Status 'geöffnet' gemeldet wurde!"},function(){r?r(n):d.weiterNachDruck(d.dokUrls,n),c.hide(),c=null})};s(e)},l=function(){var e=function(){d.openPDFWaitingWindow(i,l)};s(e)},u?(d.openPDFWaitingWindow(i,l),h.oeffneUrl(u,function(){var e,t="Für Ihren Auftrag "+(f.length>1?"werden":"wird")+", gesteuert durch den Acrobat Reader, genau "+(f.length>1?f.length+" Dokumente":"1 Dokument")+" angezeigt und ggf. ausgedruckt.<br>";if(t+="Wenn Sie folgende Dokumente verarbeitet haben, schließt dieser Dialog sich automatisch.<br><br>",f)for(a=0;a<f.length;a++)e="DRUCKER1"===f[a].dokMode?"direkt gedruckt":"angezeigt",t+="Dokument "+(a+1)+" : "+(f[a].dokBez?f[a].dokBez:f[a].dokId)+" ("+e+")<br>";g.addElement(document.TaoOSPM.ui.widgets.createText({label:t})),c=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Dokumentenverarbeitung",content:g,cancelOnOutsideClick:!1,mandatory:!1,footerHidden:!0,closeButton:{action:function(){document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Dokumentenverarbeitung",icon:"STANDARD_INFORMATION_CIRCLE_M",text:"Es wurden ggf. noch nicht alle Dokumente im Acrobat Reader gedruckt oder archiviert. Möchten Sie den Prozess wirklich abbrechen?"},o,function(){})}}}),c.show()})):d.executeRequest("zdb.log",{journalInfo:"Acrobat Reader Extern: Keine URL zurückgeliefert!"},function(){r?r():d.weiterNachDruck(d.dokUrls,n)})},startDokumentenVerarbeitungZentralerDruck:function(t,n){var i,r,a,s,l,o=[],u=function(t){document.TaoOSPM.ui.progress.stop(s),t||e.isNullOrUndefined(n)||n(a)},h={},c=!1,g=d.selDocsZentralerDruck;(d.zentralerDruck||d.mindestensEinDokumentZentralerDruck)&&!e.isNullOrUndefined(g)&&g.length>0?(g.forEach(function(e){o.push(e.documentID)}),l={dkmtidsTocheckBereitsGedruckt:o},d.datgid&&(l.DATG_ID=d.datgid),d.executeRequest("zdb.zentralerdruck",l,function(o){var f,p=e.isNullOrUndefined(o.bereitsGedruckteDkmtids)?[]:o.bereitsGedruckteDkmtids;if(d.alleDokumente)for(i=0;i<d.alleDokumente.length;i++)r=d.alleDokumente[i],g.indexOf(r)>=0&&p.indexOf(r.documentID)<0&&(!e.isNullOrUndefined(r.archivElekKz)&&r.archivElekKz.indexOf("(Pflicht)")>=0&&d.arcvordrDokIdsVerarbeitet.indexOf(r.documentID)>=0||d.arcvordrDokIdsAbgewaehlt.indexOf(r.documentID)<0)&&(Object.keys(h).indexOf(r.persNr)<0&&(h[r.persNr]=[]),d.formularCenterDokumentFuerVersandAmAnfang&&d.formularCenterHinzugefuegteDokId===r.documentID?(h[r.persNr].splice(0,0,r.documentID),c=!0):h[r.persNr].push(r.documentID));Object.keys(h).length>0?(l={personenZuDokumenten:h},d.datgid&&(l.DATG_ID=d.datgid),c&&(l.auftragBuendeln=!0),f=Date.now(),s=document.TaoOSPM.ui.progress.start({timeout:d.busyviewtimeout}),document.TaoOSPM.ui.progress.update({label:"Postversand",sublabel:"Die Dokumente werden zentral gedruckt."},s),d.executeRequest("zdb.zentralerdruck",l,function(n,i){var r,s,l;if(d.messageVerarbeitung(i,"Die Dokumentenverarbeitung für den zentralen Druck wurde abgebrochen.",t,d.mainCallback)){for(a=d.getMessageArrayAbCode2(i),r=d.getMessageArrayAbCode2(t),l=0;l<r.length;l++)a.push(r[l]);s=4e3-(Date.now()-f),s>0?e.executeLater(u,s):u(!1)}else u(!0)})):n&&n()})):n&&n()},callUrlZuAuftragErmitteln:function(t,n,i){var r,a,s,l,o,u=[],h=[],c=[],g=function(t,n){var i,r,a;
if(n&&t)for(i=0;i<n.length;i++)if(t.documentID===n[i].documentID){for(r=t.documentID,u.push(r),d.direktDruckenWennMoeglich&&(t.verarbeitungsArt=e.isNullOrUndefined(t.archivElekKz)||-1!==t.archivElekKz.indexOf("Elektronisch unterzeichnen")||-1!==t.archivElekKz.indexOf("unterschreibbar")||-1!==t.archivElekKz.indexOf("automatische Archivierung")?"DRUCKER1":t.verarbeitungsArt),h.push(t.verarbeitungsArt),a=parseInt(t.anzahlKopien,10),"true"===d.mainResponse.epostfachAktiviert&&a>=2&&!e.isNullOrUndefined(t.postfachKennzeichen)&&"1"===t.postfachKennzeichen&&-1===d.nurDrucken.dokids.indexOf(r)&&a--,c.push(a>=1&&9>=a?String(a):"1"),s=0;s<d.vorlagennamen.length;s++)if(r===d.vorlagennamen[s].dokId){d.selectedVorlagen.push(d.vorlagennamen[s].dokBez);break}break}};if(d.alleDokumente)for(r=0;r<d.alleDokumente.length;r++)l=d.alleDokumente[r],g(l,t);u.length>0?(o={dkmtIDs:u},"OSAP"===d.kanalKz?(o.verArbArt=h,o.kopien=c):(o.AUTO_ELPO="false",o.AUTO_ARCHIV_ABLAGE="0"),d.vzaAuftragId&&(o.vzaAuftragId=d.vzaAuftragId),d.datgid&&(o.DATG_ID=d.datgid),o.zentralerDruckInAcrobatReaderAktiv=d.zentralerDruckInAcrobatReaderAktiv,d.executeRequest("zdb.dokumenteverarbeitenstationaer",o,function(s,l){var o,h,c,g;if(l)for(r=0;r<l.length;r++)if(h=l[r],8===h.code&&h.msg.indexOf("JZL00200E009 - Der Druckbuendelauftrag")>=0&&h.msg.indexOf("wurde bereits beendet")>=0)return h.code=2,g="Das Dokumentenbündel ist bereits in einem vorherigen Aufruf beendet worden.<br>Sie können keine Dokumente mehr drucken, archivieren oder in das Elektronische Postfach einstellen.<br><br>Eine Nacherstellung kann bei Bedarf über das Formularcenter erfolgen.",void document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Dokumentenverarbeitung",icon:"STANDARD_HINT_CIRCLE_M",text:g,okLabel:"OK"},function(){d.prozessWeiterFunc(l)});if(d.messageVerarbeitung(l,"Die Dokumentenverarbeitung wurde abgebrochen.",n,d.mainCallback)){for(e.isNullOrUndefined(d.druckzeit)&&(d.druckzeit=s.druckzeit),o=d.getMessageArrayAbCode2(l),c=d.getMessageArrayAbCode2(n),a=0;a<c.length;a++)o.push(c[a]);s&&s.dokUrls?(d.dokUrls=s.dokUrls,d.handleAddDokBezAndPersonennummerToDokUrls(d.dokUrls),"OSAP"===d.kanalKz?d.handleDokumentenverarbeitungOSAP(s,u[u.length-1],o,i):d.doStartIPAD(t,o,s.dokUrls,i)):d.mainCallback&&d.mainCallback({messages:d.getMessageArrayAbCode2(o),event:"fehler"})}})):i?i():d.weiterNachDruck(d.dokUrls,n)},startDokumentenVerarbeitung:function(t){var n=e.isNullOrUndefined(d.pflichtDokList)?[]:d.pflichtDokList;n=e.isNullOrUndefined(d.selDocs)?n:n.concat(d.selDocs),d.callUrlZuAuftragErmitteln(n,t,function(e){d.weiterNachDruck(d.dokUrls,e)})},handleEpostfachAktiviert:function(){var e,t,n,i,r,a="",s=[],l=0,o=0,u=0,h=function(){for(t=0;t<d.mainResponse.postfachberechtigte.length;t++)d.mainResponse.postfachberechtigte[t].dokpersonennr===d.alleDokumente[e].personenNr&&(i=d.mainResponse.postfachberechtigte[t],"Adressat"===i.elpbrec?l++:"Verbundperson"===i.elpbrec?u++:"Dritter"===i.elpbrec&&o++)};if(d.hasOptionalePostfachempfanger=!1,d.epfArchivBerechtigt=d.mainResponse.epfArchivBerechtigt?"J"===d.mainResponse.epfArchivBerechtigt:!1,d.alleDokumente)for(e=0;e<d.alleDokumente.length;e++)if(l=0,o=0,u=0,d.alleDokumente[e].hasOnlyDritte=!1,d.mainResponse.postfachberechtigte&&"1"===d.alleDokumente[e].postfachKennzeichen)for(d.mainResponse.postfachberechtigte.length>0&&(h(),d.hasOptionalePostfachempfanger===!1&&(d.hasOptionalePostfachempfanger=!0,l>0&&0===o&&0===u?d.hasOptionalePostfachempfanger=!1:0===l&&u>0&&0===o&&(d.hasOptionalePostfachempfanger=!1)),d.alleDokumente[e].hasOnlyDritte=0===l&&0===u&&o>0),n=0;n<d.mainResponse.postfachberechtigte.length;n++)d.mainResponse.postfachberechtigte[n].dokpersonennr===d.alleDokumente[e].personenNr&&(i=d.mainResponse.postfachberechtigte[n],r=i.vorname+" "+i.name,s.indexOf(r)<0&&s.push(r));if(s.length>0){for(a=d.ispMode!==!0&&d.expressMode!==!0||d.hasOptionalePostfachempfanger!==!1?"Die postfachfähigen Dokumente können später"+(d.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK?",<b> falls nicht gedruckt</b>,":"")+" den hinterlegten Empfängern in das Elektronische Postfach eingestellt werden: <b>":"Die postfachfähigen Dokumente werden"+(d.EXKLUSIVE_ZUSTELLUNG_ELPO_ODER_DRUCK?",<b> falls nicht gedruckt</b>,":"")+" automatisch den hinterlegten Empfängern in das Elektronische Postfach eingestellt: <b>",n=0;n<s.length;n++)a+=s[n],n<s.length-1&&(a+=", ");return a+="</b>"}return""},handleDokumentenverarbeitungOSAP:function(e,t,n,i){e&&e.atgUrl?d.handlePDFAuftragsManager(e,n,t,i):d.messageVerarbeitung([{code:"8",msg:"Der Auftrag kann nicht verarbeitet werden."}],"Wenden Sie sich an einen Administrator.",[],d.mainCallback)},handleFlachHerunterladen:function(){var t,i,r,a=!1;for(t=0;t<d.ALLE_FLACH_HERUNTERLADEN_AWKS.length;t++)if(r=d.ALLE_FLACH_HERUNTERLADEN_AWKS[t],document.TaoOSPM.workflowStepId.indexOf("A_"+r+"_")>=0){d.log.info("Anwendung "+r+" für ALLE_FLACH_HERUNTERLADEN freigeschaltet."),a=!0;break}return a?(d.alleLadenAction=function(){var t={getAlleDokumente:!0};e.isNullOrUndefined(d.alleDoksUrl)?(d.datgid&&(t.DATGID=d.datgid),d.executeRequest("zdb.dokumenteverarbeitenstationaer",t,function(e,t){d.messageVerarbeitung(t,"Die Herunterladen der Dokumente wurde abgebrochen.",[],d.mainCallback)&&e.dokUrls&&1===e.dokUrls.length&&(d.alleDoksUrl=e.dokUrls[0].dokUrl,document.TaoOSPM.session.info.openURL({url:d.alleDoksUrl}))})):document.TaoOSPM.session.info.openURL({url:d.alleDoksUrl})},i=document.TaoOSPM.ui.widgets.createHeader({label:"",centered:!0,rightIcons:[{icon:{name:"DOWNLOAD_M",size:n.ICON_SIZE.MEDIUM_10,color:n.ICON_COLOR.BRAND,action:d.alleLadenAction},label:"Alle herunterladen",labelStyle:n.TEXT_STYLE.LABEL1,action:d.alleLadenAction}]}),d.resultList.setHeader(i),!0):(d.messageVerarbeitung([{code:"8",msg:"Flach Herunterladen kann nicht ausgeführt werden."}],"Anwendung für diese Funktion nicht freigeschaltet. Wenden Sie sich an einen Administrator",[],d.mainCallback),!1)},setPostfachempfaengerInDokumentList:function(t,n){var i,r,a,s,l,o="Postfachempfänger: ",u="Keine Postfachempfänger",h=document.TaoOSPM.ui.getSelectionGroup("documentgroup").getElements(),c=!1;if(d.useNewEpoWorkflowAktiv)for(a=0;a<h.length;a++){if("Dropdown"===h[a].getClassName())if(c=c===!1?h[a].getValue().indexOf("epo")>=0:!0,h[a].getValue().indexOf("epo")>=0&&(e.isNullOrUndefined(n)||n===h[a])){for(u="",l=h[a].appData,r=0;r<t.length;r++)t[r].dokpersonennr===l.personenNr&&(s=t[r],i=s.vorname+" "+s.name,u.indexOf(i)<0&&(u.length>o.length?u+=", ":u=o,u+=i));u.length>0?-1===h[a].getValue().indexOf("epo")&&e.isNullOrUndefined(n)&&h[a].setSelected(e.isNullOrUndefined(l.zentralerDruckKZ)||"Z"!==l.zentralerDruckKZ&&"O"!==l.zentralerDruckKZ||!e.isNullOrUndefined(l.archivElekKz)?e.isNullOrUndefined(l.archivElekKz)?!d.useNewSignatureWorkflow&&d.useNewEpoWorkflowAktiv?"drucken_epo":"epo":l.archivElekKz.indexOf("Elektronisch unterzeichnen")>=0?"drucken_sa_epo":"drucken_a_epo":"postversand_epo"):(u="Keine Postfachempfänger",e.isNullOrUndefined(n)&&h[a].setSelected(e.isNullOrUndefined(l.zentralerDruckKZ)||"Z"!==l.zentralerDruckKZ&&"O"!==l.zentralerDruckKZ||!e.isNullOrUndefined(l.archivElekKz)&&!d.mindestensEinDokumentZentralerDruck?e.isNullOrUndefined(l.archivElekKz)?"drucken":l.archivElekKz.indexOf("Elektronisch unterzeichnen")>=0?"drucken_sa":"drucken_a":"postversand")),d.useNewEpoWorkflowAktiv&&h[a].setSubLabel(u)}else d.useNewEpoWorkflowAktiv&&(e.isNullOrUndefined(n)||n===h[a])&&h[a].setSubLabel(u);d.useNewEpoWorkflowAktiv&&d.layout&&c===!1?d.layout.getElement(1).setHidden(!0):d.useNewEpoWorkflowAktiv&&d.layout&&d.layout.getElement(1).setHidden(!1)}},getJsonForSignatur:function(){var t,n,i="{}",r=function(t,n,i){return'{"datgid": "'+d.datgid+'","signierenJN": "'+n+'","signaturgeber": '+(e.isNullOrUndefined(i)?"[]":i)+',"dokumentId": "'+t+'"}'},a=document.GpsOSPM&&document.GpsOSPM.bridgeTools&&document.GpsOSPM.bridgeTools.hasGpsDatenWorkflow()?JSON.stringify(document.GpsOSPM.bridgeTools.getGpsDatenWorkflow().getGpsDatenAsJson()):"{}";if(i='{"DOMAIN_ESA_DOKUMENTINFOS" : [',!e.isNullOrUndefined(d.signaturWorkflowSignaturgeber)&&d.signaturWorkflowDokumentIds.length>0){for(t=0;t<d.signaturWorkflowDokumentIds.length;t++)n=d.signaturWorkflowDokumentIds[t],i+=r(n,"J",JSON.stringify(d.signaturWorkflowSignaturgeber[n])),t<d.signaturWorkflowDokumentIds.length-1&&(i+=",");d.signaturWorkflowPreviewDokumentIds.length>0&&(i+=",")}if(d.signaturWorkflowPreviewDokumentIds.length>0)for(t=0;t<d.signaturWorkflowPreviewDokumentIds.length;t++)n=d.signaturWorkflowPreviewDokumentIds[t],i+=r(n,"N","[]"),t<d.signaturWorkflowPreviewDokumentIds.length-1&&(i+=",");return i+="],",i+='"DOMAIN_GPS_DATEN" : '+a+',"DOMAIN_ESA_DSNUTZEN_JN" : "J","DOMAIN_ESA_USIEGEL_JN" : "N"}',JSON.parse(i)},getJsonForZdbWorkflow:function(){var e,t=["DATGID","EPOSTFACHBETREFF","EPOSTFACHMITTEILUNG","GET_DOKUMENTENLINKS","KANN_DOKUMENTE_DESELEKTIERT","EXTNACHRICHTMODE","DSP_NUTZEN","SIGNATURGEBER","MIFID_EPO_RELEVANTE_DOKUMENTE"],n=[],i={};return document.TaoOSPM.workflow.data.DOMAIN_GPS_DATEN&&(i.DOMAIN_GPS_DATEN=document.TaoOSPM.workflow.data.DOMAIN_GPS_DATEN),i.DOMAIN_ZDB_OPTIONS=[],Object.keys(d.parameter).forEach(function(e){var n;t.indexOf(e)<0?d.parameter[e]&&"object"==typeof d.parameter[e]?Array.isArray(d.parameter[e])?d.parameter[e].forEach(function(t){i.DOMAIN_ZDB_OPTIONS.push(e+"="+t)}):(n=Object.keys(d.parameter[e]),n.forEach(function(t){d.parameter[e][t]&&"object"==typeof d.parameter[e][t]&&Array.isArray(d.parameter[e][t])?d.parameter[e][t].forEach(function(n){i.DOMAIN_ZDB_OPTIONS.push(e+"="+t+","+n)}):i.DOMAIN_ZDB_OPTIONS.push(e+"="+t+",null")})):i.DOMAIN_ZDB_OPTIONS.push(e+(d.parameter[e]&&d.parameter[e].length>1?"="+d.parameter[e]:"")):i["DOMAIN_ZDB_"+e]=d.parameter[e]}),d.signaturWorkflowSignaturgeber&&Object.keys(d.signaturWorkflowSignaturgeber).length>0&&(n=[],e=Object.keys(d.signaturWorkflowSignaturgeber),e.forEach(function(e){d.signaturWorkflowSignaturgeber[e].forEach(function(t){n.push("dokumentId="+e+",persNr="+t.persNr+",rolle="+t.rolle)})}),n.length>0&&(i.DOMAIN_ZDB_SIGNATURGEBER=n)),d.signaturWorkflowVZAFACHDATEN&&Object.keys(d.signaturWorkflowVZAFACHDATEN).length>0&&(i.DOMAIN_ZDB_VZA_AUFTRAG_ID=d.signaturWorkflowVZAAUFTRAGID,i.DOMAIN_ZDB_VZA_VP_KEY=d.signaturWorkflowVZAVPKEY,i.DOMAIN_ZDB_VZA_FACHDATEN=d.signaturWorkflowVZAFACHDATEN),i},handleShowDokumentenauswahl:function(t){var n,i,r,a,l=0,o=[],u=!0,h=!1,c=null,g=null;if(d.alleLadenAction=null,d.resultList=document.TaoOSPM.ui.widgets.createList(),"OSAP"!==d.kanalKz||!d.parameter.ALLE_FLACH_HERUNTERLADEN||d.handleFlachHerunterladen()){if(d.pflichtDokList=[],d.infoText=null,"true"===d.mainResponse.epostfachAktiviert&&(d.infoText=d.handleEpostfachAktiviert()),!d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(d.infoText)&&d.infoText.length>0&&(a=document.TaoOSPM.ui.widgets.createInfoText({formattedLabel:d.infoText,showIcon:!1}),a.setBottomBorder(!1),d.resultList.addElement(a),l++),d.alleDokumente){for(d.mindestensEinDokumentZentralerDruck=d.formulareHinzufuegen||d.mindestensEinDokumentZentralerDruck,n=0;n<d.alleDokumente.length;n++)e.isNullOrUndefined(d.alleDokumente[n].zentralerDruckKZ)||"N"===d.alleDokumente[n].zentralerDruckKZ||(u=!1,d.mindestensEinDokumentZentralerDruck=!!d.mindestensEinDokumentZentralerDruck),!d.mindestensEinDokumentZentralerDruck&&d.zentralerDruck&&!e.isNullOrUndefined(d.alleDokumente[n].zentralerDruckKZ)&&"N"!==d.alleDokumente[n].zentralerDruckKZ&&e.isNullOrUndefined(d.alleDokumente[n].archivElekKz)&&(h=!0);for(u&&(d.mindestensEinDokumentZentralerDruck=!1),d.zentralerDruck&&(d.zentralerDruck=h),n=0;n<d.alleDokumente.length;n++)d.addPflichtOrOptionalDokument(d.alleDokumente[n]);d.ispMode===!0?d.setDoksInPostfachRow(l):d.setAllSelectionRow(d.useNewSignatureWorkflow?null:d.resultList,l,document.TaoOSPM.ui.getSelectionGroup("documentgroup"),!1,d.useNewEpoWorkflowAktiv?"Alle auswählen":"Alle zum Drucken auswählen",d.changeMap)}return d.useNewEpoWorkflowAktiv&&!e.isNullOrUndefined(d.infoText)&&d.infoText.length>0&&(d.epoController=new s(function(e){d.selectedPostfachempf=e,d.setPostfachempfaengerInDokumentList(d.selectedPostfachempf)}),c=d.epoController.getPostfachResultlist(),g=d.epoController.getPostfachBetreffMitteilungList()),d.resultList&&d.resultList.elementCount()>0&&(i=function(t,i){var r,a,s,l,u=t,h=!0,c=!1;if(null===document.TaoOSPM.ui.checkInput(!0,d.resultList)){for(d.changeMap&&(s=Object.keys(d.changeMap)),d.selDocs=[],d.selDocsZentralerDruck=[],d.selDocsJustPrint=[],d.docsForArchiv=[],d.docsForEPO=[],d.docsForSignatur=[],d.signaturWorkflowDokumentIds=[],d.signaturWorkflowPreviewDokumentIds=[],r=document.TaoOSPM.ui.getSelectionGroup("documentgroup").getElements(),a=0;a<r.length;a++){if(!e.isNullOrUndefined(s))for(n=0;n<s.length;n++)if(r[a].appData.documentID===s[n]&&d.orgMap[s[n]]!==d.changeMap[s[n]]){u+="["+r[a].appData.vorlagenName+" ("+r[a].appData.documentID+") von "+d.orgMap[s[n]]+" nach "+d.changeMap[s[n]]+"]";break}if("Dropdown"===r[a].getClassName()&&r[a].getValue().indexOf("postversand")>=0?(d.selDocsZentralerDruck.push(r[a].appData),"postversand_epo"===r[a].getValue()&&d.docsForEPO.push(r[a].appData),"postversand_drucken"===r[a].getValue()&&d.selDocs.push(r[a].appData)):"Dropdown"===r[a].getClassName()&&r[a].getValue().indexOf("drucken_a")>=0?(d.docsForArchiv.push(r[a].appData),"DRUCKER1"!==r[a].appData.verarbeitungsArt&&d.signaturWorkflowPreviewDokumentIds.push(r[a].appData.documentID),r[a].getValue().indexOf("epo")>=0&&d.docsForEPO.push(r[a].appData)):"Dropdown"===r[a].getClassName()&&r[a].getValue().indexOf("drucken_sa")>=0?(d.docsForSignatur.push(r[a].appData),d.signaturWorkflowDokumentIds.push(r[a].appData.documentID),r[a].getValue().indexOf("epo")>=0&&d.docsForEPO.push(r[a].appData)):"Dropdown"===r[a].getClassName()&&"abwahl"!==r[a].getValue()?(r[a].getValue().indexOf("drucken")>=0&&d.selDocs.push(r[a].appData),"DRUCKER1"!==r[a].appData.verarbeitungsArt&&d.signaturWorkflowPreviewDokumentIds.push(r[a].appData.documentID),r[a].getValue().indexOf("epo")>=0?d.docsForEPO.push(r[a].appData):(d.useNewSignatureWorkflow||r[a].getValue().indexOf("drucken")>=0)&&d.selDocsJustPrint.push(r[a].appData)):"Checkbox"===r[a].getClassName()&&r[a].getValue()&&(d.selDocs.push(r[a].appData),d.selDocsJustPrint.push(r[a].appData)),d.useNewEpoWorkflowAktiv&&(h=!e.isNullOrUndefined(r[a].appData.postfachKennzeichen)&&"1"===r[a].appData.postfachKennzeichen&&d.docsForEPO.indexOf(r[a].appData)>=0?"Keine Postfachempfänger"!==r[a].getSubLabel():!0,c=r[a].appData.postfachMifidRelevant,!h))break}if(d.useNewEpoWorkflowAktiv&&d.docsForSignatur.length>0)for(a=0;a<r.length;a++)d.selDocs.indexOf(r[a].appData)<0&&(d.docsForArchiv.indexOf(r[a].appData)>=0?d.selDocs.splice(a,0,r[a].appData):d.docsForEPO.indexOf(r[a].appData)>=0?d.selDocs.splice(a,0,r[a].appData):d.selDocsJustPrint.indexOf(r[a].appData)>=0?d.selDocs.splice(a,0,r[a].appData):d.docsForSignatur.indexOf(r[a].appData)>=0&&d.selDocs.splice(a,0,r[a].appData));if(h||document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Elektronisches Postfach",icon:"STANDARD_HINT_CIRCLE_M",text:"Es gibt "+(c?"MiFID-":"ausgewählte ")+"Dokumente ohne Postfachempfänger.<br>Ohne eine Zuordnung von Postfachempfängern können sie nicht fortsetzen.",okLabel:"OK"},function(){}),!h)return;if(d.useNewEpoWorkflowAktiv&&d.docsForEPO.length>0&&d.layout)if(d.expressMode===!1&&d.ispMode===!1&&g)l=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Elektronisches Postfach",content:g,cancelOnOutsideClick:!1,mandatory:!1,applyButton:{label:"Weiter",action:function(){if(l.hide(),!d.useNewEpoWorkflowAktiv||e.isNullOrUndefined(d.epoController)||!d.epoController.istUnterbrecheWeiterAndReset()){for(;r.length>0;)document.TaoOSPM.ui.getSelectionGroup("documentgroup").removeElement(r[0]);d.executeRequest("zdb.log",{journalInfo:u}),i&&i(o)}}},cancelButton:{label:"Zurück",action:function(){l.setContent(null),l.hide()}},closeButton:{action:function(){l.setContent(null),l.hide()}}}),l.show();else{if((d.expressMode===!0||d.ispMode===!0)&&d.hasOptionalePostfachempfanger===!0)return;i&&i(o)}else{for(;r.length>0;)document.TaoOSPM.ui.getSelectionGroup("documentgroup").removeElement(r[0]);d.executeRequest("zdb.log",{journalInfo:u}),i&&i(o)}}else i&&i(o)}),e.isNullOrUndefined(c)?d.layout=d.resultList:(d.layout=d.resultList,d.layout.addElement(c,0)),d.parameter.INTERN_GET_RESULTLIST?void(d.mainCallback&&d.mainCallback({event:"resultlistreceived",messages:d.getMessageArrayAbCode2(t),vzaAuftragId:d.vzaAuftragId?d.vzaAuftragId:null,expressMode:d.expressMode,hasOptionalePostfachempfanger:d.hasOptionalePostfachempfanger,ispMode:d.ispMode,resultlist:d.layout,formulareHinzufuegenButton:d.formulareHinzufuegenButton,weiterFunktion:i})):void(d.resultList&&d.resultList.elementCount()>0?(r=function(){var t=document.TaoOSPM.ui.checkInput(!0,d.resultList);null===t?i("Weiter in Druckdialog - ",function(){for(var t=document.TaoOSPM.ui.getSelectionGroup("documentgroup").getElements();t.length>0;)document.TaoOSPM.ui.getSelectionGroup("documentgroup").removeElement(t[0]);e.isNullOrUndefined(d.dokumentenAuswahlDialogView)||d.dokumentenAuswahlDialogView.hide(),d.handleAutoArchivierung(o,function(){d.startDokumentenVerarbeitung(o)})}):d.executeRequest("zdb.log",{errorLog:"Keine Verarbeitung möglich: checkInput liefert Objekt "+t.getClassName()+" ("+t.getLabel()+")"})},e.isNullOrUndefined(d.formulareHinzufuegenButton)||d.resultList.setHeader(document.TaoOSPM.ui.widgets.createHeader({centered:!0,rightIcons:d.formulareHinzufuegenButton})),e.isNullOrUndefined(d.dokumentenAuswahlDialogView)?d.dokumentenAuswahlDialogView=document.TaoOSPM.ui.dialogs.createInputDialog({title:"Auswahl Ihrer Dokumente",content:d.layout,cancelOnOutsideClick:!1,mandatory:!0,applyButton:{label:"Weiter",action:r}}):d.dokumentenAuswahlDialogView.setContent(d.layout),d.dokumentenAuswahlDialogView.show(),r&&d.expressMode===!0&&r()):d.startDokumentenVerarbeitung(t))}},prozessWeiterFunc:function(e){var t,n={},i=[],r=!1;if(d.parameter.INTERN_SET_SELECTEDELEMENTS){if(d.mainCallback){if(d.dokUrls)for(t=0;t<d.dokUrls.length;t++)n={},n.F_12413$$=d.dokUrls[t].dokUrl,n.F_20737$$=d.dokUrls[t].dokId,n.F_13497$$=d.dokUrls[t].dokBez,n.F_35248$$=d.dokUrls[t].dokPersonenNr,i.push(n);d.mainCallback(d.selectedVorlagen&&d.selectedVorlagen.length>0?{vorlagennamen:d.selectedVorlagen,vzaAuftragId:d.vzaAuftragId?d.vzaAuftragId:null,druckzeit:d.druckzeit,messages:d.getMessageArrayAbCode2(e),dokUrls:i,useNewSignatureWorkflow:d.useNewSignatureWorkflow,event:r?"weiter":"weiterohneepo"}:{messages:d.getMessageArrayAbCode2(e),vzaAuftragId:d.vzaAuftragId?d.vzaAuftragId:null,dokUrls:i,useNewSignatureWorkflow:d.useNewSignatureWorkflow,event:r?"weiter":"weiterohneepo"})}}else d.epostfachCalled=!r,d.doStartPostfachMaske(e)},doVerarbeitung:function(t){if(d.selectedVorlagen=[],e.isNullOrUndefined(t.DATG_ID)||(d.datgid=t.DATG_ID),"OSAP"===d.kanalKz||"IPAD"===d.kanalKz){if(d.parameter.INTERN_SET_SELECTEDELEMENTS||d.parameter.INTERN_SET_SELECTEDELEMENTSZENTRALERDRUCK||d.parameter.INTERN_SET_SELECTEDELEMENTSARCHIV||d.parameter.INTERN_SET_SELECTEDELEMENTSSIGNATUR)return d.parameter.INTERN_SET_SELECTEDELEMENTS&&(d.selDocs=d.parameter.INTERN_SET_SELECTEDELEMENTS),d.parameter.INTERN_SET_SELECTEDELEMENTSZENTRALERDRUCK&&(d.selDocsZentralerDruck=d.parameter.INTERN_SET_SELECTEDELEMENTSZENTRALERDRUCK),d.parameter.INTERN_SET_SELECTEDELEMENTSARCHIV&&(d.docsForArchiv=d.parameter.INTERN_SET_SELECTEDELEMENTSARCHIV),d.parameter.INTERN_SET_SELECTEDELEMENTSSIGNATUR&&(d.docsForSignatur=d.parameter.INTERN_SET_SELECTEDELEMENTSSIGNATUR),d.useNewSignatureWorkflow=d.useNewSignatureWorkflow&&d.docsForSignatur.length>0,void d.handleAutoArchivierung([],function(){d.useNewSignatureWorkflow?d.weiterNachDruck(d.dokUrls,[]):d.startDokumentenVerarbeitung([])});if(d.parameter.INTERN_GET_EPOSTFACHRESULTLIST)return void d.doStartPostfachMaske([])}d.orgMap={},d.changeMap={},t.dialogModus=!d.parameter.INTERN_GET_RESULTLIST,t.workflowStepId=document.TaoOSPM.workflowStepId,t.formularHinzufuegen=d.formulareHinzufuegen,d.executeRequest("zdb.dokumenteverarbeitenstationaer",t,function(t,r){var a,s,l,o,u,h=!0,c=!1,g=[],f=function(t){var n;if(!e.isNullOrUndefined(t))for(n=0;n<g.length;n++)if(Object.values(g[n]).indexOf(t)>=0)return!0;return!1};if(d.mainResponse=t,d.messageVerarbeitung(r,"Die Vorbereitung der Dokumentenverarbeitung wurde abgebrochen.",[],d.mainCallback)){if(d.vorlagennamen=d.mainResponse.vorlagenNamen,d.useNewSignatureWorkflow=d.useNewSignatureWorkflow&&"true"===d.mainResponse.useNewSignatureWorkflow,d.useNewEpoWorkflowAktiv=d.useNewEpoWorkflowAktiv&&d.useNewSignatureWorkflow,d.signaturWorkflowVZAAUFTRAGID=d.mainResponse.vzaAuftragId,e.isNullOrUndefined(d.druckzeit)&&(d.druckzeit=d.mainResponse.druckzeit),d.epostfachvorbelegung=d.mainResponse.epostfachvorbelegung,d.alleDokumente=d.mainResponse.dokumente,d.formulareHinzufuegen&&!e.isNullOrUndefined(d.alleDokumente))for(a=0;a<d.alleDokumente.length;a++)if(!e.isNullOrUndefined(d.alleDokumente[a])&&!e.isNullOrUndefined(d.alleDokumente[a].vorlagenName)&&d.alleDokumente[a].vorlagenName.startsWith("1051")){d.executeRequest("zdb.log",{journalInfoAndFP:'Funktion "Formular Hinzufügen" wird aufgrund der Vorlage '+d.alleDokumente[a].vorlagenName+" nicht angeboten."},function(){}),d.formulareHinzufuegen=!1;break}if(d.dokUrls=d.mainResponse.dokUrls,void 0===d.mainResponse.DATG_ID)return void(d.mainCallback&&d.mainCallback({event:"weiter",useNewSignatureWorkflow:d.useNewSignatureWorkflow,messages:d.getMessageArrayAbCode2(r)}));if(d.parameter.GET_DOKUMENTENLINKS&&d.mainResponse.dokUrls)return void d.callDruckbuendelEndeKennzeichen(d.mainResponse.DATG_ID,r,d.mainCallback,"weiter");if(d.vzaAuftragId=null,e.isNullOrUndefined(d.mainResponse.vzaAuftragId)||(d.vzaAuftragId=d.mainResponse.vzaAuftragId),d.formulareHinzufuegen){if(d.alleDokumente)for(a=0;a<d.alleDokumente.length;a++)f(d.alleDokumente[a].persNr)||g.push({persNr:d.alleDokumente[a].persNr});if(d.mainResponse.postfachberechtigte)for(a=0;a<d.mainResponse.postfachberechtigte.length;a++)f(d.mainResponse.postfachberechtigte[a].persnr)||g.push({persNr:d.mainResponse.postfachberechtigte[a].persnr});g.length>0?(u=function(){var t;d.executeRequest("zdb.log",{journalInfoAndFP:'"Formular Hinzufügen" wurde für Auftrag '+d.datgid+" aufgerufen"},function(){}),e.isNullOrUndefined(d.datgid)&&(d.datgid=d.mainResponse.DATG_ID),t=new i({D_DMS_DRUCKBUENDEL:d.datgid,D_DMS_PERSONEN:g}),e.isNullOrUndefined(d.dokumentenAuswahlDialogView)||d.dokumentenAuswahlDialogView.hide(),document.TaoOSPM.workflow.startWorkflowOverlay("W_DVM_FORMULARCENTER_STARTSEITE","I_DVM_FORMULARCENTER_START_ZDB_WF",t,function(t){var n=t.D_DMS_DRUCKBUENDEL,i=document.TaoOSPM.ui.getSelectionGroup("documentgroup").getElements();if(d.formularCenterHinzugefuegteDokId=t.D_DMS_DOKID,d.formularCenterDokumentFuerVersandAmAnfang=t.D_DMS_DOK_AM_ANFANG?t.D_DMS_DOK_AM_ANFANG:!1,n!==d.datgid)return s="Die DATGID aus dem Formularcenter ("+n+") ist unterschiedlich zur aktuellen DATGID ("+d.datgid+")",d.executeRequest("zdb.log",{errorLog:s}),void(e.isNullOrUndefined(d.dokumentenAuswahlDialogView)||d.dokumentenAuswahlDialogView.show());if(e.isNullOrUndefined(d.formularCenterHinzugefuegteDokId))return void(e.isNullOrUndefined(d.dokumentenAuswahlDialogView)||d.dokumentenAuswahlDialogView.show());for(d.bearbeitenDoks=[],d.bearbeitenDoks.push(d.formularCenterHinzugefuegteDokId),d.parameter.BEARBEITENDOKS=d.bearbeitenDoks,d.resultList.removeHeader(),d.parameter.FORMULARE_HINZUFUEGEN=!1,d.formulareHinzufuegen=!1,d.formulareHinzufuegenButton=null,d.mindestensEinDokumentZentralerDruck=!0,d.zentralerDruck=!0,d.parameter.ZENTRALERDRUCK=!0,d.parameter.DATGID=d.datgid;i.length>0;)document.TaoOSPM.ui.getSelectionGroup("documentgroup").removeElement(i[0]);d.handleBuendelVerarbeitenKanalOSAPoderIPAD()})},d.formulareHinzufuegenButton=[{icon:{name:"PLUS_CIRCLE_S",size:n.ICON_SIZE.SMALL_30,color:n.ICON_COLOR.BRAND,action:u},label:"Hinzufügen",labelStyle:n.TEXT_STYLE.LABEL1,action:u}]):d.executeRequest("zdb.log",{errorLog:"Formularcenter kann nicht aufgerufen werden. Keine Personen vorhanden."})}if(l=function(){if("false"===d.mainResponse.showDokumentenAuswahl){if(d.executeRequest("zdb.log",{journalInfo:"Automatische Dokumentenverarbeitung"}),d.vorlagennamen)for(a=0;a<d.vorlagennamen.length;a++)d.selectedVorlagen.push(d.vorlagennamen[a].dokBez);d.selDocs=null,d.selDocsZentralerDruck=null,d.handleAutoArchivierung(r,function(){"OSAP"===d.kanalKz?d.handleDokumentenverarbeitungOSAP(d.mainResponse,e.isNullOrUndefined(d.dokUrls)?null:d.dokUrls[d.dokUrls.length-1].dokId,r):d.doStartIPAD(null,r,null,function(e){d.weiterNachDruck(d.dokUrls,e)})})}else d.handleShowDokumentenauswahl(r)},o=function(){!e.isNullOrUndefined(d.alleDokumente)&&d.alleDokumente.length>0?l():d.prozessWeiterFunc(r)},!e.isNullOrUndefined(d.mainResponse.abgeholteDokumente)&&d.mainResponse.abgeholteDokumente.length>0)if(d.executeRequest("zdb.log",{journalInfo:"Druckbündel mit "+(!e.isNullOrUndefined(d.alleDokumente)&&d.alleDokumente.length>0?"teilabgerufenen":"vollständig abgerufenen")+" Dokumenten <"+d.mainResponse.abgeholteDokumente+">, DatgId: "+d.mainResponse.DATG_ID}),!e.isNullOrUndefined(d.alleDokumente)&&d.alleDokumente.length>0&&(h=d.mainResponse.showHinweisabgeholt),h){for(s="Folgende Dokumente wurden zu einem früheren Zeitpunkt bereits verarbeitet:<br>",a=0;a<d.mainResponse.abgeholteDokumente.length;a++){if("null"===d.mainResponse.abgeholteDokumente[a]){c=!0;break}s+=d.mainResponse.abgeholteDokumente[a]+"<br>"}c?s="Alle Dokumente wurden zu einem früheren Zeitpunkt bereits verarbeitet und können nicht mehr nachverarbeitet werden.":s+="<br>Bitte prüfen Sie, ob die Dokumente "+(d.useNewSignatureWorkflow?"unterzeichnet, ":"")+"archiviert, gedruckt oder in das Elektronische Postfach eingestellt worden sind."+(d.useNewSignatureWorkflow?"":"<br>Eine Nacherstellung kann ggf. bei Bedarf über das Formularcenter erfolgen."),document.TaoOSPM.ui.dialogs.showSecurityDialog({title:"Dokumentenverarbeitung",icon:"STANDARD_HINT_CIRCLE_M",text:s,okLabel:"OK"},o)}else o();else o()}})}},h={internalZdbApi:d,erzeugeUrl:function(n,i){var r,a=document.TaoOSPM.session.environment.isIPadApp(),s=document.TaoOSPM.session.environment.isInternetFiliale(),l={},o=new t("zdb","erzeugeUrl");return o.info("callback "+(n?"Ja":"Nein")),document.GpsOSPM&&document.GpsOSPM.bridgeTools&&document.GpsOSPM.bridgeTools.hasGpsDatenWorkflow()&&(r=document.GpsOSPM.bridgeTools.getGpsDatenWorkflow(),l.fachlicheMeldungsId=document.GpsOSPM.bridgeTools.getFachlicheMeldungId(),l.aktivitaetsName=r.getAktivitaetName(),i&&i.FACHLICHE_MELDUNG_NAME&&(d.aktivitaetsName=i.FACHLICHE_MELDUNG_NAME,d.log.info("FACHLICHE_MELDUNG_NAME: "+i.FACHLICHE_MELDUNG_NAME))),l.zentralerDruckInAcrobatReaderAktiv=!1,l.GET_DOKUMENTENLINKS=!0,l.KANAL_KZ=a===!0?"IPAD":"OSAP",s?void d.messageVerarbeitung([{code:"8",msg:"Medial ist diese Funktion nicht erlaubt."}],"Funktion medial über Client-API nicht zulässig.",[],n):void(e.isNullOrUndefined(n)||(i&&(i.DATGID&&(l.DATG_ID=i.DATGID,o.info("DATGID : "+i.DATGID)),i.zentralerDruckInAcrobatReaderAktiv&&(l.zentralerDruckInAcrobatReaderAktiv=!0),i.INTERN_SIMULATE_IPAD&&(l.KANAL_KZ="IPAD")),document.TaoOSPM.server.executeRequest("zdb.log",{journalInfo:"Aufruf erzeugeUrl mit Auftrag "+l.DATG_ID},function(){},null),document.TaoOSPM.server.executeRequest("zdb.dokumenteverarbeitenstationaer",l,function(e,t){var i={};l.DATG_ID&&(i.DATG_ID=l.DATG_ID),d.messageVerarbeitung(t,"Die Erzeugung der Url wurde abgebrochen.",[],n)&&e&&e.dokUrls&&document.TaoOSPM.server.executeRequest("zdb.druckbuendelendekennzeichensetzen",i,function(){var i,r,a=[];for(r=0;r<e.dokUrls.length;r++)i={},i.F_12413$$=e.dokUrls[r].dokUrl,i.F_20737$$=e.dokUrls[r].dokId,i.F_13497$$=e.dokUrls[r].dokBez,i.F_35248$$=e.dokUrls[r].dokPersonenNr,a.push(i);n({messages:t,dokUrls:a,event:"weiter"})},null)},null)))},buendelVerarbeiten:function(n,i){var r,a,s,l,o=document.TaoOSPM.session.environment.isIPadApp(),h=document.TaoOSPM.session.environment.isInternetFiliale(),c=document.TaoOSPM.session.environment.isIspContext(),g=!0,f=!1,p=!1,m=[];d.oeffneUrlWindow=null,d.log=new t("zdb","buendelVerarbeiten"),d.log.info("callback "+(n?"Ja":"Nein")),s={},i?(s=i,d.parameter=s,Object.keys(s).forEach(function(e){f=f?!0:"INTERN_GET_RESULTLIST"===e&&s[e]===!0,p=p?!0:"INTERN_FROM_GPS"===e&&s[e]===!0,h||m.push(!s.hasOwnProperty("INTERN_FROM_GPS")||s.hasOwnProperty("INTERN_GET_RESULTLIST")&&-1===e.indexOf("INTERN_")?{journalInfoAndFP:"Bündelauftrag-Parameter: "+e+"="+s[e]}:{journalInfo:"Bündelauftrag-Parameter: "+e+"="+s[e]}),"INTERN_GET_RESULTLIST"!==e&&"INTERN_GET_EPOSTFACHRESULTLIST"!==e||s[e]!==!0||(d.QUEUE_RUNNING=!1,d.QUEUE=[],d.QUEUE_INDEX=0,d.QUEUE_CURJOB=null)}),g=p?f:!0):h||m.push({journalInfoAndFP:"Bündelauftrag-Parameter: keine"}),d.log.info("isIF "+(h?"Ja":"Nein")),h===!0?d.handleBuendelVerarbeitenKanalIF(s,n,d.log):(d.log.info("isIPadApp "+(o?"Ja":"Nein")),d.log.info("isISP "+(c?"Ja":"Nein")),a=function(t){d.QUEUE_RUNNING=!1,d.log.info("Bündelauftrag ID:"+d.QUEUE_CURJOB.index+" abgeschlossen."),n&&n(t),e.executeLater(r,0)},d.QUEUE.push({index:d.QUEUE_INDEX++,callback:a,parameter:s}),r=function(){!d.QUEUE_RUNNING&&d.QUEUE.length>0?(d.QUEUE_CURJOB=d.QUEUE.shift(),d.log.info("Bearbeite Bündelauftrag ID:"+d.QUEUE_CURJOB.index),d.QUEUE_RUNNING=!0,g&&Object.keys(u).forEach(function(e){d[e]=u[e]}),d.mainCallback=d.QUEUE_CURJOB.callback,d.parameter=d.QUEUE_CURJOB.parameter,document.GpsOSPM&&document.GpsOSPM.bridgeTools&&document.GpsOSPM.bridgeTools.hasGpsDatenWorkflow()&&(l=document.GpsOSPM.bridgeTools.getGpsDatenWorkflow(),d.fachlicheMeldungsId=document.GpsOSPM.bridgeTools.getFachlicheMeldungId(),d.aktivitaetsName=e.isNullOrUndefined(d.aktivitaetsName)?l.getAktivitaetName():d.aktivitaetsName,d.parameter.FACHLICHE_MELDUNG_NAME&&(d.aktivitaetsName=d.parameter.FACHLICHE_MELDUNG_NAME,d.log.info("FACHLICHE_MELDUNG_NAME: "+d.parameter.FACHLICHE_MELDUNG_NAME))),m.length>0&&m.forEach(function(e){d.executeRequest("zdb.log",e,function(){})}),d.kanalKz=o===!0?"IPAD":"OSAP",("IPAD"===d.kanalKz||d.parameter.INTERN_SIMULATE_IPAD)&&(d.kanalKz="IPAD"),d.ispMode=c,d.handleBuendelVerarbeitenKanalOSAPoderIPAD()):d.QUEUE.length>0?(d.log.info("Auftrag ID:"+d.QUEUE_CURJOB.index+" in Bearbeitung. Nächste Prüfung in 2 s [Offene Aufträge: "+d.QUEUE.length+"]."),e.executeLater(r,2e3)):d.QUEUE_INDEX-1===d.QUEUE_CURJOB.index&&(d.log.info("Alle Aufträge abgearbeitet"),d.QUEUE_INDEX=0)},e.executeLater(r,0))},oeffneUrl:function(n,i){var a,s,l=document.TaoOSPM.session.environment.isIPadApp(),o=document.TaoOSPM.session.environment.isInternetFiliale();d.log=new t("zdb","oeffneUrl"),d.log.info("zdb oeffneUrl called"),s=function(t){e.isNullOrUndefined(t)||(l===!0?(d.log.info("zdb oeffneUrl für iPad (DBKM) mit URL "+t),a=new r(null,[],i),a.startWithUrl(t,function(){i&&i({event:"weiter"})})):(d.log.info("zdb oeffneUrl "+(o===!0?"medial":"stationär")+" mit URL "+t),o===!0?document.TaoOSPM.ui.openWindow(t,t):document.TaoOSPM.ui.openWindow(t,t),i&&i({event:"weiter"})))},o===!1?d.refreshURL(n,s):s(n)},oeffneUrlFromDokId:function(t,n,i){var r=document.TaoOSPM.session.environment.isInternetFiliale(),a=function(e){this.oeffneUrl(e,n)}.bind(this);return e.isNullOrUndefined(t)?void(n&&n({event:"weiter"})):void(r===!0?d.loadURL(i,t,a):n&&n({messages:[{code:8,msg:"Diese Funktion wird derzeit nur medial unterstützt."}],event:"fehler"}))}};return h}),define(["zdb/common/ZdbApi"],function(e){var t={api:e};return document.ZdbOSPM||(document.ZdbOSPM={}),t});
//# sourceMappingURL=ZdbOSPM.js.map